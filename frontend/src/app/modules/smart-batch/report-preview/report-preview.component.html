<div
    class="bg-white rounded-lg shadow-lg mx-auto overflow-hidden"
    [style.max-width]="orientation() === 'landscape' ? '297mm' : '210mm'"
    [style.min-height]="orientation() === 'landscape' ? '210mm' : '297mm'"
    style="border: 1px solid #e5e7eb;"
>
    <div class="p-8 sm:p-10 lg:p-12">
        @if (template().sections?.length === 0) {
            <div class="flex flex-col items-center justify-center h-64 text-gray-300">
                <mat-icon class="!text-5xl !w-14 !h-14 mb-3">description</mat-icon>
                <p class="text-sm">No sections to preview</p>
            </div>
        }

        @for (section of template().sections; track section.id) {
            <div
                class="transition-all duration-200"
                [class.cursor-pointer]="clickable()"
                [class.ring-2]="clickable() && selectedSectionId() === section.id"
                [class.ring-indigo-400]="clickable() && selectedSectionId() === section.id"
                [class.rounded-md]="clickable() && selectedSectionId() === section.id"
                (click)="clickable() && sectionClick() ? sectionClick()!(section) : null"
            >
                @if (section.type === 'header') {
                    <div
                        class="mb-4"
                        [style.text-align]="section.style?.textAlign || 'left'"
                    >
                        <h2
                            [style.font-size.px]="section.style?.fontSize || 22"
                            [style.font-weight]="section.style?.fontWeight || 'bold'"
                            [style.color]="section.style?.color || primaryColor()"
                            class="leading-tight"
                        >
                            {{ section.staticContent || section.label || 'Untitled' }}
                        </h2>
                    </div>
                }

                @if (section.type === 'text') {
                    <div class="mb-3">
                        <p
                            [style.font-size.px]="section.style?.fontSize || 12"
                            [style.font-weight]="section.style?.fontWeight || 'normal'"
                            [style.text-align]="section.style?.textAlign || 'left'"
                            [style.color]="section.style?.color || '#374151'"
                            class="leading-relaxed whitespace-pre-wrap"
                        >{{ section.staticContent || 'Text content...' }}</p>
                    </div>
                }

                @if (section.type === 'field') {
                    <div
                        class="flex gap-3 py-2.5 border-b border-gray-100"
                        [style.text-align]="section.style?.textAlign || 'left'"
                    >
                        <span
                            class="text-gray-500 min-w-[140px] shrink-0"
                            [style.font-size.px]="section.style?.fontSize || 12"
                        >{{ section.label || 'Field' }}</span>
                        <span
                            class="text-gray-900 font-medium"
                            [style.font-size.px]="section.style?.fontSize || 12"
                            [style.color]="section.style?.color || '#111827'"
                        >{{ resolveDataPath(section.dataPath) || '---' }}</span>
                    </div>
                }

                @if (section.type === 'table') {
                    <div class="mb-4">
                        @if (section.label) {
                            <h4
                                class="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-2"
                                [style.color]="primaryColor()"
                            >{{ section.label }}</h4>
                        }
                        <table class="w-full text-sm">
                            <tbody>
                                @for (row of resolveTableData(section.dataPath); track row.key) {
                                    <tr class="border-b border-gray-100">
                                        <td class="py-2 pr-4 text-gray-500 w-1/3">{{ row.key }}</td>
                                        <td class="py-2 text-gray-900 font-medium">{{ row.value }}</td>
                                    </tr>
                                }
                                @if (resolveTableData(section.dataPath).length === 0) {
                                    <tr>
                                        <td colspan="2" class="py-4 text-center text-gray-300 text-xs">
                                            No data at path "{{ section.dataPath }}"
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }

                @if (section.type === 'image') {
                    <div
                        class="mb-4"
                        [style.text-align]="section.style?.textAlign || 'center'"
                    >
                        @if (section.staticContent) {
                            <img
                                [src]="section.staticContent"
                                [alt]="section.label || 'Image'"
                                class="max-h-32 inline-block rounded"
                                style="max-width: 100%;"
                            />
                        } @else {
                            <div class="inline-flex items-center justify-center w-48 h-24 bg-gray-100 rounded-lg text-gray-300">
                                <mat-icon class="!text-3xl">image</mat-icon>
                            </div>
                        }
                    </div>
                }

                @if (section.type === 'divider') {
                    <hr
                        class="my-4"
                        [style.border-color]="section.style?.color || '#E5E7EB'"
                        style="border-width: 1px;"
                    />
                }

                @if (section.type === 'spacer') {
                    <div [style.height.px]="section.style?.padding || 16"></div>
                }
            </div>
        }
    </div>
</div>
