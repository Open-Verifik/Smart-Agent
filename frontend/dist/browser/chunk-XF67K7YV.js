import{a as U}from"./chunk-IOBAWF3C.js";import{b as k}from"./chunk-FTR6VSJR.js";import"./chunk-P6TIVLNX.js";import{a as L,b as R}from"./chunk-XQDPKUEO.js";import{b as K}from"./chunk-DLAWIIUM.js";import{c as V,d as z}from"./chunk-IHQN5EVA.js";import{d as O}from"./chunk-YGFCFPCR.js";import"./chunk-YM2RJPUK.js";import{V as A,X as $,Z as N,_ as P}from"./chunk-AFVGM62N.js";import{Eb as i,Fb as t,Gb as h,Kb as _,Mb as y,Nb as p,Oc as T,Pc as B,Qc as F,Wa as r,X as u,Xb as a,Yb as w,Zb as l,_b as I,cd as j,f as C,fb as S,ga as x,hc as M,lb as f,oc as d,pc as c,qa as b,qc as E,ra as v,sb as m,yc as D}from"./chunk-DCQLSIRV.js";import"./chunk-MG3ERZGY.js";var q=n=>({count:n});function G(n,g){n&1&&(i(0,"div",11),h(1,"mat-spinner",12),t())}function H(n,g){n&1&&(i(0,"div",13)(1,"div",14)(2,"mat-icon",15),a(3,"check_circle"),t()(),i(4,"h3",16),a(5),d(6,"transloco"),t(),i(7,"p",17),a(8),d(9,"transloco"),t()()),n&2&&(r(5),l(" ",c(6,2,"smartMonitor.allSystemsOperational")," "),r(3),l(" ",c(9,4,"smartMonitor.allSystemsDesc")," "))}function J(n,g){if(n&1){let e=_();i(0,"div",13)(1,"div",18)(2,"mat-icon",19),a(3,"notifications_off"),t()(),i(4,"h3",16),a(5),d(6,"transloco"),t(),i(7,"p",17),a(8),d(9,"transloco"),t(),i(10,"button",20),y("click",function(){b(e);let s=p();return v(s.openDetail({_id:null}))}),a(11),d(12,"transloco"),t()()}n&2&&(r(5),l(" ",c(6,3,"smartMonitor.noSubscriptionsYet")," "),r(3),l(" ",c(9,5,"smartMonitor.noSubscriptionsDesc")," "),r(3),l(" ",c(12,7,"smartMonitor.goToStatusCheck")," "))}function Q(n,g){if(n&1&&(i(0,"div",37)(1,"mat-icon",38),a(2,"timelapse"),t(),i(3,"span"),a(4),t()()),n&2){let e=p().$implicit,o=p(2);r(4),w(o.formatDuration(e.duration))}}function W(n,g){if(n&1){let e=_();i(0,"div",26),y("click",function(){let s=b(e).$implicit,Y=p(2);return v(Y.openDetail(s))}),i(1,"div",27)(2,"div",28)(3,"div",29),h(4,"span",30),t(),i(5,"div",31)(6,"h3",32),a(7),d(8,"transloco"),t(),i(9,"p",33),a(10),t()()(),i(11,"span",34),a(12),d(13,"transloco"),t()(),i(14,"div",35)(15,"div",36)(16,"div",37)(17,"mat-icon",38),a(18,"schedule"),t(),i(19,"span"),a(20),d(21,"transloco"),t()(),f(22,Q,5,1,"div",39),t(),i(23,"div",40),a(24),d(25,"transloco"),i(26,"mat-icon",38),a(27,"arrow_forward"),t()()()()}if(n&2){let e=g.$implicit,o=p(2);r(4),m("ngClass",o.getStatusCfg(e.status).dotClass),r(3),l(" ",o.getServiceName(e)||c(8,9,"smartMonitor.unknownService")," "),r(3),l(" ",e.code," "),r(),m("ngClass",o.getStatusCfg(e.status).classes),r(),l(" ",c(13,11,o.getStatusCfg(e.status).labelKey)," "),r(8),I("",c(21,13,"smartMonitor.started")," ",o.formatDate(e.startDate),""),r(2),m("ngIf",e.duration),r(2),l(" ",c(25,15,"smartMonitor.viewLogs")," ")}}function X(n,g){if(n&1&&(i(0,"div",21)(1,"div",22)(2,"mat-icon",23),a(3,"error_outline"),t(),i(4,"span",24),a(5),d(6,"transloco"),t()(),f(7,W,28,17,"div",25),t()),n&2){let e=p();r(5),l(" ",E(6,2,"smartMonitor.activeIncidentsCount",M(5,q,e.incidents.length))," "),r(2),m("ngForOf",e.incidents)}}var ve=(()=>{class n{constructor(){this._service=x(U),this._cdr=x(D),this._router=x(O),this._unsubscribeAll=new C,this.loading=!0,this.incidents=[],this.subscriptions=[],this.statusConfig={down:{labelKey:"smartMonitor.statusDown",classes:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",dotClass:"bg-red-500 animate-pulse"},review:{labelKey:"smartMonitor.statusReview",classes:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",dotClass:"bg-yellow-500 animate-pulse"},up:{labelKey:"smartMonitor.statusUp",classes:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",dotClass:"bg-green-500"},closed:{labelKey:"smartMonitor.statusClosed",classes:"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400",dotClass:"bg-gray-400"}}}ngOnInit(){this._loadSubscriptionsThenIncidents()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}_loadSubscriptionsThenIncidents(){this.loading=!0,this._service.getIncidentsSubscriptions({populates:["appFeature"]}).pipe(u(this._unsubscribeAll)).subscribe({next:e=>{this.subscriptions=e.data||e||[],this._loadIncidents()},error:()=>{this.loading=!1,this._cdr.markForCheck()}})}_loadIncidents(){if(!this.subscriptions.length){this.loading=!1,this._cdr.markForCheck();return}let e=[...new Set(this.subscriptions.map(s=>s.alias).filter(Boolean))],o={in_status:["down","review"],populates:["appFeature"],sort:"-createdAt"};e.length&&(o.in_alias=e),this._service.getIncidents(o).pipe(u(this._unsubscribeAll)).subscribe({next:s=>{this.incidents=s.data||s||[],this.loading=!1,this._cdr.markForCheck()},error:()=>{this.loading=!1,this._cdr.markForCheck()}})}getStatusCfg(e){return this.statusConfig[e]??this.statusConfig.closed}formatDate(e){return e?k.fromISO(e).toLocaleString(k.DATETIME_MED):"N/A"}formatDuration(e){if(!e)return"\u2014";if(e<60)return`${e}m`;let o=Math.floor(e/60),s=e%60;return s?`${o}h ${s}m`:`${o}h`}getServiceName(e){return e.appFeature?.name||e.code||""}openDetail(e){this._router.navigate(["/smart-monitor/incidents",e._id])}static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275cmp=S({type:n,selectors:[["incidents"]],decls:18,vars:10,consts:[[1,"flex","flex-col","flex-auto","min-w-0","bg-gray-50","dark:bg-gray-900","min-h-screen"],[1,"flex","flex-col","w-full","max-w-5xl","mx-auto","p-6","md:p-8"],[1,"flex","flex-col","py-6","mb-8","border-b","border-gray-200","dark:border-gray-800"],[1,"flex","items-center","gap-3","mb-1"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-xl","bg-red-100","dark:bg-red-900/30"],[1,"text-red-600","dark:text-red-400","icon-size-5"],[1,"text-2xl","font-bold","tracking-tight","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["class","flex flex-auto justify-center items-center py-24",4,"ngIf"],["class","flex flex-col items-center justify-center py-24 text-center",4,"ngIf"],["class","flex flex-col gap-4",4,"ngIf"],[1,"flex","flex-auto","justify-center","items-center","py-24"],["diameter","56"],[1,"flex","flex-col","items-center","justify-center","py-24","text-center"],[1,"flex","items-center","justify-center","w-20","h-20","rounded-full","bg-green-100","dark:bg-green-900/30","mb-5"],[1,"icon-size-10","text-green-500"],[1,"text-xl","font-semibold","text-gray-800","dark:text-white","mb-1"],[1,"text-gray-500","dark:text-gray-400","max-w-sm"],[1,"flex","items-center","justify-center","w-20","h-20","rounded-full","bg-gray-100","dark:bg-gray-800","mb-5"],[1,"icon-size-10","text-gray-400"],["mat-stroked-button","","routerLink","/smart-monitor/status-check",1,"mt-6",3,"click"],[1,"flex","flex-col","gap-4"],[1,"flex","items-center","gap-2","px-4","py-3","rounded-xl","bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-800","text-red-700","dark:text-red-400"],[1,"icon-size-4","flex-shrink-0"],[1,"text-sm","font-medium"],["class","incident-card flex flex-col bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"incident-card","flex","flex-col","bg-white","dark:bg-gray-800","rounded-2xl","shadow-sm","border","border-gray-200","dark:border-gray-700","overflow-hidden","cursor-pointer",3,"click"],[1,"flex","items-start","justify-between","p-5","border-b","border-gray-100","dark:border-gray-700/50"],[1,"flex","items-start","gap-4","min-w-0"],[1,"flex-shrink-0","pt-1"],[1,"inline-block","w-3","h-3","rounded-full",3,"ngClass"],[1,"min-w-0"],[1,"text-base","font-semibold","text-gray-900","dark:text-white","leading-tight"],[1,"text-xs","text-gray-400","dark:text-gray-500","mt-0.5","font-mono"],[1,"ml-4","flex-shrink-0","inline-flex","items-center","gap-1.5","px-3","py-1","rounded-full","text-xs","font-semibold",3,"ngClass"],[1,"flex","items-center","justify-between","px-5","py-3","bg-gray-50/50","dark:bg-gray-800/30"],[1,"flex","items-center","gap-6","text-xs","text-gray-500","dark:text-gray-400"],[1,"flex","items-center","gap-1.5"],[1,"icon-size-3.5"],["class","flex items-center gap-1.5",4,"ngIf"],[1,"flex","items-center","gap-1","text-xs","font-medium","text-primary-600","dark:text-primary-400"]],template:function(o,s){o&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"mat-icon",5),a(6,"warning_amber"),t()(),i(7,"div")(8,"h2",6),a(9),d(10,"transloco"),t(),i(11,"p",7),a(12),d(13,"transloco"),t()()()(),f(14,G,2,0,"div",8)(15,H,10,6,"div",9)(16,J,13,9,"div",9)(17,X,8,7,"div",10),t()()),o&2&&(r(9),l(" ",c(10,6,"smartMonitor.activeIncidents")," "),r(3),l(" ",c(13,8,"smartMonitor.incidentsSubtitle")," "),r(2),m("ngIf",s.loading),r(),m("ngIf",!s.loading&&s.subscriptions.length>0&&s.incidents.length===0),r(),m("ngIf",!s.loading&&s.subscriptions.length===0),r(),m("ngIf",!s.loading&&s.incidents.length>0))},dependencies:[j,T,B,F,z,V,R,L,$,A,P,N,K],styles:["incidents[_ngcontent-%COMP%]{display:block}.incident-card[_ngcontent-%COMP%]{transition:box-shadow .2s ease,transform .15s ease}.incident-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}"],changeDetection:0})}}return n})();export{ve as IncidentsComponent};
