import{_ as y}from"./chunk-S7YYVX2B.js";import{g as o}from"./chunk-GAL4ENT6.js";var u=(()=>{class c{constructor(){this.STORAGE_KEY_ENCRYPTED_PK="x402_agent_pk_encrypted",this.STORAGE_KEY_ENCRYPTION_METHOD="x402_encryption_method",this.STORAGE_KEY_SALT="x402_encryption_salt"}isPasskeysSupported(){return o(this,null,function*(){return window.PublicKeyCredential!==void 0&&typeof window.PublicKeyCredential=="function"})}encryptWithPasskeys(t){return o(this,null,function*(){try{let a={challenge:crypto.getRandomValues(new Uint8Array(32)),rp:{name:"Smart Agent",id:window.location.hostname},user:{id:crypto.getRandomValues(new Uint8Array(16)),name:"agent-wallet",displayName:"Agent Wallet"},pubKeyCredParams:[{alg:-7,type:"public-key"},{alg:-257,type:"public-key"}],authenticatorSelection:{authenticatorAttachment:"platform",requireResidentKey:!1,userVerification:"required"},timeout:6e4,attestation:"none"},r=yield navigator.credentials.create({publicKey:a});if(!r)throw new Error("Failed to create credential");let n=new Uint8Array(r.rawId),i=yield this.deriveKeyFromCredential(n),s=yield this.encryptData(t,i);return localStorage.setItem(this.STORAGE_KEY_ENCRYPTED_PK,JSON.stringify(s)),localStorage.setItem(this.STORAGE_KEY_ENCRYPTION_METHOD,"passkey"),localStorage.setItem("x402_credential_id",this.arrayBufferToBase64(n)),localStorage.removeItem("x402_agent_pk"),!0}catch(e){return console.error("Passkey encryption failed:",e),!1}})}decryptWithPasskeys(){return o(this,null,function*(){try{let t=localStorage.getItem(this.STORAGE_KEY_ENCRYPTED_PK),e=localStorage.getItem("x402_credential_id");if(!t||!e)throw new Error("No encrypted data found");let a=JSON.parse(t),r=this.base64ToArrayBuffer(e),i={challenge:crypto.getRandomValues(new Uint8Array(32)),allowCredentials:[{id:r,type:"public-key",transports:["internal"]}],timeout:6e4,userVerification:"required"};if(!(yield navigator.credentials.get({publicKey:i})))throw new Error("Authentication failed");let l=yield this.deriveKeyFromCredential(new Uint8Array(r));return yield this.decryptData(a,l)}catch(t){return console.error("Passkey decryption failed:",t),null}})}encryptWithPIN(t,e){return o(this,null,function*(){try{if(!/^\d{6}$/.test(e))throw new Error("PIN must be 6 digits");let a=crypto.getRandomValues(new Uint8Array(16)),r=yield this.deriveKeyFromPIN(e,a),n=yield this.encryptData(t,r);return localStorage.setItem(this.STORAGE_KEY_ENCRYPTED_PK,JSON.stringify(n)),localStorage.setItem(this.STORAGE_KEY_ENCRYPTION_METHOD,"pin"),localStorage.setItem(this.STORAGE_KEY_SALT,this.arrayBufferToBase64(a)),localStorage.removeItem("x402_agent_pk"),!0}catch(a){return console.error("PIN encryption failed:",a),!1}})}decryptWithPIN(t){return o(this,null,function*(){try{let e=localStorage.getItem(this.STORAGE_KEY_ENCRYPTED_PK),a=localStorage.getItem(this.STORAGE_KEY_SALT);if(!e||!a)throw new Error("No encrypted data found");let r=JSON.parse(e),n=this.base64ToArrayBuffer(a),i=yield this.deriveKeyFromPIN(t,new Uint8Array(n));return yield this.decryptData(r,i)}catch(e){return console.error("PIN decryption failed:",e),null}})}getEncryptionMethod(){return localStorage.getItem(this.STORAGE_KEY_ENCRYPTION_METHOD)}isWalletEncrypted(){return!!localStorage.getItem(this.STORAGE_KEY_ENCRYPTED_PK)}deriveKeyFromCredential(t){return o(this,null,function*(){let e=yield crypto.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return yield crypto.subtle.deriveKey({name:"PBKDF2",salt:new Uint8Array([115,109,97,114,116,45,97,103,101,110,116,45,119,97,108,108]),iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])})}deriveKeyFromPIN(t,e){return o(this,null,function*(){let r=new TextEncoder().encode(t),n=yield crypto.subtle.importKey("raw",r,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return yield crypto.subtle.deriveKey({name:"PBKDF2",salt:e,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])})}encryptData(t,e){return o(this,null,function*(){let r=new TextEncoder().encode(t),n=crypto.getRandomValues(new Uint8Array(12)),i=yield crypto.subtle.encrypt({name:"AES-GCM",iv:n},e,r);return{iv:this.arrayBufferToBase64(n),ciphertext:this.arrayBufferToBase64(new Uint8Array(i))}})}decryptData(t,e){return o(this,null,function*(){let a=this.base64ToArrayBuffer(t.iv),r=this.base64ToArrayBuffer(t.ciphertext),n=yield crypto.subtle.decrypt({name:"AES-GCM",iv:a},e,r);return new TextDecoder().decode(n)})}arrayBufferToBase64(t){let e=new Uint8Array(t),a="";for(let r=0;r<e.byteLength;r++)a+=String.fromCharCode(e[r]);return btoa(a)}base64ToArrayBuffer(t){let e=atob(t),a=new Uint8Array(e.length);for(let r=0;r<e.length;r++)a[r]=e.charCodeAt(r);return a.buffer}clearEncryptionData(){localStorage.removeItem(this.STORAGE_KEY_ENCRYPTED_PK),localStorage.removeItem(this.STORAGE_KEY_ENCRYPTION_METHOD),localStorage.removeItem(this.STORAGE_KEY_SALT),localStorage.removeItem("x402_credential_id"),localStorage.removeItem("x402_agent_pk")}static{this.\u0275fac=function(e){return new(e||c)}}static{this.\u0275prov=y({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})();export{u as a};
