import{a as U}from"./chunk-SAQWL5AZ.js";import{b as y}from"./chunk-LSIKLBMU.js";import"./chunk-UZOJVLL6.js";import{a as B,b as P}from"./chunk-TRCJCSTR.js";import{a as $,b as z}from"./chunk-3AXJ3YCT.js";import{d as R}from"./chunk-Y2ZKGQKJ.js";import{b as A,d as F}from"./chunk-H5UQ2FZ7.js";import"./chunk-EJ24FNNM.js";import{V as N,X as j,Z as L,_ as O}from"./chunk-RN2OM5JC.js";import{Eb as a,Fb as n,Gb as f,Hb as b,Ib as _,Mb as I,Nb as c,Oc as E,Pc as D,Qc as M,Wa as i,X as u,Xb as r,Yb as x,Zb as m,_b as w,cd as T,f as h,fb as C,ga as p,lb as g,sb as d,ub as k,yc as S}from"./chunk-M2SB6WSN.js";import"./chunk-66YHNWRR.js";function q(t,s){t&1&&(a(0,"div",8),f(1,"mat-spinner",9),n())}function G(t,s){t&1&&(a(0,"div",10)(1,"mat-icon",11),r(2,"search_off"),n(),a(3,"p",12),r(4,"Incident not found"),n()())}function H(t,s){if(t&1&&(a(0,"div",22)(1,"span",23),r(2,"Resolved"),n(),a(3,"span",24),r(4),n()()),t&2){let e=c(2);i(4),x(e.formatDate(e.incident.endDate))}}function J(t,s){t&1&&(a(0,"div",32)(1,"mat-icon",33),r(2,"article"),n(),a(3,"p",34),r(4," No public updates yet for this incident. "),n(),a(5,"p",35),r(6," Our team is actively investigating. Stay tuned. "),n()())}function K(t,s){if(t&1&&f(0,"div",50),t&2){let e=c().$implicit,l=c(3);d("ngClass",l.getCategoryCfg(e.category).connectorClass)}}function Q(t,s){if(t&1&&(a(0,"p",51),r(1),n()),t&2){let e=c().$implicit;i(),m(" ",e.publicLog," ")}}function V(t,s){t&1&&(a(0,"p",52),r(1," Automatic system update "),n())}function W(t,s){t&1&&(a(0,"p",52),r(1," No details provided. "),n())}function X(t,s){if(t&1&&(b(0),a(1,"div",38)(2,"div",39)(3,"div",40)(4,"mat-icon",41),r(5),n()(),g(6,K,1,1,"div",42),n(),a(7,"div",43)(8,"div",44)(9,"span",45),r(10),n(),a(11,"span",46),r(12),n()(),a(13,"div",47),g(14,Q,2,1,"p",48)(15,V,2,0,"p",49)(16,W,2,0,"p",49),n()()(),_()),t&2){let e=s.$implicit,l=s.last,o=c(3);i(3),d("ngClass",o.getCategoryCfg(e.category).classes),i(2),x(o.getCategoryCfg(e.category).icon),i(),d("ngIf",!l),i(),k("pb-0",l),i(2),d("ngClass",o.getCategoryCfg(e.category).classes),i(),m(" ",o.getCategoryCfg(e.category).label," "),i(),d("matTooltip",o.formatDate(e.createdAt)),i(),m(" ",o.formatRelative(e.createdAt)," "),i(2),d("ngIf",e.publicLog),i(),d("ngIf",!e.publicLog&&e.automaticMessage),i(),d("ngIf",!e.publicLog&&!e.automaticMessage)}}function Y(t,s){if(t&1&&(a(0,"div",36),g(1,X,17,12,"ng-container",37),n()),t&2){let e=c(2);i(),d("ngForOf",e.logs)}}function Z(t,s){if(t&1&&(b(0),a(1,"div",13)(2,"div",14)(3,"div",15)(4,"div",16)(5,"h2",17),r(6),n(),a(7,"p",18),r(8),n()(),a(9,"span",19),f(10,"span",20),r(11),n()()(),a(12,"div",21)(13,"div",22)(14,"span",23),r(15,"Started"),n(),a(16,"span",24),r(17),n()(),a(18,"div",22)(19,"span",23),r(20,"Duration"),n(),a(21,"span",24),r(22),n()(),g(23,H,5,1,"div",25),n()(),a(24,"div",26)(25,"h3",27)(26,"mat-icon",28),r(27,"timeline"),n(),r(28," Incident Log "),a(29,"span",29),r(30),n()(),g(31,J,7,0,"div",30)(32,Y,2,1,"div",31),n(),_()),t&2){let e=c();i(6),m(" ",e.getServiceName()," "),i(2),m(" ",e.incident.code," "),i(),d("ngClass",e.getStatusCfg(e.incident.status).classes),i(),d("ngClass",e.getStatusCfg(e.incident.status).dotClass),i(),m(" ",e.getStatusCfg(e.incident.status).label," "),i(6),x(e.formatDate(e.incident.startDate)),i(5),x(e.formatDuration(e.incident.duration)),i(),d("ngIf",e.incident.endDate),i(7),w(" ",e.logs.length," update",e.logs.length!==1?"s":""," "),i(),d("ngIf",e.logs.length===0),i(),d("ngIf",e.logs.length>0)}}var _e=(()=>{class t{constructor(){this._service=p(U),this._route=p(A),this._router=p(F),this._cdr=p(S),this._unsubscribeAll=new h,this.loading=!0,this.incident=null,this.logs=[],this.categoryConfig={investigating:{label:"Investigating",icon:"search",classes:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800",connectorClass:"bg-blue-300 dark:bg-blue-700"},identified:{label:"Identified",icon:"manage_search",classes:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400 border-orange-200 dark:border-orange-800",connectorClass:"bg-orange-300 dark:bg-orange-700"},fixing:{label:"Fixing",icon:"build",classes:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800",connectorClass:"bg-yellow-300 dark:bg-yellow-700"},resolved:{label:"Resolved",icon:"check_circle",classes:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800",connectorClass:"bg-green-300 dark:bg-green-700"},privateNote:{label:"Note",icon:"sticky_note_2",classes:"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400 border-gray-200 dark:border-gray-700",connectorClass:"bg-gray-300 dark:bg-gray-700"}},this.statusConfig={down:{label:"Down",classes:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",dotClass:"bg-red-500 animate-pulse"},review:{label:"Under Review",classes:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",dotClass:"bg-yellow-500 animate-pulse"},up:{label:"Resolved",classes:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",dotClass:"bg-green-500"},closed:{label:"Closed",classes:"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400",dotClass:"bg-gray-400"}}}ngOnInit(){let e=this._route.snapshot.paramMap.get("id");e&&this._loadIncident(e)}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}_loadIncident(e){this._service.getIncidents({_id:e,populates:["appFeature","resolution"]}).pipe(u(this._unsubscribeAll)).subscribe({next:l=>{let o=l.data||l;this.incident=Array.isArray(o)?o[0]:o,this._loadLogs(e)},error:()=>{this.loading=!1,this._cdr.markForCheck()}})}_loadLogs(e){this._service.getIncidentLogs({where_incident:e,sort:"createdAt"}).pipe(u(this._unsubscribeAll)).subscribe({next:l=>{let o=l.data||l||[];this.logs=o.filter(v=>v.category!=="privateNote"),this.loading=!1,this._cdr.markForCheck()},error:()=>{this.loading=!1,this._cdr.markForCheck()}})}getCategoryCfg(e){return this.categoryConfig[e]??this.categoryConfig.investigating}getStatusCfg(e){return this.statusConfig[e]??this.statusConfig.closed}getServiceName(){return this.incident?.appFeature?.name||this.incident?.code||"Unknown Service"}formatDate(e){return e?y.fromISO(e).toLocaleString(y.DATETIME_MED):"N/A"}formatRelative(e){return e?y.fromISO(e).toRelative()??"":""}formatDuration(e){if(!e)return"\u2014";if(e<60)return`${e}m`;let l=Math.floor(e/60),o=e%60;return o?`${l}h ${o}m`:`${l}h`}goBack(){this._router.navigate(["/smart-monitor/incidents"])}static{this.\u0275fac=function(l){return new(l||t)}}static{this.\u0275cmp=C({type:t,selectors:[["incident-detail"]],decls:10,vars:3,consts:[[1,"flex","flex-col","flex-auto","min-w-0","bg-gray-50","dark:bg-gray-900","min-h-screen"],[1,"flex","flex-col","w-full","max-w-3xl","mx-auto","p-6","md:p-8"],[1,"mb-6"],["mat-button","",1,"-ml-2","text-gray-500","hover:text-gray-900","dark:hover:text-white",3,"click"],[1,"icon-size-4","mr-1"],["class","flex flex-auto justify-center items-center py-24",4,"ngIf"],["class","flex flex-col items-center justify-center py-24 text-center",4,"ngIf"],[4,"ngIf"],[1,"flex","flex-auto","justify-center","items-center","py-24"],["diameter","56"],[1,"flex","flex-col","items-center","justify-center","py-24","text-center"],[1,"icon-size-16","text-gray-300","dark:text-gray-600","mb-4"],[1,"text-lg","font-medium","text-gray-600","dark:text-gray-400"],[1,"bg-white","dark:bg-gray-800","rounded-2xl","shadow-sm","border","border-gray-200","dark:border-gray-700","overflow-hidden","mb-8"],[1,"p-6","border-b","border-gray-100","dark:border-gray-700/50"],[1,"flex","items-start","justify-between","gap-4"],[1,"min-w-0"],[1,"text-xl","font-bold","text-gray-900","dark:text-white","leading-tight"],[1,"text-sm","text-gray-400","font-mono","mt-0.5"],[1,"flex-shrink-0","inline-flex","items-center","gap-2","px-3","py-1.5","rounded-full","text-sm","font-semibold",3,"ngClass"],[1,"w-2","h-2","rounded-full",3,"ngClass"],[1,"grid","grid-cols-2","sm:grid-cols-3","gap-0","divide-x","divide-y","divide-gray-100","dark:divide-gray-700/50"],[1,"px-5","py-4","flex","flex-col","gap-0.5"],[1,"text-xs","font-semibold","uppercase","tracking-wide","text-gray-400"],[1,"text-sm","font-medium","text-gray-800","dark:text-gray-200"],["class","px-5 py-4 flex flex-col gap-0.5",4,"ngIf"],[1,"mb-4"],[1,"text-base","font-semibold","text-gray-700","dark:text-gray-300","mb-5","flex","items-center","gap-2"],[1,"icon-size-5","text-gray-400"],[1,"ml-2","text-xs","font-medium","bg-gray-100","dark:bg-gray-700","text-gray-500","dark:text-gray-400","px-2","py-0.5","rounded-full"],["class","flex flex-col items-center justify-center py-12 text-center bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700",4,"ngIf"],["class","relative flex flex-col gap-0",4,"ngIf"],[1,"flex","flex-col","items-center","justify-center","py-12","text-center","bg-white","dark:bg-gray-800","rounded-2xl","border","border-gray-200","dark:border-gray-700"],[1,"icon-size-12","text-gray-300","dark:text-gray-600","mb-3"],[1,"text-gray-500","dark:text-gray-400"],[1,"text-gray-400","dark:text-gray-500","text-sm","mt-1"],[1,"relative","flex","flex-col","gap-0"],[4,"ngFor","ngForOf"],[1,"flex","gap-4"],[1,"flex","flex-col","items-center","flex-shrink-0"],[1,"flex","items-center","justify-center","w-8","h-8","rounded-full","border-2","z-10",3,"ngClass"],[1,"icon-size-4"],["class","timeline-connector w-0.5 flex-auto my-1 min-h-[1.5rem]",3,"ngClass",4,"ngIf"],[1,"flex-auto","pb-6"],[1,"flex","flex-wrap","items-center","gap-2","mb-2"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-semibold","border",3,"ngClass"],[1,"text-xs","text-gray-400","dark:text-gray-500",3,"matTooltip"],[1,"bg-white","dark:bg-gray-800","rounded-xl","border","border-gray-200","dark:border-gray-700","px-4","py-3","text-sm","text-gray-700","dark:text-gray-300","leading-relaxed"],["class","whitespace-pre-wrap",4,"ngIf"],["class","text-gray-400 italic text-xs",4,"ngIf"],[1,"timeline-connector","w-0.5","flex-auto","my-1","min-h-[1.5rem]",3,"ngClass"],[1,"whitespace-pre-wrap"],[1,"text-gray-400","italic","text-xs"]],template:function(l,o){l&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),I("click",function(){return o.goBack()}),a(4,"mat-icon",4),r(5,"arrow_back"),n(),r(6," Back to Incidents "),n()(),g(7,q,2,0,"div",5)(8,G,5,0,"div",6)(9,Z,33,12,"ng-container",7),n()()),l&2&&(i(7),d("ngIf",o.loading),i(),d("ngIf",!o.loading&&!o.incident),i(),d("ngIf",!o.loading&&o.incident))},dependencies:[T,E,D,M,R,P,B,j,N,O,L,z,$],styles:["incident-detail[_ngcontent-%COMP%]{display:block}.timeline-connector[_ngcontent-%COMP%]{width:2px;flex-shrink:0}"],changeDetection:0})}}return t})();export{_e as IncidentDetailComponent};
