import{a as Pe,b as Be,c as Ie}from"./chunk-VPUS4F4G.js";import{a as Ee}from"./chunk-SD536L7G.js";import{a as ue,b as _e}from"./chunk-XJE64V44.js";import{j as fe}from"./chunk-QQNGCN5G.js";import"./chunk-3RK6DDJD.js";import"./chunk-QD66ZOCP.js";import{d as we}from"./chunk-IEVXMBCH.js";import{a as ye,b as Se}from"./chunk-MVXXFAEU.js";import{a as xe,b as ge}from"./chunk-53WRULVM.js";import{c as pe,d as me}from"./chunk-YTRC6VXI.js";import{b as ie,d as ne,i as oe}from"./chunk-QIQIZ3Q6.js";import{m as re}from"./chunk-CTJ3YQQD.js";import"./chunk-ZAUDAUJV.js";import{A as ve,c as he,h as Ce,l as be}from"./chunk-QWR6CIPV.js";import"./chunk-MVN6OMHF.js";import{U as ae,V as le,X as se,Z as ce,_ as de}from"./chunk-KMUH6FME.js";import{$c as ee,Cb as I,Db as E,Dc as V,Eb as o,Fb as a,Ga as S,Gb as R,Kb as P,Mb as h,Nb as c,Oc as X,Rb as Y,Sb as Z,Tb as H,Wa as r,Xb as l,Yb as f,Zb as u,_b as A,cd as te,f as z,fb as G,ga as q,hc as k,ic as K,lb as g,lc as W,oc as m,p as j,pc as _,qa as b,qc as T,ra as v,sb as y,ub as $,wb as L,zb as x}from"./chunk-BMVGBJ55.js";import{a as J,i as D}from"./chunk-66YHNWRR.js";var Fe=["rowDetailPanel"],Ve=(i,s,e,t,n)=>({"bg-emerald-100 text-emerald-700":i,"bg-amber-100 text-amber-700":s,"bg-blue-100 text-blue-700":e,"bg-red-100 text-red-700":t,"bg-gray-100 text-gray-600":n}),N=i=>({index:i}),O=i=>({step:i}),Me=(i,s)=>({step:i,code:s}),Q=(i,s)=>s.sequence,U=(i,s)=>s.rowIndex,Re=(i,s)=>s.label,$e=(i,s)=>s.step;function De(i,s){i&1&&(o(0,"mat-icon",20),l(1,"refresh"),a(),l(2),m(3,"transloco")),i&2&&(r(2),u(" ",_(3,1,"batchProcessing.starting")," "))}function je(i,s){i&1&&(o(0,"mat-icon"),l(1,"play_arrow"),a(),l(2),m(3,"transloco")),i&2&&(r(2),u(" ",_(3,1,"batchProcessing.startProcessing")," "))}function qe(i,s){if(i&1){let e=P();o(0,"button",18),h("click",function(){b(e);let n=c();return v(n.startProcessing())}),o(1,"span",19),g(2,De,4,3)(3,je,4,3),a()()}if(i&2){let e=c();y("disabled",e.isStarting()),r(2),x(e.isStarting()?2:3)}}function Ne(i,s){if(i&1){let e=P();o(0,"button",21),h("click",function(){b(e);let n=c();return v(n.pauseProcessing())}),o(1,"span",19)(2,"mat-icon"),l(3,"pause"),a(),l(4),m(5,"transloco"),a()()}i&2&&(r(4),u(" ",_(5,1,"batchProcessing.pause")," "))}function Qe(i,s){if(i&1){let e=P();o(0,"button",22),h("click",function(){b(e);let n=c();return v(n.generateReport())}),o(1,"span",19)(2,"mat-icon"),l(3,"description"),a(),l(4),m(5,"transloco"),a()()}i&2&&(r(4),u(" ",_(5,1,"batchProcessing.generateReport")," "))}function Le(i,s){if(i&1&&(o(0,"div",15)(1,"div",23)(2,"span"),l(3),m(4,"transloco"),a(),o(5,"span"),l(6),a()(),R(7,"mat-progress-bar",24),a()),i&2){let e=c();r(3),f(_(4,3,"batchProcessing.processing")),r(3),u("",e.progress(),"%"),r(),y("value",e.progress())}}function Ae(i,s){if(i&1&&(o(0,"span",33),l(1),a()),i&2){let e=c().$implicit,t=c(2);y("matTooltip",t.getStepUrl(e)),r(),u(" ",t.getStepUrl(e)," ")}}function Oe(i,s){if(i&1&&(o(0,"span",34),l(1),m(2,"number"),m(3,"transloco"),a()),i&2){let e=c().$implicit,t=c(2);r(),A(" ",T(2,2,t.getStepPrice(e),"1.2-2")," ",_(3,5,"batchProcessing.credits")," ")}}function Ue(i,s){i&1&&(o(0,"mat-icon",35),l(1,"arrow_forward"),a())}function Je(i,s){if(i&1&&(o(0,"div",29)(1,"div",30),l(2),a(),o(3,"div",31)(4,"span",32),l(5),a(),g(6,Ae,2,2,"span",33)(7,Oe,4,7,"span",34),a()(),g(8,Ue,2,0,"mat-icon",35)),i&2){let e=s.$implicit,t=s.$index,n=c(2);r(2),u(" ",e.sequence," "),r(2),y("matTooltip",n.getStepName(e)),r(),u(" ",n.getStepName(e)," "),r(),x(n.getStepUrl(e)?6:-1),r(),x(n.getStepPrice(e)>0?7:-1),r(),x(t<n.configSteps().length-1?8:-1)}}function ze(i,s){if(i&1){let e=P();o(0,"div",51),h("click",function(){b(e);let n=c(3);return v(n.setRecordFilter("failed"))}),o(1,"div",52)(2,"mat-icon",53),l(3,"error"),a()(),o(4,"div",40)(5,"p",54),l(6),m(7,"transloco"),a(),o(8,"p",55),l(9),o(10,"span",56),l(11),m(12,"transloco"),a()()()()}if(i&2){let e=c(3);$("ring-2",e.recordFilter()==="failed")("ring-red-400",e.recordFilter()==="failed"),r(6),u(" ",_(7,7,"batchProcessing.failed")," "),r(3),u(" ",e.failedRows().length," "),r(2),f(_(12,9,"batchProcessing.requestsFailed"))}}function Ge(i,s){if(i&1){let e=P();o(0,"div",28)(1,"div",36)(2,"div",37)(3,"div",38)(4,"mat-icon",39),l(5,"payments"),a()(),o(6,"div",40)(7,"p",41),l(8),m(9,"transloco"),a(),o(10,"p",42),l(11),m(12,"number"),o(13,"span",43),l(14),m(15,"transloco"),a()()()(),o(16,"div",44),h("click",function(){b(e);let n=c(2);return v(n.setRecordFilter("completed"))}),o(17,"div",45)(18,"mat-icon",46),l(19,"check_circle"),a()(),o(20,"div",40)(21,"p",47),l(22),m(23,"transloco"),a(),o(24,"p",48),l(25),o(26,"span",49),l(27),m(28,"transloco"),a()()()(),g(29,ze,13,11,"div",50),a()()}if(i&2){let e=c(2);r(8),u(" ",_(9,11,"batchProcessing.totalCost")," "),r(3),u(" ",T(12,13,e.totalCreditsCost(),"1.2-2")," "),r(3),f(_(15,16,"batchProcessing.credits")),r(2),$("ring-2",e.recordFilter()==="completed")("ring-emerald-400",e.recordFilter()==="completed"),r(6),u(" ",_(23,18,"batchProcessing.successful")," "),r(3),u(" ",e.completedRows().length," "),r(2),f(_(28,20,"batchProcessing.requestsSuccessful")),r(2),x(e.failedRows().length>0?29:-1)}}function Ye(i,s){if(i&1&&(o(0,"div",3)(1,"div",25)(2,"h3",26),l(3),m(4,"transloco"),a(),o(5,"div",27),I(6,Je,9,6,null,null,Q),a(),g(8,Ge,30,22,"div",28),a()()),i&2){let e=c();r(3),u(" ",_(4,2,"batchProcessing.processingSteps")," "),r(3),E(e.configSteps()),r(2),x(e.completedRows().length>0||e.failedRows().length>0?8:-1)}}function Ze(i,s){i&1&&(o(0,"div",17),R(1,"mat-spinner",57),a())}function He(i,s){if(i&1){let e=P();o(0,"button",62),h("click",function(){b(e);let n=c(2);return v(n.setRecordFilter("failed"))}),o(1,"span",64),R(2,"span",77),l(3),m(4,"transloco"),o(5,"span",66),l(6),a()()()}if(i&2){let e=c(2);y("ngClass",e.recordFilter()==="failed"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"),r(3),u(" ",_(4,3,"batchProcessing.failed")," "),r(3),f(e.failedRows().length)}}function Ke(i,s){if(i&1){let e=P();o(0,"button",78),h("click",function(){b(e);let n=c(2);return v(n.updateSearchQuery(""))}),o(1,"mat-icon",79),l(2,"close"),a()()}}function We(i,s){if(i&1){let e=P();o(0,"div",81),h("click",function(){let n=b(e).$implicit,p=c(3);return v(p.selectRow(n))}),o(1,"div",82)(2,"span",83),l(3),a(),o(4,"div",40)(5,"p",84),l(6),m(7,"transloco"),a()()(),o(8,"div",85)(9,"span",86),R(10,"span",87),l(11),m(12,"transloco"),a()()()}if(i&2){let e,t=s.$implicit,n=c(3);$("bg-indigo-50",((e=n.selectedRow())==null?null:e.rowIndex)===t.rowIndex),r(3),u(" ",t.rowIndex+1," "),r(3),u(" ",(t.inputData==null?null:t.inputData.documentNumber)||(t.inputData==null?null:t.inputData.name)||T(7,5,"batchProcessing.rowNumber",k(10,N,t.rowIndex+1))," "),r(5),u(" ",_(12,8,"batchProcessing."+t.status)," ")}}function Xe(i,s){if(i&1&&I(0,We,13,12,"div",80,U),i&2){let e=c(2);E(e.pendingRows())}}function et(i,s){if(i&1&&(o(0,"div",91)(1,"mat-icon",94),l(2,"check"),a()()),i&2){let e=s.$implicit,t=c(4);y("matTooltip",t.getStepName(e))}}function tt(i,s){if(i&1){let e=P();o(0,"div",81),h("click",function(){let n=b(e).$implicit,p=c(3);return v(p.selectRow(n))}),o(1,"div",82)(2,"span",88),l(3),a(),o(4,"div",40)(5,"p",84),l(6),m(7,"transloco"),a()()(),o(8,"div",89)(9,"div",90),I(10,et,3,1,"div",91,Q),a(),o(12,"span",92),R(13,"span",65),l(14),m(15,"transloco"),a(),o(16,"mat-icon",93),l(17,"chevron_right"),a()()()}if(i&2){let e,t=s.$implicit,n=c(3);$("bg-indigo-50",((e=n.selectedRow())==null?null:e.rowIndex)===t.rowIndex),r(3),u(" ",t.rowIndex+1," "),r(3),u(" ",(t.inputData==null?null:t.inputData.documentNumber)||(t.inputData==null?null:t.inputData.name)||T(7,5,"batchProcessing.rowNumber",k(10,N,t.rowIndex+1))," "),r(4),E(n.configSteps()),r(4),u(" ",_(15,8,"batchProcessing.verified")," ")}}function it(i,s){if(i&1&&I(0,tt,18,12,"div",80,U),i&2){let e=c(2);E(e.completedRows())}}function nt(i,s){if(i&1&&(o(0,"div",91),m(1,"transloco"),o(2,"mat-icon",94),l(3,"check"),a()()),i&2){let e=c().$implicit,t=c(4);y("matTooltip",T(1,1,"batchProcessing.stepStatusCompleted",k(4,O,t.getStepName(e))))}}function ot(i,s){if(i&1&&(o(0,"div",99),m(1,"transloco"),o(2,"mat-icon",101),l(3,"close"),a()()),i&2){let e=c().$implicit,t=c(4);y("matTooltip",T(1,1,"batchProcessing.stepStatusFailed",k(4,O,t.getStepName(e))))}}function rt(i,s){if(i&1&&(o(0,"div",100),m(1,"transloco"),o(2,"mat-icon",102),l(3,"remove"),a()()),i&2){let e=c().$implicit,t=c(4);y("matTooltip",T(1,1,"batchProcessing.stepStatusSkipped",k(4,O,t.getStepName(e))))}}function at(i,s){if(i&1&&g(0,nt,4,6,"div",91)(1,ot,4,6,"div",99)(2,rt,4,6,"div",100),i&2){let e,t=s.$implicit,n=c().$implicit,p=c(3);x((e=p.getRowStepStatus(n,t.sequence))==="completed"?0:e==="failed"?1:2)}}function lt(i,s){if(i&1){let e=P();o(0,"div",81),h("click",function(){let n=b(e).$implicit,p=c(3);return v(p.selectRow(n))}),o(1,"div",82)(2,"span",96),l(3),a(),o(4,"div",40)(5,"p",84),l(6),m(7,"transloco"),a(),o(8,"p",97),l(9),m(10,"transloco"),a()()(),o(11,"div",89)(12,"div",90),I(13,at,3,1,null,null,Q),a(),o(15,"span",98),R(16,"span",77),l(17),m(18,"transloco"),a(),o(19,"mat-icon",93),l(20,"chevron_right"),a()()()}if(i&2){let e,t=s.$implicit,n=c(3);$("bg-red-50",((e=n.selectedRow())==null?null:e.rowIndex)===t.rowIndex),r(3),u(" ",t.rowIndex+1," "),r(3),u(" ",(t.inputData==null?null:t.inputData.documentNumber)||(t.inputData==null?null:t.inputData.name)||T(7,6,"batchProcessing.rowNumber",k(13,N,t.rowIndex+1))," "),r(3),u(" ",(t.errors==null||t.errors[0]==null?null:t.errors[0].message)||_(10,9,"batchProcessing.failed")," "),r(4),E(n.configSteps()),r(4),u(" ",_(18,11,"batchProcessing.failed")," ")}}function st(i,s){if(i&1&&I(0,lt,21,15,"div",95,U),i&2){let e=c(2);E(e.failedRows())}}function ct(i,s){i&1&&(l(0),m(1,"transloco")),i&2&&u(" ",_(1,1,"batchProcessing.noResultsFound")," ")}function dt(i,s){i&1&&(l(0),m(1,"transloco")),i&2&&u(" ",_(1,1,"batchProcessing.noCompletedRecordsYet")," ")}function pt(i,s){if(i&1&&(o(0,"div",75)(1,"mat-icon",103),l(2),a(),o(3,"p",104),g(4,ct,2,3)(5,dt,2,3),a()()),i&2){let e=c(2);r(2),f(e.searchQuery()?"search_off":"hourglass_empty"),r(2),x(e.searchQuery()?4:5)}}function mt(i,s){i&1&&(o(0,"div",105)(1,"div",4),R(2,"div",106)(3,"div",107),a(),o(4,"div",108),R(5,"div",109),o(6,"div",110),R(7,"div",111)(8,"div",112)(9,"div",113),a()()())}function ut(i,s){if(i&1){let e=P();o(0,"button",126),h("click",function(){b(e);let n=c(4);return v(n.generateRowReport(n.selectedRow()))}),o(1,"mat-icon",127),l(2,"picture_as_pdf"),a(),l(3),m(4,"transloco"),a()}i&2&&(r(3),u(" ",_(4,1,"batchProcessing.generatePdfReport")," "))}function _t(i,s){if(i&1&&(o(0,"div",130)(1,"span",131),l(2),a(),o(3,"span",132),l(4),a()()),i&2){let e=s.$implicit;r(2),f(e.label),r(2),f(e.value)}}function xt(i,s){if(i&1&&(o(0,"div",128),I(1,_t,5,2,"div",130,Re),a()),i&2){let e=c(5);r(),E(e.getInputDataFields())}}function gt(i,s){i&1&&(o(0,"p",129),l(1,"\u2014"),a())}function ft(i,s){if(i&1&&(o(0,"div",124),g(1,xt,3,0,"div",128)(2,gt,2,0,"p",129),a()),i&2){let e=c(4);r(),x(e.getInputDataFields().length>0?1:2)}}function ht(i,s){if(i&1&&(o(0,"pre",125),l(1),a()),i&2){let e,t=c(4);r(),f(t.formatJson((e=t.selectedRow())==null?null:e.inputData))}}function Ct(i,s){if(i&1&&(o(0,"div",130)(1,"span",131),l(2),a(),o(3,"span",132),l(4),a()()),i&2){let e=s.$implicit;r(2),f(e.label),r(2),f(e.value)}}function bt(i,s){if(i&1&&(o(0,"div",139)(1,"div",128),I(2,Ct,5,2,"div",130,Re),a()()),i&2){let e,t=c(2).$implicit,n=c(5);r(2),E(n.getStepResultFields((e=n.selectedRow())==null||e.results==null?null:e.results[t.sequence]))}}function vt(i,s){if(i&1&&(o(0,"div",139)(1,"pre",140),l(2),a()()),i&2){let e,t=c(2).$implicit,n=c(5);r(2),f(n.formatJson((e=n.selectedRow())==null||e.results==null?null:e.results[t.sequence]))}}function wt(i,s){if(i&1&&g(0,bt,4,0,"div",139)(1,vt,3,1,"div",139),i&2){let e=c(6);x(e.detailsViewMode()==="readable"?0:1)}}function yt(i,s){if(i&1&&(o(0,"div",134)(1,"div",135)(2,"div",89)(3,"div",136),l(4),a(),o(5,"span",137),l(6),a()(),o(7,"span",138),l(8),m(9,"transloco"),a()(),g(10,wt,2,1),a()),i&2){let e,t=s.$implicit,n=c(5);r(3),L(n.getRowStepStatus(n.selectedRow(),t.sequence)==="completed"?"bg-emerald-100 text-emerald-600":n.getRowStepStatus(n.selectedRow(),t.sequence)==="failed"?"bg-red-100 text-red-600":"bg-gray-100 text-gray-500"),r(),u(" ",t.sequence," "),r(2),f(n.getStepName(t)),r(),L(n.getRowStepStatus(n.selectedRow(),t.sequence)==="completed"?"bg-emerald-100 text-emerald-600":n.getRowStepStatus(n.selectedRow(),t.sequence)==="failed"?"bg-red-100 text-red-600":"bg-gray-100 text-gray-500"),r(),u(" ",_(9,8,"batchProcessing."+n.getRowStepStatus(n.selectedRow(),t.sequence))," "),r(2),x(!((e=n.selectedRow())==null||e.results==null)&&e.results[t.sequence]?10:-1)}}function St(i,s){if(i&1&&(o(0,"div",121)(1,"h4",122),l(2),m(3,"transloco"),a(),o(4,"div",133),I(5,yt,11,10,"div",134,Q),a()()),i&2){let e=c(4);r(2),u(" ",_(3,1,"batchProcessing.stepResults")," "),r(3),E(e.configSteps())}}function Pt(i,s){if(i&1&&(o(0,"div",143)(1,"p",144),l(2),m(3,"transloco"),a(),o(4,"p",145),l(5),a()()),i&2){let e=s.$implicit;r(2),u(" ",T(3,2,"batchProcessing.stepError",K(5,Me,e.step,e.code))," "),r(3),u(" ",e.message," ")}}function Bt(i,s){if(i&1&&(o(0,"div")(1,"h4",141),l(2),m(3,"transloco"),a(),o(4,"div",142),I(5,Pt,6,8,"div",143,$e),a()()),i&2){let e=c(4);r(2),u(" ",_(3,1,"batchProcessing.errors")," "),r(3),E(e.selectedRow().errors)}}function It(i,s){if(i&1){let e=P();o(0,"div",114)(1,"h3",115),l(2),m(3,"transloco"),a(),o(4,"div",89)(5,"mat-button-toggle-group",116),h("change",function(n){b(e);let p=c(3);return v(p.detailsViewMode.set(n.value))}),o(6,"mat-button-toggle",117),l(7),m(8,"transloco"),a(),o(9,"mat-button-toggle",118),l(10),m(11,"transloco"),a()(),g(12,ut,5,3,"button",119),o(13,"button",120),h("click",function(){b(e);let n=c(3);return v(n.selectedRow.set(null))}),o(14,"mat-icon"),l(15,"close"),a()()()(),o(16,"div",121)(17,"h4",122),l(18),m(19,"transloco"),a(),o(20,"div",123),g(21,ft,3,1,"div",124)(22,ht,2,1,"pre",125),a()(),g(23,St,7,3,"div",121)(24,Bt,7,3,"div")}if(i&2){let e,t,n,p,d=c(3);r(2),u(" ",T(3,9,"batchProcessing.rowDetails",k(18,N,((e=(e=d.selectedRow())==null?null:e.rowIndex)!==null&&e!==void 0?e:0)+1))," "),r(3),y("value",d.detailsViewMode()),r(2),f(_(8,12,"batchProcessing.readable")),r(3),f(_(11,14,"batchProcessing.json")),r(2),x(((t=d.selectedRow())==null?null:t.status)==="completed"?12:-1),r(6),u(" ",_(19,16,"batchProcessing.inputData")," "),r(3),x(d.detailsViewMode()==="readable"?21:22),r(2),x(d.configSteps().length>0&&((n=d.selectedRow())!=null&&n.results)?23:-1),r(),x((p=d.selectedRow())!=null&&p.errors&&d.selectedRow().errors.length>0?24:-1)}}function Et(i,s){if(i&1&&(o(0,"div",76,0),g(2,mt,10,0,"div",105)(3,It,25,20),a()),i&2){let e=c(2);r(2),x(e.isLoadingDetail()?2:3)}}function Rt(i,s){if(i&1){let e=P();o(0,"div",58)(1,"div",59)(2,"div",60)(3,"div",61)(4,"button",62),h("click",function(){b(e);let n=c();return v(n.setRecordFilter("all"))}),l(5),m(6,"transloco"),o(7,"span",63),l(8),a()(),o(9,"button",62),h("click",function(){b(e);let n=c();return v(n.setRecordFilter("completed"))}),o(10,"span",64),R(11,"span",65),l(12),m(13,"transloco"),o(14,"span",66),l(15),a()()(),g(16,He,7,5,"button",67),a(),o(17,"div",68)(18,"mat-icon",69),l(19,"search"),a(),o(20,"input",70),m(21,"transloco"),h("ngModelChange",function(n){b(e);let p=c();return v(p.updateSearchQuery(n))}),a(),g(22,Ke,3,0,"button",71),a()()(),o(23,"div",72)(24,"span",73),l(25),m(26,"transloco"),a(),o(27,"span",73),l(28),m(29,"transloco"),a()(),o(30,"div",74),g(31,Xe,2,0)(32,it,2,0)(33,st,2,0)(34,pt,6,2,"div",75),a()(),g(35,Et,4,1,"div",76)}if(i&2){let e,t=c();r(4),y("ngClass",t.recordFilter()==="all"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"),r(),u(" ",_(6,17,"batchProcessing.all")," "),r(3),f(((e=t.batch())==null?null:e.totalRows)||0),r(),y("ngClass",t.recordFilter()==="completed"?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"),r(3),u(" ",_(13,19,"batchProcessing.successful")," "),r(3),f(t.completedRows().length),r(),x(t.failedRows().length>0?16:-1),r(4),y("ngModel",t.searchQuery())("placeholder",_(21,21,"smartReport.searchRecords")),r(2),x(t.searchQuery()?22:-1),r(3),f(_(26,23,"batchProcessing.records")),r(3),f(_(29,25,"batchProcessing.status")),r(3),x(t.recordFilter()==="all"?31:-1),r(),x(t.recordFilter()!=="failed"?32:-1),r(),x(t.recordFilter()!=="completed"?33:-1),r(),x(t.pendingRows().length===0&&t.completedRows().length===0&&t.failedRows().length===0?34:-1),r(),x(t.selectedRow()?35:-1)}}var oi=(()=>{class i{constructor(){this._route=q(ie),this._router=q(ne),this._smartBatchService=q(Ee),this._destroy$=new z,this._processingAborted=!1,this.configId=S(null),this.batchId=S(null),this.batch=S(null),this.configuration=S(null),this.isLoading=S(!0),this.isProcessing=S(!1),this.isStarting=S(!1),this.currentRowIndex=S(null),this.currentStepIndex=S(null),this.configSteps=V(()=>{let e=this.configuration();return e?.steps?e.steps.filter(t=>t.enabled).sort((t,n)=>t.sequence-n.sequence):[]}),this.pendingRows=V(()=>{let e=this.batch();if(!e?.rows)return[];let t=this.searchQuery().toLowerCase().trim(),n=e.rows.filter(p=>p.status==="pending"||p.status==="processing");return t&&(n=n.filter(p=>this._matchesSearch(p,t))),n}),this.completedRows=V(()=>{let e=this.batch();if(!e?.rows)return[];let t=this.searchQuery().toLowerCase().trim(),n=e.rows.filter(p=>p.status==="completed");return t&&(n=n.filter(p=>this._matchesSearch(p,t))),n}),this.failedRows=V(()=>{let e=this.batch();if(!e?.rows)return[];let t=this.searchQuery().toLowerCase().trim(),n=e.rows.filter(p=>p.status==="failed");return t&&(n=n.filter(p=>this._matchesSearch(p,t))),n}),this.totalCreditsCost=V(()=>{let e=this.completedRows().length;if(e===0)return 0;let n=this.configSteps().reduce((p,d)=>p+this.getStepPrice(d),0);return e*n}),this.progress=V(()=>{let e=this.batch();return!e||e.totalRows===0?0:Math.round((e.completedRows+e.failedRows)/e.totalRows*100)}),this.selectedRow=S(null),this.detailsViewMode=S("readable"),this.isLoadingDetail=S(!1),this.recordFilter=S("all"),this.searchQuery=S("")}ngOnInit(){this._route.params.subscribe(e=>{this.configId.set(e.configId),this.batchId.set(e.batchId),this._loadConfiguration(),this._loadBatch()})}ngOnDestroy(){this._processingAborted=!0,this._destroy$.next(),this._destroy$.complete()}_loadConfiguration(){let e=this.configId();e&&this._smartBatchService.getConfiguration(e).subscribe({next:t=>{this.configuration.set(t.data)}})}_loadBatch(){let e=this.batchId();e&&(this.isLoading.set(!0),this._smartBatchService.getSmartBatch(e).subscribe({next:t=>{this.batch.set(t.data),this.isLoading.set(!1),t.data.status==="processing"&&!this.isProcessing()&&(console.log("Resuming processing for batch:",e),this.isProcessing.set(!0),this._processRows())},error:t=>{console.error("Failed to load batch:",t),this.isLoading.set(!1)}}))}startProcessing(){return D(this,null,function*(){let e=this.batchId();if(e){this.isStarting.set(!0),this._processingAborted=!1;try{let t=yield j(this._smartBatchService.updateSmartBatch(e,{status:"processing"}));this.batch.set(t.data),this.isStarting.set(!1),this.isProcessing.set(!0),yield this._processRows()}catch(t){console.error("Failed to start processing:",t),this.isStarting.set(!1)}}})}_processRows(){return D(this,null,function*(){for(;!this.configuration()&&!this._processingAborted;)yield new Promise(n=>setTimeout(n,100));let e=this.batch(),t=this.configSteps();if(!e||t.length===0){this.isProcessing.set(!1);return}console.log(`Starting/Resuming processing for ${e.rows.length} rows`);for(let n of e.rows){if(this._processingAborted)break;n.status==="completed"||n.status==="failed"||(this.currentRowIndex.set(n.rowIndex),yield this._processRow(n,t))}this._loadBatch(),this.isProcessing.set(!1),this.currentRowIndex.set(null),this.currentStepIndex.set(null)})}_processRow(e,t){return D(this,null,function*(){let n=this.batchId();if(!n)return;let p={},d=[],C=!1;for(let w of t){if(this._processingAborted||C)break;this.currentStepIndex.set(w.sequence);try{let B=this._buildStepParams(e.inputData,w),M=w.appFeature,F=M?.url,Te=M?.method||"GET";if(!F)throw new Error(`Step ${w.sequence} has no URL configured`);let ke=yield j(this._smartBatchService.executeFeatureRequest(F,Te,B));p[w.sequence]=ke.data}catch(B){console.error(`Step ${w.sequence} failed for row ${e.rowIndex}:`,B),d.push({step:w.sequence,message:B?.error?.message||B?.message||"Step execution failed",code:B?.error?.code||"STEP_ERROR"}),this.configuration()?.mergeStrategy==="sequential"&&(C=!0)}}try{let w=yield j(this._smartBatchService.updateBatchRow(n,e.rowIndex,{status:C?"failed":"completed",results:p,errors:d}));this.batch.set(w.data)}catch(w){console.error(`Failed to update row ${e.rowIndex}:`,w)}})}_buildStepParams(e,t){let n=J({},e);if(t.parameterDefaults&&Object.assign(n,t.parameterDefaults),t.inputFieldMapping){let p=t.inputFieldMapping;p instanceof Map?p.forEach((d,C)=>{e[C]!==void 0&&(n[d]=e[C])}):Object.entries(p).forEach(([d,C])=>{e[d]!==void 0&&(n[C]=e[d])})}return n}pauseProcessing(){this._processingAborted=!0,this.isProcessing.set(!1)}generateReport(){let e=this.configId(),t=this.batchId();e&&t&&this._router.navigate(["/smart-batch",e,"batch",t,"report"])}generateRowReport(e){let t=this.configId(),n=this.batchId();t&&n&&this._router.navigate(["/smart-batch",t,"batch",n,"report"],{queryParams:{rowIndex:e.rowIndex}})}updateSearchQuery(e){this.searchQuery.set(e)}_matchesSearch(e,t){return e.inputData&&JSON.stringify(e.inputData).toLowerCase().includes(t)?!0:e.results?JSON.stringify(e.results).toLowerCase().includes(t):!1}goBack(){let e=this.configId();e&&this._router.navigate(["/smart-batch",e])}selectRow(e){this.selectedRow.set(e),this.isLoadingDetail.set(!0),setTimeout(()=>{this.isLoadingDetail.set(!1),setTimeout(()=>{this.rowDetailPanel?.nativeElement?.scrollIntoView({behavior:"smooth",block:"start"})},50)},150)}setRecordFilter(e){this.recordFilter.set(e)}getStatusColor(e){switch(e){case"completed":return"text-emerald-600";case"failed":return"text-red-600";case"processing":return"text-amber-600";default:return"text-gray-400"}}getStatusIcon(e){switch(e){case"completed":return"check_circle";case"failed":return"error";case"processing":return"sync";default:return"pending"}}getStepName(e){let t=e.appFeature;return t?.name||t?.code||`Step ${e.sequence}`}getStepUrl(e){let t=e.appFeature;return t?.url||t?.endpoint||""}getStepPrice(e){let t=e.appFeature;return t?.price??t?.smartCheckPrice??0}getStepResultFields(e){if(e==null||typeof e!="object")return[{label:"Result",value:e!=null?String(e):"\u2014"}];let t=[];for(let n of Object.keys(e)){let p=n.replace(/([A-Z])/g," $1").replace(/^./,w=>w.toUpperCase()).trim(),d=e[n],C;d==null?C="\u2014":Array.isArray(d)?C=d.length===0?"\u2014":`[${d.length} item${d.length===1?"":"s"}]`:typeof d=="object"?C=typeof d=="object"&&d!==null&&Object.keys(d).length>0?`{ ${Object.keys(d).slice(0,3).join(", ")}${Object.keys(d).length>3?"\u2026":""} }`:"\u2014":C=String(d),t.push({label:p,value:C})}return t}getInputDataFields(){let e=this.selectedRow()?.inputData;return e==null||typeof e!="object"?[]:this.getStepResultFields(e)}formatJson(e){if(e==null)return"\u2014";try{return JSON.stringify(e,null,2)}catch{return String(e)}}getRowStepStatus(e,t){if(this.isProcessing()&&this.currentRowIndex()===e.rowIndex&&this.currentStepIndex()===t)return"pending";if(!e.results||typeof e.results!="object")return e.errors?.find(d=>d.step===t)?"failed":"pending";let n=e.results[t];return n==null?e.errors?.find(d=>d.step===t)?"failed":"pending":"completed"}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=G({type:i,selectors:[["batch-processing"]],viewQuery:function(t,n){if(t&1&&Y(Fe,5),t&2){let p;Z(p=H())&&(n.rowDetailPanel=p.first)}},decls:29,vars:26,consts:[["rowDetailPanel",""],[1,"min-h-screen","w-full","bg-gray-50"],[1,"bg-white","border-b","border-gray-200","sticky","top-0","z-10"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],["mat-icon-button","",3,"click","matTooltip"],[1,"flex","items-center","gap-2.5"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-xs","font-semibold","px-2.5","py-1","rounded-full",3,"ngClass"],[1,"text-sm","text-gray-500","mt-0.5"],[1,"flex","items-center","gap-3"],["mat-flat-button","","color","primary",1,"!rounded-xl",3,"disabled"],["mat-stroked-button","",1,"!rounded-xl"],["mat-flat-button","","color","accent",1,"!rounded-xl","!bg-indigo-600"],[1,"mt-4"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-6"],[1,"flex","items-center","justify-center","h-64"],["mat-flat-button","","color","primary",1,"!rounded-xl",3,"click","disabled"],[1,"inline-flex","items-center","gap-2"],[1,"animate-spin"],["mat-stroked-button","",1,"!rounded-xl",3,"click"],["mat-flat-button","","color","accent",1,"!rounded-xl","!bg-indigo-600",3,"click"],[1,"flex","justify-between","text-sm","text-gray-600","mb-1"],["mode","determinate",1,"!rounded-full",3,"value"],[1,"bg-white","rounded-xl","border","border-gray-200","p-5"],[1,"text-xs","font-semibold","text-gray-400","uppercase","tracking-wider","mb-3"],[1,"flex","items-stretch","gap-2","flex-wrap"],[1,"mt-4","pt-4","border-t","border-gray-100"],[1,"flex","items-center","gap-2.5","min-w-0","max-w-[320px]","sm:max-w-[360px]","px-3","py-2.5","bg-gray-50","rounded-lg","border-l-3","border-indigo-400","border","border-t-gray-200","border-r-gray-200","border-b-gray-200"],[1,"shrink-0","w-7","h-7","rounded-full","bg-indigo-100","flex","items-center","justify-center","text-xs","font-bold","text-indigo-600"],[1,"min-w-0","flex-1","flex","flex-col","gap-0.5"],[1,"text-sm","font-medium","text-gray-900","truncate",3,"matTooltip"],["matTooltipPosition","below",1,"text-xs","text-gray-400","font-mono","truncate",3,"matTooltip"],[1,"text-xs","text-indigo-600","font-medium","mt-0.5"],["aria-hidden","true",1,"text-gray-300","!text-base","shrink-0","self-center"],[1,"grid","grid-cols-2","sm:grid-cols-3","gap-3"],[1,"flex","items-center","gap-3","px-4","py-3","bg-indigo-50","rounded-lg"],[1,"shrink-0","w-9","h-9","rounded-lg","bg-indigo-100","flex","items-center","justify-center"],[1,"text-indigo-600","!text-xl"],[1,"min-w-0"],[1,"text-xs","text-indigo-500","font-medium"],[1,"text-lg","font-bold","text-indigo-700","leading-tight"],[1,"text-xs","font-medium"],[1,"flex","items-center","gap-3","px-4","py-3","bg-emerald-50","rounded-lg","cursor-pointer","transition-all","hover:shadow-md",3,"click"],[1,"shrink-0","w-9","h-9","rounded-lg","bg-emerald-100","flex","items-center","justify-center"],[1,"text-emerald-600","!text-xl"],[1,"text-xs","text-emerald-500","font-medium"],[1,"text-lg","font-bold","text-emerald-700","leading-tight"],[1,"text-xs","font-normal","text-emerald-500"],[1,"flex","items-center","gap-3","px-4","py-3","bg-red-50","rounded-lg","cursor-pointer","transition-all","hover:shadow-md",3,"ring-2","ring-red-400"],[1,"flex","items-center","gap-3","px-4","py-3","bg-red-50","rounded-lg","cursor-pointer","transition-all","hover:shadow-md",3,"click"],[1,"shrink-0","w-9","h-9","rounded-lg","bg-red-100","flex","items-center","justify-center"],[1,"text-red-600","!text-xl"],[1,"text-xs","text-red-500","font-medium"],[1,"text-lg","font-bold","text-red-700","leading-tight"],[1,"text-xs","font-normal","text-red-500"],["diameter","48"],[1,"bg-white","rounded-xl","border","border-gray-200","overflow-hidden","shadow-sm"],[1,"px-5","pt-4","pb-0"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-3"],[1,"flex","items-center","gap-1","bg-gray-100","rounded-lg","p-0.5"],[1,"px-3","py-1.5","text-sm","font-medium","rounded-md","transition-all",3,"click","ngClass"],[1,"ml-1","text-xs","text-gray-400"],[1,"inline-flex","items-center","gap-1"],[1,"w-1.5","h-1.5","rounded-full","bg-emerald-500"],[1,"text-xs","text-gray-400"],[1,"px-3","py-1.5","text-sm","font-medium","rounded-md","transition-all",3,"ngClass"],[1,"relative","w-full","sm:w-64"],[1,"absolute","left-2.5","top-1/2","-translate-y-1/2","!text-lg","text-gray-400","pointer-events-none"],[1,"w-full","h-9","pl-9","pr-8","text-sm","border","border-gray-200","rounded-lg","bg-gray-50","focus:bg-white","focus:border-indigo-400","focus:ring-1","focus:ring-indigo-400","outline-none","transition-all","placeholder-gray-400",3,"ngModelChange","ngModel","placeholder"],[1,"absolute","right-2","top-1/2","-translate-y-1/2","text-gray-400","hover:text-gray-600"],[1,"px-5","py-2.5","mt-2","border-b","border-gray-100","grid","grid-cols-[1fr_auto]","items-center"],[1,"text-xs","font-medium","text-gray-400","uppercase","tracking-wider"],[1,"max-h-[560px]","overflow-y-auto","divide-y","divide-gray-100"],[1,"py-16","text-center"],[1,"mt-6","bg-white","rounded-2xl","border","border-gray-200","p-6"],[1,"w-1.5","h-1.5","rounded-full","bg-red-500"],[1,"absolute","right-2","top-1/2","-translate-y-1/2","text-gray-400","hover:text-gray-600",3,"click"],[1,"!text-base","!w-4","!h-4"],[1,"group","px-5","py-3","grid","grid-cols-[1fr_auto]","items-center","hover:bg-gray-50","cursor-pointer","transition-colors",3,"bg-indigo-50"],[1,"group","px-5","py-3","grid","grid-cols-[1fr_auto]","items-center","hover:bg-gray-50","cursor-pointer","transition-colors",3,"click"],[1,"flex","items-center","gap-3","min-w-0"],[1,"shrink-0","w-7","h-7","rounded-md","bg-gray-100","flex","items-center","justify-center","text-xs","font-mono","text-gray-500"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"flex","items-center","gap-1.5"],[1,"inline-flex","items-center","gap-1","px-2","py-0.5","text-xs","font-medium","rounded-full","bg-gray-100","text-gray-600"],[1,"w-1.5","h-1.5","rounded-full","bg-gray-400","animate-pulse"],[1,"shrink-0","w-7","h-7","rounded-md","bg-emerald-50","flex","items-center","justify-center","text-xs","font-mono","text-emerald-600"],[1,"flex","items-center","gap-2"],[1,"hidden","sm:flex","items-center","gap-0.5","mr-1"],[1,"w-4","h-4","rounded-full","bg-emerald-100","flex","items-center","justify-center",3,"matTooltip"],[1,"inline-flex","items-center","gap-1","px-2","py-0.5","text-xs","font-medium","rounded-full","bg-emerald-50","text-emerald-700"],[1,"!text-base","text-gray-300","opacity-0","group-hover:opacity-100","transition-opacity"],[1,"text-emerald-600","!text-[10px]","!w-2.5","!h-2.5"],[1,"group","px-5","py-3","grid","grid-cols-[1fr_auto]","items-center","hover:bg-gray-50","cursor-pointer","transition-colors",3,"bg-red-50"],[1,"shrink-0","w-7","h-7","rounded-md","bg-red-50","flex","items-center","justify-center","text-xs","font-mono","text-red-600"],[1,"text-xs","text-gray-400","truncate"],[1,"inline-flex","items-center","gap-1","px-2","py-0.5","text-xs","font-medium","rounded-full","bg-red-50","text-red-700"],[1,"w-4","h-4","rounded-full","bg-red-100","flex","items-center","justify-center",3,"matTooltip"],[1,"w-4","h-4","rounded-full","bg-gray-100","flex","items-center","justify-center",3,"matTooltip"],[1,"text-red-600","!text-[10px]","!w-2.5","!h-2.5"],[1,"text-gray-400","!text-[10px]","!w-2.5","!h-2.5"],[1,"!text-5xl","!w-12","!h-12","text-gray-300","mb-3"],[1,"text-sm","text-gray-400"],[1,"animate-pulse","space-y-4"],[1,"h-5","bg-gray-200","rounded","w-40"],[1,"h-8","bg-gray-200","rounded","w-48"],[1,"space-y-3","pt-2"],[1,"h-4","bg-gray-100","rounded","w-24"],[1,"border","border-gray-100","rounded-lg","p-4","space-y-2"],[1,"h-3","bg-gray-100","rounded","w-full"],[1,"h-3","bg-gray-100","rounded","w-3/4"],[1,"h-3","bg-gray-100","rounded","w-1/2"],[1,"flex","items-center","justify-between","mb-4"],[1,"font-semibold","text-gray-900"],[1,"!rounded-lg",3,"change","value"],["value","readable"],["value","json"],["mat-flat-button","","color","primary",1,"!rounded-lg"],["mat-icon-button","",3,"click"],[1,"mb-6"],[1,"text-sm","font-medium","text-gray-500","mb-3"],[1,"border","border-gray-200","rounded-lg","overflow-hidden","bg-white"],[1,"px-4","py-3"],[1,"bg-gray-50","rounded-lg","p-4","text-sm","font-mono","text-gray-800","overflow-auto","max-h-64","m-0"],["mat-flat-button","","color","primary",1,"!rounded-lg",3,"click"],[1,"mr-2","icon-size-4"],[1,"space-y-0"],[1,"text-sm","text-gray-400","py-2"],[1,"flex","gap-4","py-2","border-b","border-gray-100","last:border-0","text-sm"],[1,"text-gray-500","min-w-[140px]","shrink-0"],[1,"text-gray-900","font-medium","break-words"],[1,"space-y-3"],[1,"border","border-gray-200","rounded-lg","overflow-hidden"],[1,"flex","items-center","justify-between","px-4","py-3","bg-gray-50"],[1,"w-6","h-6","rounded-full","flex","items-center","justify-center","text-xs","font-bold"],[1,"font-medium","text-gray-700"],[1,"text-xs","font-medium","px-2","py-1","rounded-full"],[1,"px-4","py-3","bg-white","border-t","border-gray-100"],[1,"bg-gray-50","rounded-lg","p-3","text-xs","font-mono","text-gray-800","overflow-auto","max-h-64","m-0"],[1,"text-sm","font-medium","text-red-500","mb-3"],[1,"space-y-2"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-3"],[1,"text-sm","font-medium","text-red-700"],[1,"text-sm","text-red-600"]],template:function(t,n){if(t&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"button",6),m(6,"transloco"),h("click",function(){return n.goBack()}),o(7,"mat-icon"),l(8,"arrow_back"),a()(),o(9,"div")(10,"div",7)(11,"h1",8),l(12),m(13,"transloco"),a(),o(14,"span",9),l(15),m(16,"transloco"),a()(),o(17,"p",10),l(18),m(19,"transloco"),a()()(),o(20,"div",11),g(21,qe,4,2,"button",12)(22,Ne,6,3,"button",13)(23,Qe,6,3,"button",14),a()(),g(24,Le,8,5,"div",15),a()(),g(25,Ye,9,4,"div",3),o(26,"div",16),g(27,Ze,2,0,"div",17)(28,Rt,36,27),a()()),t&2){let p,d,C,w,B,M,F;r(5),y("matTooltip",_(6,12,"batchProcessing.backToDashboard")),r(7),u(" ",((p=n.batch())==null?null:p.name)||_(13,14,"batchProcessing.batchProcessing")," "),r(2),y("ngClass",W(20,Ve,((d=n.batch())==null?null:d.status)==="completed",((d=n.batch())==null?null:d.status)==="pending"||((d=n.batch())==null?null:d.status)==="draft",((d=n.batch())==null?null:d.status)==="processing",((d=n.batch())==null?null:d.status)==="failed",((d=n.batch())==null?null:d.status)==="cancelled")),r(),u(" ",_(16,16,"batchProcessing."+(((C=n.batch())==null?null:C.status)||"pending"))," "),r(3),A(" ",((w=n.batch())==null?null:w.totalRows)||0," ",_(19,18,"batchProcessing.records")," "),r(3),x(((B=n.batch())==null?null:B.status)==="draft"||((B=n.batch())==null?null:B.status)==="pending"?21:-1),r(),x(((M=n.batch())==null?null:M.status)==="processing"?22:-1),r(),x(((F=n.batch())==null?null:F.status)==="completed"||((F=n.batch())==null?null:F.status)==="processing"?23:-1),r(),x(n.isProcessing()?24:-1),r(),x(n.configSteps().length>0?25:-1),r(2),x(n.isLoading()?27:28)}},dependencies:[te,X,ee,ve,he,Ce,be,oe,se,le,ae,Ie,Pe,Be,re,de,ce,we,_e,ue,Se,ye,ge,xe,me,pe],encapsulation:2,data:{animation:[fe]}})}}return i})();export{oi as BatchProcessingComponent};
