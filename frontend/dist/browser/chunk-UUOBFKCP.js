import{j as O}from"./chunk-42KZN7FF.js";import{a as T,b as M}from"./chunk-RZQ4GTLU.js";import"./chunk-XRBOLGPP.js";import"./chunk-7QH43UT2.js";import{a as P,b as W}from"./chunk-6KW5AGH6.js";import{b as C,d as I}from"./chunk-GXH7TAS4.js";import{V as B,X as V,Z as A,_ as j}from"./chunk-2HLCC7ZB.js";import{Eb as e,Fb as t,Ga as x,Gb as d,Kb as v,Mb as b,Nb as u,Oc as y,Wa as l,Xb as i,Yb as k,Zb as S,ad as E,fb as w,ga as m,lb as _,qa as h,ra as g,sb as s}from"./chunk-TT3TB5PH.js";import"./chunk-MG3ERZGY.js";function J(r,f){r&1&&(e(0,"div",17)(1,"div",18),d(2,"div",19),e(3,"div",20),d(4,"mat-spinner",21),t()(),e(5,"h1",22),i(6,"Connecting Account"),t(),e(7,"p",23),i(8," Securing your session with Verifik services... "),t()()),r&2&&s("@fadeIn",void 0)}function q(r,f){if(r&1&&(e(0,"div",17)(1,"div",24)(2,"mat-icon",25),i(3,"check"),t()(),e(4,"h1",22),i(5,"Welcome Back!"),t(),e(6,"p",26),i(7," Identity verified. Your workspace is ready. "),t(),e(8,"div",27),d(9,"mat-spinner",28),e(10,"span",29),i(11),t()()()),r&2){let n=u();s("@fadeIn",void 0),l(11),S("Entering in ",n.countdown(),"s")}}function D(r,f){if(r&1){let n=v();e(0,"div",17)(1,"div",30)(2,"mat-icon",31),i(3,"error_outline"),t()(),e(4,"h1",22),i(5,"Auth Failed"),t(),e(6,"p",26),i(7),t(),e(8,"button",32),b("click",function(){h(n);let o=u();return g(o.goToLogin())}),i(9," Go to Login "),t()()}if(r&2){let n=u();s("@fadeIn",void 0),l(7),k(n.errorMessage())}}function G(r,f){if(r&1){let n=v();e(0,"div",17)(1,"div",33)(2,"mat-icon",34),i(3,"lock_person"),t()(),e(4,"h1",22),i(5,"Access Required"),t(),e(6,"p",26),i(7," Please access SmartCheck through the Verifik platform. "),t(),e(8,"div",35)(9,"a",36),i(10," Open Verifik "),t(),e(11,"button",37),b("click",function(){h(n);let o=u();return g(o.continueWithoutAuth())}),i(12," Continue as Guest "),t()()()}r&2&&s("@fadeIn",void 0)}var N=(()=>{class r{constructor(){this._route=m(C),this._router=m(I),this._authService=m(M),this._userService=m(T),this.status=x("loading"),this.errorMessage=x(""),this.countdown=x(3)}ngOnInit(){this.processToken()}processToken(){let n=this._route.snapshot.queryParamMap.get("token"),a=this._route.snapshot.queryParamMap.get("redirect")||"/chat",o=this._route.snapshot.queryParamMap.get("user");if(!n){this.status.set("no_token");return}try{if(!this.isValidJWT(n))throw new Error("Invalid token format");let p=localStorage.getItem("accessToken");if(p&&p!==n&&(console.log("[Bridge] New token detected, switching user context"),this._authService.signOut(!0)),localStorage.setItem("accessToken",n),this._authService.accessToken=n,o)try{let c=JSON.parse(atob(o));localStorage.setItem("verifik_account",JSON.stringify(c)),this._userService.user=c}catch(c){console.warn("[Bridge] Could not parse user data:",c)}this.status.set("success");let F=setInterval(()=>{this.countdown.update(c=>c-1),this.countdown()<=0&&(clearInterval(F),this._router.navigateByUrl(a))},800)}catch(p){this.status.set("error"),this.errorMessage.set(p.message||"An unexpected error occurred")}}isValidJWT(n){let a=n.split(".");if(a.length!==3)return!1;try{let o=JSON.parse(atob(a[1]));if(o.exp&&o.exp*1e3<Date.now())throw new Error("Token has expired");return!0}catch{return!1}}goToLogin(){window.location.href="https://app.verifik.co/auth/sign-in"}continueWithoutAuth(){this._router.navigate(["/chat"])}static{this.\u0275fac=function(a){return new(a||r)}}static{this.\u0275cmp=w({type:r,selectors:[["app-bridge"]],decls:25,vars:5,consts:[[1,"min-h-screen","bg-[#F8FAFC]","flex","items-center","justify-center","p-6","relative","overflow-hidden"],[1,"absolute","inset-0","overflow-hidden","pointer-events-none"],[1,"absolute","-top-[10%]","-left-[10%]","w-[40%]","h-[40%]","bg-indigo-500/5","rounded-full","blur-[120px]"],[1,"absolute","-bottom-[10%]","-right-[10%]","w-[40%]","h-[40%]","bg-purple-500/5","rounded-full","blur-[120px]"],[1,"relative","bg-white/80","backdrop-blur-xl","border","border-white/40","rounded-[2.5rem]","p-12","max-w-md","w-full","shadow-[0_32px_64px_-16px_rgba(0,0,0,0.08)]"],[1,"flex","flex-col","items-center","mb-12"],[1,"group","relative"],[1,"absolute","-inset-1","bg-gradient-to-r","from-indigo-500","to-purple-600","rounded-2xl","blur","opacity-25","group-hover:opacity-50","transition","duration-1000","group-hover:duration-200"],[1,"relative","w-16","h-16","rounded-2xl","bg-white","flex","items-center","justify-center","shadow-xl","mb-6"],[1,"text-indigo-600","!text-3xl","!w-auto","!h-auto"],[1,"text-2xl","font-black","text-slate-900","tracking-tight","mb-1"],[1,"flex","items-center","gap-2"],[1,"h-0.5","w-6","bg-indigo-500","rounded-full"],[1,"text-[10px]","uppercase","font-black","tracking-[0.3em]","text-slate-400"],["class","text-center",4,"ngIf"],[1,"absolute","bottom-12","left-0","right-0","text-center"],[1,"text-[10px]","text-slate-400","font-bold","tracking-[0.3em]","uppercase","opacity-60"],[1,"text-center"],[1,"relative","w-20","h-20","mx-auto","mb-8"],[1,"absolute","inset-0","rounded-2xl","bg-indigo-50/50","animate-pulse"],[1,"absolute","inset-0","flex","items-center","justify-center"],["diameter","32","strokeWidth","3"],[1,"text-xl","font-bold","text-slate-900","mb-2"],[1,"text-slate-500","text-sm","leading-relaxed"],[1,"w-20","h-20","mx-auto","mb-8","rounded-full","bg-emerald-50","flex","items-center","justify-center","shadow-inner"],[1,"text-emerald-500","!text-4xl","!w-auto","!h-auto"],[1,"text-slate-500","text-sm","mb-10","leading-relaxed"],[1,"inline-flex","items-center","gap-3","px-6","py-3.5","bg-slate-50","border","border-slate-100","rounded-2xl"],["diameter","14","strokeWidth","2.5"],[1,"text-xs","font-bold","text-slate-600","uppercase","tracking-widest"],[1,"w-20","h-20","mx-auto","mb-8","rounded-2xl","bg-red-50","flex","items-center","justify-center"],[1,"text-red-500","!text-4xl","!w-auto","!h-auto"],["mat-flat-button","",1,"w-full","!rounded-2xl","!py-7","!bg-slate-900","!text-white","hover:!bg-slate-800","!shadow-xl","!shadow-slate-200/50","transition-all","!text-sm","font-bold","uppercase","tracking-widest",3,"click"],[1,"w-20","h-20","mx-auto","mb-8","rounded-2xl","bg-amber-50","flex","items-center","justify-center"],[1,"text-amber-500","!text-4xl","!w-auto","!h-auto"],[1,"space-y-4"],["href","https://app.verifik.co","target","_blank",1,"block","w-full","py-4","bg-gradient-to-r","from-indigo-600","to-indigo-700","hover:shadow-lg","hover:shadow-indigo-200/50","text-white","font-bold","rounded-2xl","transition-all","text-sm","uppercase","tracking-widest","text-center","shadow-md"],["mat-button","",1,"w-full","!rounded-2xl","!py-4","!text-slate-400","hover:!bg-slate-50","!text-xs","font-bold","uppercase","tracking-widest",3,"click"]],template:function(a,o){a&1&&(e(0,"div",0)(1,"div",1),d(2,"div",2)(3,"div",3),t(),e(4,"div",4)(5,"div",5)(6,"div",6),d(7,"div",7),e(8,"div",8)(9,"mat-icon",9),i(10,"bolt"),t()()(),e(11,"h2",10),i(12," SmartCheck "),t(),e(13,"div",11),d(14,"span",12),e(15,"p",13),i(16," Next Gen AI "),t(),d(17,"span",12),t()(),_(18,J,9,1,"div",14)(19,q,12,2,"div",14)(20,D,10,2,"div",14)(21,G,13,1,"div",14),t(),e(22,"div",15)(23,"p",16),i(24," Trusted Security by Verifik "),t()()()),a&2&&(l(5),s("@fadeInTop",void 0),l(13),s("ngIf",o.status()==="loading"),l(),s("ngIf",o.status()==="success"),l(),s("ngIf",o.status()==="error"),l(),s("ngIf",o.status()==="no_token"))},dependencies:[E,y,W,P,j,A,V,B],styles:["[_nghost-%COMP%]{display:block}"],data:{animation:[O]}})}}return r})();var ae=[{path:"",component:N}];export{ae as default};
