import{a as $e,b as ze,c as Ue}from"./chunk-HNFQCERV.js";import{a as Ne,b as Me,c as Le,d as je,e as Ae}from"./chunk-BDKC4BTW.js";import{a as Pe}from"./chunk-NROCMDI2.js";import{j as ve}from"./chunk-QQNGCN5G.js";import"./chunk-NJIOGT5G.js";import"./chunk-3RK6DDJD.js";import{a as Fe,b as Ve}from"./chunk-RJ3MLNQI.js";import"./chunk-QD66ZOCP.js";import{a as ke,b as De}from"./chunk-OYMRB6S7.js";import"./chunk-WOGZTWPB.js";import"./chunk-7RWCIHFI.js";import{c as Te,d as Ie}from"./chunk-FX6L73G2.js";import{c as ie,f as ne}from"./chunk-UVXKGKGK.js";import{a as ge,b as fe}from"./chunk-53WRULVM.js";import{a as ue,c as _e,d as xe}from"./chunk-YTRC6VXI.js";import{b as Y,d as ee,i as te}from"./chunk-QIQIZ3Q6.js";import{e as oe}from"./chunk-DHV22PVR.js";import{d as re,l as ae,m as le}from"./chunk-CTJ3YQQD.js";import"./chunk-ZAUDAUJV.js";import{A as Ee,b as he,c as be,e as N,h as Ce,i as ye,m as Se,q as we,r as Re,y as Be}from"./chunk-FTPRZILN.js";import"./chunk-MVN6OMHF.js";import{U as pe,V as se,X as de,Z as ce,_ as me}from"./chunk-KMUH6FME.js";import{Bb as K,Cb as D,Db as F,Dc as L,Eb as i,Fb as n,Ga as S,Gb as T,Kb as C,Mb as g,Nb as c,Sa as O,Wa as o,Xb as l,Yb as _,Zb as x,_b as P,bd as Q,cd as X,fb as H,ga as E,gc as W,hc as G,ic as J,lb as w,oc as s,pc as d,qa as v,qc as q,ra as h,rc as Z,sb as f,tb as M,ub as k,zb as b}from"./chunk-BMVGBJ55.js";import{a as B,b as V}from"./chunk-66YHNWRR.js";function j(r,m=""){let e=[];for(let[a,t]of Object.entries(r)){let p=m?`${m}.${a}`:a;if(t!=null&&typeof t=="object"&&!Array.isArray(t))e.push({path:p,value:"",type:"object"}),e.push(...j(t,p));else{let u=t==null?"\u2014":typeof t=="string"?t:Array.isArray(t)?JSON.stringify(t):String(t);e.push({path:p,value:u.length>60?u.slice(0,60)+"\u2026":u,type:"leaf"})}}return e}function Oe(r){let m=[];return r.inputData&&Object.keys(r.inputData).length>0&&(m.push({path:"inputData",value:"",type:"object"}),m.push(...j(r.inputData,"inputData"))),r.results&&Object.keys(r.results).length>0&&(m.push({path:"results",value:"",type:"object"}),m.push(...j(r.results,"results"))),m}var He=(r,m)=>({sections:r,primaryColor:m}),Ke=r=>({num:r}),We=()=>["left","center","right"],Ge=(r,m)=>m.type,Je=(r,m)=>m.id,qe=(r,m)=>m.path;function Ze(r,m){r&1&&(i(0,"mat-icon",65),l(1,"refresh"),n(),l(2),s(3,"transloco")),r&2&&(o(2),x(" ",d(3,1,"smartReport.sendingSample")," "))}function Qe(r,m){r&1&&(i(0,"mat-icon",66),l(1,"send"),n(),l(2),s(3,"transloco")),r&2&&(o(2),x(" ",d(3,1,"smartReport.sendSample")," "))}function Xe(r,m){r&1&&(i(0,"mat-icon",65),l(1,"refresh"),n(),l(2),s(3,"transloco")),r&2&&(o(2),x(" ",d(3,1,"smartReport.saving")," "))}function Ye(r,m){r&1&&(i(0,"mat-icon",66),l(1,"save"),n(),l(2),s(3,"transloco")),r&2&&(o(2),x(" ",d(3,1,"smartReport.saveTemplate")," "))}function et(r,m){if(r&1){let e=C();i(0,"div",4),T(1,"img",67),i(2,"button",68),g("click",function(){v(e);let t=c();return h(t.removeLogo())}),l(3),s(4,"transloco"),n()()}if(r&2){let e=c();o(),f("src",e.logoUrl(),O),o(2),x(" ",d(4,2,"smartReport.remove")," ")}}function tt(r,m){if(r&1){let e=C();i(0,"label",69)(1,"mat-icon",70),l(2,"upload"),n(),l(3),s(4,"transloco"),i(5,"input",71),g("change",function(t){v(e);let p=c();return h(p.onLogoUpload(t))}),n()(),i(6,"p",72),l(7,"PNG, JPG, SVG \xB7 max 500KB"),n()}r&2&&(o(3),x(" ",d(4,1,"smartReport.uploadLogo")," "))}function it(r,m){r&1&&(i(0,"mat-form-field",43)(1,"mat-label"),l(2),s(3,"transloco"),n(),i(4,"mat-select",73)(5,"mat-option",74),l(6,"\u2196 Top Left"),n(),i(7,"mat-option",75),l(8,"\u2191 Top Center"),n(),i(9,"mat-option",76),l(10,"\u2197 Top Right"),n(),i(11,"mat-option",77),l(12,"\u2199 Bottom Left"),n(),i(13,"mat-option",78),l(14,"\u2193 Bottom Center"),n(),i(15,"mat-option",79),l(16,"\u2198 Bottom Right"),n()()()),r&2&&(o(2),_(d(3,1,"smartReport.pageNumberPosition")))}function nt(r,m){r&1&&(i(0,"p",47),l(1),s(2,"transloco"),n()),r&2&&(o(),x(" ",d(2,1,"smartReport.openFromReportViewer")," "))}function ot(r,m){if(r&1){let e=C();i(0,"div",80)(1,"code",82),l(2),n(),i(3,"span",83),l(4),n(),i(5,"button",84),s(6,"transloco"),g("click",function(){v(e);let t=c().$implicit,p=c(2);return h(p.copyPathToClipboard(t.path))}),i(7,"mat-icon",85),l(8,"content_copy"),n()()()}if(r&2){let e=c().$implicit;o(2),_(e.path),o(),f("title",e.value),o(),_(e.value),o(),f("matTooltip",d(6,4,"smartReport.copyPath"))}}function rt(r,m){if(r&1){let e=C();i(0,"div",81)(1,"span",39),l(2),n(),i(3,"button",84),s(4,"transloco"),g("click",function(){v(e);let t=c().$implicit,p=c(2);return h(p.copyPathToClipboard(t.path))}),i(5,"mat-icon",85),l(6,"content_copy"),n()()()}if(r&2){let e=c().$implicit;o(2),_(e.path),o(),f("matTooltip",d(4,2,"smartReport.copyPathForTable"))}}function at(r,m){if(r&1&&w(0,ot,9,6,"div",80)(1,rt,7,4,"div",81),r&2){let e=m.$implicit;b(e.type==="leaf"?0:1)}}function lt(r,m){if(r&1&&(i(0,"div",48),D(1,at,2,1,null,null,qe),n()),r&2){let e=c();o(),F(e.helperDataPaths())}}function pt(r,m){if(r&1){let e=C();i(0,"button",86),g("click",function(){let t=v(e).$implicit,p=c();return h(p.addSection(t.type))}),i(1,"mat-icon",87),l(2),n(),l(3),s(4,"transloco"),n()}if(r&2){let e=m.$implicit;o(2),_(e.icon),o(),x(" ",d(4,2,e.labelKey)," ")}}function st(r,m){r&1&&(i(0,"div",58)(1,"mat-icon",88),l(2,"add_box"),n(),i(3,"p",89),l(4),s(5,"transloco"),n()()),r&2&&(o(4),x(" ",d(5,1,"smartReport.addSectionsFromAbove")," "))}function dt(r,m){if(r&1&&l(0),r&2){let e=c().$implicit;x(" ",e.label," ")}}function ct(r,m){if(r&1&&(l(0),s(1,"slice")),r&2){let e=c().$implicit;P(" ",Z(1,2,e.staticContent,0,30),"",e.staticContent.length>30?"...":""," ")}}function mt(r,m){if(r&1&&l(0),r&2){let e=c().$implicit;x(" ",e.dataPath," ")}}function ut(r,m){if(r&1&&(l(0),s(1,"transloco")),r&2){let e=c().$implicit;x(" ",q(1,1,"smartReport.sectionNumber",G(4,Ke,e.order+1))," ")}}function _t(r,m){if(r&1){let e=C();i(0,"div",90),g("click",function(){let t=v(e).$implicit,p=c();return h(p.selectSection(t))}),i(1,"div",91)(2,"mat-icon",92),l(3,"drag_indicator"),n()(),i(4,"div",93)(5,"mat-icon",70),l(6),n()(),i(7,"div",94)(8,"p",95),l(9),n(),i(10,"p",96),w(11,dt,1,1)(12,ct,2,6)(13,mt,1,1)(14,ut,2,6),n()(),i(15,"div",97)(16,"button",98),s(17,"transloco"),g("click",function(t){let p=v(e).$implicit;return c().duplicateSection(p),h(t.stopPropagation())}),i(18,"mat-icon",99),l(19,"content_copy"),n()(),i(20,"button",98),s(21,"transloco"),g("click",function(t){let p=v(e).$implicit;return c().deleteSection(p.id),h(t.stopPropagation())}),i(22,"mat-icon",100),l(23,"delete"),n()()()()}if(r&2){let e,a,t,p,u,y=m.$implicit,R=c();k("ring-2",((e=R.currentSelectedSection())==null?null:e.id)===y.id)("ring-indigo-500",((a=R.currentSelectedSection())==null?null:a.id)===y.id)("bg-indigo-50",((t=R.currentSelectedSection())==null?null:t.id)===y.id),o(4),M("background",((p=R.templateForm.get("primaryColor"))==null?null:p.value)+"15"),o(),M("color",(u=R.templateForm.get("primaryColor"))==null?null:u.value),o(),_(R.getSectionIcon(y.type)),o(3),x(" ",R.getSectionLabel(y.type)," "),o(2),b(y.label?11:y.staticContent?12:y.dataPath?13:14),o(5),f("matTooltip",d(17,15,"smartReport.duplicate")),o(4),f("matTooltip",d(21,17,"smartReport.delete"))}}function xt(r,m){if(r&1){let e=C();i(0,"div")(1,"label",36),l(2),s(3,"transloco"),n(),i(4,"input",105),s(5,"transloco"),g("input",function(t){v(e);let p=c(),u=c();return h(u.updateSection(p.id,{staticContent:t.target.value,label:t.target.value}))}),n()()}if(r&2){let e=c();o(2),_(d(3,3,"smartReport.titleText")),o(2),f("value",e.staticContent||"")("placeholder",d(5,5,"smartReport.reportTitle"))}}function gt(r,m){if(r&1){let e=C();i(0,"div")(1,"label",36),l(2),s(3,"transloco"),n(),i(4,"textarea",106),s(5,"transloco"),g("input",function(t){v(e);let p=c(),u=c();return h(u.updateSection(p.id,{staticContent:t.target.value}))}),n()()}if(r&2){let e=c();o(2),_(d(3,3,"smartReport.content")),o(2),f("value",e.staticContent||"")("placeholder",d(5,5,"smartReport.enterTextContent"))}}function ft(r,m){if(r&1){let e=C();i(0,"div")(1,"label",36),l(2),s(3,"transloco"),n(),i(4,"input",105),s(5,"transloco"),g("input",function(t){v(e);let p=c(),u=c();return h(u.updateSection(p.id,{label:t.target.value}))}),n()(),i(6,"div")(7,"label",36),l(8),s(9,"transloco"),n(),i(10,"input",107),s(11,"transloco"),g("input",function(t){v(e);let p=c(),u=c();return h(u.updateSection(p.id,{dataPath:t.target.value}))}),n(),i(12,"p",72),l(13),s(14,"transloco"),n()()}if(r&2){let e=c();o(2),_(d(3,7,"smartReport.label")),o(2),f("value",e.label||"")("placeholder",d(5,9,"smartReport.fieldLabel")),o(4),_(d(9,11,"smartReport.dataPath")),o(2),f("value",e.dataPath||"")("placeholder",d(11,13,"smartReport.dataPathPlaceholder")),o(3),x(" ",d(14,15,"smartReport.dotSeparatedPath")," ")}}function vt(r,m){if(r&1){let e=C();i(0,"div")(1,"label",36),l(2),s(3,"transloco"),n(),i(4,"input",105),s(5,"transloco"),g("input",function(t){v(e);let p=c(),u=c();return h(u.updateSection(p.id,{label:t.target.value}))}),n()(),i(6,"div")(7,"label",36),l(8),s(9,"transloco"),n(),i(10,"input",108),g("input",function(t){v(e);let p=c(),u=c();return h(u.updateSection(p.id,{dataPath:t.target.value}))}),n(),i(11,"p",72),l(12),s(13,"transloco"),n()()}if(r&2){let e=c();o(2),_(d(3,6,"smartReport.tableTitle")),o(2),f("value",e.label||"")("placeholder",d(5,8,"smartReport.tableLabel")),o(4),_(d(9,10,"smartReport.dataPathObject")),o(2),f("value",e.dataPath||""),o(2),x(" ",d(13,12,"smartReport.pathToObject")," ")}}function ht(r,m){if(r&1){let e=C();i(0,"div")(1,"label",36),l(2),s(3,"transloco"),n(),i(4,"input",109),g("input",function(t){v(e);let p=c(),u=c();return h(u.updateSection(p.id,{staticContent:t.target.value}))}),n()(),i(5,"div")(6,"label",36),l(7),s(8,"transloco"),n(),i(9,"input",105),s(10,"transloco"),g("input",function(t){v(e);let p=c(),u=c();return h(u.updateSection(p.id,{label:t.target.value}))}),n()()}if(r&2){let e=c();o(2),_(d(3,5,"smartReport.imageUrl")),o(2),f("value",e.staticContent||""),o(3),_(d(8,7,"smartReport.altText")),o(2),f("value",e.label||"")("placeholder",d(10,9,"smartReport.companyLogo"))}}function bt(r,m){if(r&1){let e=C();i(0,"div")(1,"label",36),l(2),s(3,"transloco"),n(),i(4,"input",110),g("input",function(t){v(e);let p=c(2);return h(p.updateSectionStyle("padding",t.target.value))}),n()()}if(r&2){let e=c();o(2),_(d(3,2,"smartReport.heightPx")),o(2),f("value",(e.style==null?null:e.style.padding)||16)}}function Ct(r,m){if(r&1){let e=C();i(0,"div")(1,"label",36),l(2),s(3,"transloco"),n(),i(4,"input",111),g("input",function(t){v(e);let p=c(2);return h(p.updateStyleColor(t.target.value))}),n()()}if(r&2){let e=c();o(2),_(d(3,2,"smartReport.color")),o(2),f("value",(e.style==null?null:e.style.color)||"#E5E7EB")}}function yt(r,m){if(r&1){let e=C();i(0,"button",116),g("click",function(){let t=v(e).$implicit,p=c(3);return h(p.updateTextAlign(t))}),i(1,"mat-icon",70),l(2),n()()}if(r&2){let e=m.$implicit,a=c(2);k("bg-indigo-50",(a.style==null?null:a.style.textAlign)===e)("border-indigo-300",(a.style==null?null:a.style.textAlign)===e),o(2),x("format_align_",e,"")}}function St(r,m){if(r&1){let e=C();i(0,"div",104)(1,"h4",39),l(2),s(3,"transloco"),n(),i(4,"div")(5,"label",112),l(6),s(7,"transloco"),n(),i(8,"div",113),D(9,yt,3,5,"button",114,K),n()(),i(11,"div")(12,"label",112),l(13),s(14,"transloco"),n(),i(15,"input",115),g("input",function(t){v(e);let p=c(2);return h(p.updateFontSize(+t.target.value))}),n()(),i(16,"div")(17,"label",112),l(18),s(19,"transloco"),n(),i(20,"div",113)(21,"button",116),g("click",function(){v(e);let t=c(2);return h(t.updateFontWeight("normal"))}),l(22),s(23,"transloco"),n(),i(24,"button",117),g("click",function(){v(e);let t=c(2);return h(t.updateFontWeight("bold"))}),l(25),s(26,"transloco"),n()()(),i(27,"div",4)(28,"label",55),l(29),s(30,"transloco"),n(),i(31,"input",118),g("input",function(t){v(e);let p=c(2);return h(p.updateStyleColor(t.target.value))}),n()()()}if(r&2){let e=c();o(2),x(" ",d(3,17,"smartReport.style")," "),o(4),_(d(7,19,"smartReport.textAlign")),o(3),F(W(31,We)),o(4),_(d(14,21,"smartReport.fontSize")),o(2),f("value",(e.style==null?null:e.style.fontSize)||14),o(3),_(d(19,23,"smartReport.fontWeight")),o(3),k("bg-indigo-50",(e.style==null?null:e.style.fontWeight)!=="bold")("border-indigo-300",(e.style==null?null:e.style.fontWeight)!=="bold"),o(),x(" ",d(23,25,"smartReport.normal")," "),o(2),k("bg-indigo-50",(e.style==null?null:e.style.fontWeight)==="bold")("border-indigo-300",(e.style==null?null:e.style.fontWeight)==="bold"),o(),x(" ",d(26,27,"smartReport.bold")," "),o(4),_(d(30,29,"smartReport.textColor")),o(2),f("value",(e.style==null?null:e.style.color)||"#111827")}}function wt(r,m){if(r&1){let e=C();i(0,"div",14)(1,"div",101)(2,"h3",54),l(3),s(4,"transloco"),n(),i(5,"button",102),g("click",function(){v(e);let t=c();return h(t.selectedSection.set(null))}),i(6,"mat-icon",87),l(7,"close"),n()()(),i(8,"div",103),w(9,xt,6,7,"div")(10,gt,6,7,"div")(11,ft,15,17)(12,vt,14,14)(13,ht,11,11)(14,bt,5,4,"div")(15,Ct,5,4,"div")(16,St,32,32,"div",104),n()()}if(r&2){let e=m,a=c();o(3),P(" ",d(4,10,"smartReport.edit")," ",a.getSectionLabel(e.type)," "),o(6),b(e.type==="header"?9:-1),o(),b(e.type==="text"?10:-1),o(),b(e.type==="field"?11:-1),o(),b(e.type==="table"?12:-1),o(),b(e.type==="image"?13:-1),o(),b(e.type==="spacer"?14:-1),o(),b(e.type==="divider"?15:-1),o(),b(e.type==="header"||e.type==="text"||e.type==="field"?16:-1)}}var ri=(()=>{class r{constructor(){this._route=E(Y),this._router=E(ee),this._fb=E(Be),this._snack=E(ke),this._reportService=E(Pe),this._dialog=E(ie),this._previewDataService=E($e),this._transloco=E(ue),this.configId=S(null),this.templateId=S(null),this.template=S(null),this.isLoading=S(!1),this.isSaving=S(!1),this.isSendingSample=S(!1),this.logoUrl=S(null),this.sections=S([]),this.selectedSection=S(null),this.currentSelectedSection=L(()=>{let e=this.selectedSection();return e?this.sections().find(a=>a.id===e.id)??null:null}),this.sectionTypes=[{type:"header",labelKey:"smartReport.sectionHeader",icon:"title"},{type:"text",labelKey:"smartReport.sectionText",icon:"notes"},{type:"field",labelKey:"smartReport.sectionField",icon:"data_object"},{type:"table",labelKey:"smartReport.sectionTable",icon:"table_chart"},{type:"image",labelKey:"smartReport.sectionImage",icon:"image"},{type:"divider",labelKey:"smartReport.sectionDivider",icon:"horizontal_rule"},{type:"spacer",labelKey:"smartReport.sectionSpacer",icon:"space_bar"}],this.previewData=S({batchName:"Background Check - Batch #47",rowIndex:0,inputData:{documentNumber:"1032386359",documentType:"CC",fullName:"JOHN DOE SMITH"},results:{1:{fullName:"JOHN DOE SMITH",firstName:"JOHN",lastName:"DOE SMITH",documentNumber:"1032386359",documentType:"CC",birthDate:"1990-05-15",gender:"Male",nationality:"Colombian",email:"john.doe@example.com",phone:"+57 300 123 4567",address:"Calle 100 #15-20, Bogota"},2:{isValid:!0,score:.95,status:"VERIFIED",verifiedAt:"2026-02-10T14:30:00Z"}}}),this._hasPreviewDataFromNavigation=!1,this.onPreviewSectionClick=e=>{this.selectSection(e)},this.helperDataPaths=L(()=>Oe(this.previewData())),this.templateForm=this._fb.group({name:["",[N.required,N.maxLength(150)]],description:["",N.maxLength(500)],primaryColor:["#4F46E5"],pageSize:["A4"],orientation:["portrait"],pdfEngine:["puppeteer"],legend:[""],showPageNumbers:[!1],pageNumberPosition:["bottom-center"]})}ngOnInit(){this._applyPreviewDataFromRouterState(),this._route.params.subscribe(e=>{this.configId.set(e.configId),this.templateId.set(e.templateId),this.templateId()?this._loadTemplate():this._initDefaultSections()})}_applyPreviewDataFromRouterState(){let e=this._previewDataService.consumePendingPreviewData();if(e||(e=this._router.getCurrentNavigation()?.extras?.state?.previewData??void 0),e&&(e.inputData||e.results)){let a={batchName:e.batchName??"Batch",rowIndex:e.rowIndex??0,inputData:e.inputData??{},results:e.results??{}};this.previewData.set(a),this._hasPreviewDataFromNavigation=!0}}_loadTemplate(){let e=this.templateId();e&&(this.isLoading.set(!0),this._reportService.getTemplate(e).subscribe({next:a=>{this.template.set(a),this.sections.set(a.sections||[]),!this._hasPreviewDataFromNavigation&&a.sampleData&&(a.sampleData.inputData||a.sampleData.results)&&this.previewData.set({batchName:a.sampleData.batchName??"Batch",rowIndex:a.sampleData.rowIndex??0,inputData:a.sampleData.inputData??{},results:a.sampleData.results??{}}),this.templateForm.patchValue({name:a.name,description:a.description,primaryColor:a.primaryColor||"#4F46E5",pageSize:a.pageSize||"A4",orientation:a.orientation||"portrait",pdfEngine:a.pdfEngine||"puppeteer",legend:a.legend||"",showPageNumbers:a.showPageNumbers||!1,pageNumberPosition:a.pageNumberPosition||"bottom-center"}),this.logoUrl.set(a.logo||null),this.isLoading.set(!1)},error:a=>{console.error("Failed to load template:",a),this.isLoading.set(!1),this._snack.open("Failed to load template","Close",{duration:3e3})}}))}_initDefaultSections(){this.sections.set([{id:this._generateId(),type:"header",order:0,label:"Verification Report",staticContent:"Verification Report",style:{fontSize:22,fontWeight:"bold",textAlign:"center"}},{id:this._generateId(),type:"divider",order:1,style:{color:"#4F46E5"}},{id:this._generateId(),type:"field",order:2,label:"Document Number",dataPath:"results.1.documentNumber"},{id:this._generateId(),type:"field",order:3,label:"Full Name",dataPath:"results.1.fullName"}])}onDrop(e){let a=[...this.sections()];Ne(a,e.previousIndex,e.currentIndex),a.forEach((t,p)=>t.order=p),this.sections.set(a)}addSection(e){let a={header:{staticContent:"Section Title",style:{fontSize:18,fontWeight:"bold",textAlign:"left"}},text:{staticContent:"Enter your text here...",style:{fontSize:12}},field:{label:"New Field",dataPath:""},table:{label:"Data Table",dataPath:"results.1"},image:{staticContent:"",style:{textAlign:"center"}},divider:{style:{color:this.templateForm.get("primaryColor")?.value||"#4F46E5"}},spacer:{style:{padding:"16"}}},t=B({id:this._generateId(),type:e,order:this.sections().length},a[e]);this.sections.update(p=>[...p,t]),this.selectSection(t)}selectSection(e){this.selectedSection.set(B({},e))}updateSection(e,a){this.sections.update(p=>p.map(u=>u.id===e?B(B({},u),a):u));let t=this.selectedSection();t?.id===e&&this.selectedSection.set(B(B({},t),a))}deleteSection(e){this.sections.update(a=>{let t=a.filter(p=>p.id!==e);return t.forEach((p,u)=>p.order=u),t}),this.selectedSection()?.id===e&&this.selectedSection.set(null)}duplicateSection(e){let a=V(B({},e),{id:this._generateId(),order:this.sections().length,label:e.label?e.label+" (copy)":void 0});this.sections.update(t=>[...t,a])}updateSectionStyle(e,a){let t=this.currentSelectedSection();t&&this.updateSection(t.id,{style:V(B({},t.style),{[e]:a})})}updateTextAlign(e){this.updateSectionStyle("textAlign",e)}updateFontSize(e){this.updateSectionStyle("fontSize",e)}updateFontWeight(e){this.updateSectionStyle("fontWeight",e)}updateStyleColor(e){this.updateSectionStyle("color",e)}updateBgColor(e){this.updateSectionStyle("backgroundColor",e)}save(){if(this.templateForm.invalid){this._snack.open("Please fill in all required fields","Close",{duration:3e3});return}this.isSaving.set(!0);let e=V(B({},this.templateForm.value),{sections:this.sections(),batchConfiguration:this.configId()||void 0,sampleData:this.previewData(),logo:this.logoUrl()||void 0}),a=this.templateId();a?this._reportService.updateTemplate(a,e).subscribe({next:()=>{this._snack.open("Template saved!","Close",{duration:3e3}),this.isSaving.set(!1)},error:t=>{console.error("Save failed:",t),this._snack.open("Failed to save template","Close",{duration:3e3}),this.isSaving.set(!1)}}):this._reportService.createTemplate(e).subscribe({next:t=>{this._snack.open("Template created!","Close",{duration:3e3}),this.isSaving.set(!1),this._router.navigate(["/smart-batch",this.configId(),"report-builder",t._id])},error:t=>{console.error("Create failed:",t),this._snack.open("Failed to create template","Close",{duration:3e3}),this.isSaving.set(!1)}})}sendSample(){let e=this.templateId();if(!e){this._snack.open(this._transloco.translate("smartReport.saveTemplateFirst"),"Close",{duration:3500});return}let a=`Sample Report: ${this.templateForm.get("name")?.value||"Template Preview"}`;this._dialog.open(Ue,{panelClass:"send-sample-dialog",maxWidth:"560px",width:"95vw",disableClose:!1,autoFocus:!0,data:{defaultSubject:a,isSample:!0}}).afterClosed().subscribe(p=>{p?.recipients?.length&&(this.isSendingSample.set(!0),this._reportService.sendTemplateSample(e,{recipients:p.recipients,subject:p.subject,language:"en",sampleData:this.previewData()}).subscribe({next:u=>{u.success?this._snack.open(this._transloco.translate("smartReport.samplePdfSentSuccess"),"Close",{duration:3500}):this._snack.open(u.error||this._transloco.translate("smartReport.failedToSendSamplePdf"),"Close",{duration:4e3}),this.isSendingSample.set(!1)},error:u=>{console.error("Send sample failed:",u),this._snack.open(this._transloco.translate("smartReport.failedToSendSamplePdf"),"Close",{duration:4e3}),this.isSendingSample.set(!1)}}))})}goBack(){let e=this.configId();e?this._router.navigate(["/smart-batch",e]):this._router.navigate(["/smart-batch"])}getSectionIcon(e){return this.sectionTypes.find(a=>a.type===e)?.icon||"help"}getSectionLabel(e){let a=this.sectionTypes.find(t=>t.type===e)?.labelKey;return a?this._transloco.translate(a):e}copyPathToClipboard(e){navigator.clipboard.writeText(e).then(()=>this._snack.open(`${this._transloco.translate("smartReport.copied")}: ${e}`,"Close",{duration:2e3}),()=>this._snack.open(this._transloco.translate("smartReport.failedToCopy"),"Close",{duration:2e3}))}onLogoUpload(e){let t=e.target.files?.[0];if(!t)return;if(t.size>512e3){this._snack.open("Logo file must be less than 500KB","Close",{duration:3500});return}let p=new FileReader;p.onload=()=>{this.logoUrl.set(p.result)},p.readAsDataURL(t)}removeLogo(){this.logoUrl.set(null)}_generateId(){return"section_"+Math.random().toString(36).substring(2,11)}static{this.\u0275fac=function(a){return new(a||r)}}static{this.\u0275cmp=H({type:r,selectors:[["report-builder"]],decls:141,vars:100,consts:[[1,"min-h-screen","w-full","bg-gray-50"],[1,"bg-white","border-b","border-gray-200","sticky","top-0","z-20"],[1,"max-w-[1600px]","mx-auto","px-4","sm:px-6","lg:px-8","py-3"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],["mat-icon-button","",3,"click","matTooltip"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-xs","text-gray-500"],["mat-stroked-button","",1,"!rounded-xl",3,"click","disabled","matTooltip"],[1,"inline-flex","items-center","gap-2"],["mat-flat-button","",1,"!rounded-xl","!bg-indigo-600","!text-white",3,"click","disabled"],[1,"max-w-[1600px]","mx-auto","px-4","sm:px-6","lg:px-8","py-6"],[1,"flex","gap-6","items-start"],[1,"w-full","lg:w-[440px]","shrink-0","space-y-4"],[1,"bg-white","rounded-2xl","border","border-gray-200","p-5"],[1,"text-sm","font-semibold","text-gray-900","mb-4"],[1,"space-y-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name",3,"placeholder"],[1,"grid","grid-cols-3","gap-3"],["appearance","outline"],["formControlName","pageSize"],["value","A4"],["value","Letter"],["value","Legal"],["formControlName","orientation"],["value","portrait"],["value","landscape"],["formControlName","pdfEngine"],["value","puppeteer"],["value","pdfkit"],[1,"flex","items-center","gap-4"],[1,"text-sm","text-gray-600"],["type","color","formControlName","primaryColor",1,"w-9","h-9","rounded-lg","border","border-gray-200","cursor-pointer"],[1,"pt-3","border-t","border-gray-100"],[1,"text-xs","font-medium","text-gray-500","mb-2","block"],[1,"text-xs","font-medium","text-gray-500","mb-1","block"],["formControlName","legend","rows","2",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-xs","text-gray-600","resize-none",3,"placeholder"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xs","font-medium","text-gray-500"],[1,"relative","inline-flex","items-center","cursor-pointer"],["type","checkbox","formControlName","showPageNumbers",1,"sr-only","peer"],[1,"w-9","h-5","bg-gray-200","peer-focus:outline-none","rounded-full","peer","peer-checked:after:translate-x-full","peer-checked:after:border-white","after:content-['']","after:absolute","after:top-[2px]","after:left-[2px]","after:bg-white","after:border-gray-300","after:border","after:rounded-full","after:h-4","after:w-4","after:transition-all","peer-checked:bg-indigo-600"],["appearance","outline",1,"w-full","!text-xs"],[1,"bg-white","rounded-2xl","border","border-gray-200","p-4"],[1,"text-sm","font-semibold","text-gray-900","mb-2"],[1,"text-xs","text-gray-500","mb-3"],[1,"text-xs","text-gray-400","italic"],[1,"max-h-[240px]","overflow-y-auto","space-y-1","pr-1"],[1,"text-sm","font-semibold","text-gray-900","mb-3"],[1,"flex","flex-wrap","gap-2"],[1,"inline-flex","items-center","gap-1.5","px-3","py-2","rounded-lg","border","border-gray-200","hover:border-indigo-300","hover:bg-indigo-50","transition-colors","text-sm","text-gray-700"],[1,"bg-white","rounded-2xl","border","border-gray-200"],[1,"px-5","py-3","border-b","border-gray-100","flex","items-center","justify-between"],[1,"text-sm","font-semibold","text-gray-900"],[1,"text-xs","text-gray-400"],[1,"text-xs","font-medium","text-gray-400"],["cdkDropList","",1,"p-3","min-h-[200px]",3,"cdkDropListDropped"],[1,"flex","flex-col","items-center","justify-center","h-40","text-gray-300"],["cdkDrag","",1,"flex","items-center","gap-2","bg-white","border","rounded-lg","px-3","py-2.5","mb-2","cursor-pointer","hover:border-indigo-300","transition-colors","group",3,"ring-2","ring-indigo-500","bg-indigo-50"],[1,"flex-1","min-w-0"],[1,"sticky","top-20"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-semibold","text-gray-500"],[3,"template","previewData","primaryColor","orientation","clickable","selectedSectionId","sectionClick","logoUrl","legend","showPageNumbers","pageNumberPosition"],[1,"animate-spin","!text-lg"],[1,"!text-lg"],["alt","Logo",1,"h-10","max-w-[160px]","object-contain","rounded","border","border-gray-200","bg-gray-50","p-1",3,"src"],["type","button",1,"text-xs","text-red-500","hover:text-red-700","transition-colors",3,"click"],[1,"inline-flex","items-center","gap-2","px-3","py-2","rounded-lg","border","border-dashed","border-gray-300","hover:border-indigo-300","hover:bg-indigo-50","transition-colors","cursor-pointer","text-sm","text-gray-500"],[1,"!text-base"],["type","file","accept","image/png,image/jpeg,image/svg+xml,image/webp",1,"hidden",3,"change"],[1,"text-xs","text-gray-400","mt-1"],["formControlName","pageNumberPosition"],["value","top-left"],["value","top-center"],["value","top-right"],["value","bottom-left"],["value","bottom-center"],["value","bottom-right"],[1,"group","flex","items-center","gap-2","py-1.5","px-2","rounded","hover:bg-gray-50","text-xs"],[1,"group","flex","items-center","gap-2","pt-1.5","pb-0.5"],[1,"flex-1","min-w-0","truncate","text-gray-700","font-mono"],[1,"text-gray-400","truncate","max-w-[120px]",3,"title"],["mat-icon-button","",1,"!w-6","!h-6","!rounded","opacity-0","group-hover:opacity-100","transition-opacity",3,"click","matTooltip"],[1,"!text-sm","!w-4","!h-4"],[1,"inline-flex","items-center","gap-1.5","px-3","py-2","rounded-lg","border","border-gray-200","hover:border-indigo-300","hover:bg-indigo-50","transition-colors","text-sm","text-gray-700",3,"click"],[1,"!text-base","text-gray-400"],[1,"!text-4xl","!w-10","!h-10","mb-2"],[1,"text-sm"],["cdkDrag","",1,"flex","items-center","gap-2","bg-white","border","rounded-lg","px-3","py-2.5","mb-2","cursor-pointer","hover:border-indigo-300","transition-colors","group",3,"click"],["cdkDragHandle","",1,"shrink-0","w-6","h-6","rounded","flex","items-center","justify-center","cursor-grab","text-gray-300","hover:text-gray-500"],[1,"!text-sm"],[1,"shrink-0","w-7","h-7","rounded-md","flex","items-center","justify-center"],[1,"min-w-0","flex-1"],[1,"text-sm","font-medium","text-gray-800","truncate"],[1,"text-xs","text-gray-400","truncate"],[1,"shrink-0","flex","items-center","gap-0.5","opacity-0","group-hover:opacity-100","transition-opacity"],["mat-icon-button","",1,"!w-7","!h-7",3,"click","matTooltip"],[1,"!text-sm","text-gray-400"],[1,"!text-sm","text-red-400"],[1,"flex","items-center","justify-between","mb-4"],["mat-icon-button","",1,"!w-7","!h-7",3,"click"],[1,"space-y-4"],[1,"pt-3","border-t","border-gray-100","space-y-3"],["type","text",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm",3,"input","value","placeholder"],["rows","4",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm",3,"input","value","placeholder"],["type","text",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm","font-mono",3,"input","value","placeholder"],["type","text","placeholder","results.1",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm","font-mono",3,"input","value"],["type","text","placeholder","https://example.com/logo.png",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm","font-mono",3,"input","value"],["type","number","min","4","max","200",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm",3,"input","value"],["type","color",1,"w-9","h-9","rounded-lg","border","border-gray-200","cursor-pointer",3,"input","value"],[1,"text-xs","text-gray-400","mb-1","block"],[1,"flex","gap-1"],[1,"flex-1","py-2","rounded-lg","border","text-sm","transition-colors",3,"bg-indigo-50","border-indigo-300"],["type","number","min","8","max","72",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm",3,"input","value"],[1,"flex-1","py-2","rounded-lg","border","text-sm","transition-colors",3,"click"],[1,"flex-1","py-2","rounded-lg","border","text-sm","font-bold","transition-colors",3,"click"],["type","color",1,"w-8","h-8","rounded","border","border-gray-200","cursor-pointer",3,"input","value"]],template:function(a,t){if(a&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),s(6,"transloco"),g("click",function(){return t.goBack()}),i(7,"mat-icon"),l(8,"arrow_back"),n()(),i(9,"div")(10,"h1",6),l(11),s(12,"transloco"),n(),i(13,"p",7),l(14),s(15,"transloco"),n()()(),i(16,"div",4)(17,"button",8),s(18,"transloco"),g("click",function(){return t.sendSample()}),i(19,"span",9),w(20,Ze,4,3)(21,Qe,4,3),n()(),i(22,"button",10),g("click",function(){return t.save()}),i(23,"span",9),w(24,Xe,4,3)(25,Ye,4,3),n()()()()()(),i(26,"div",11)(27,"div",12)(28,"div",13)(29,"div",14)(30,"h3",15),l(31),s(32,"transloco"),n(),i(33,"form",16)(34,"mat-form-field",17)(35,"mat-label"),l(36),s(37,"transloco"),n(),T(38,"input",18),s(39,"transloco"),n(),i(40,"div",19)(41,"mat-form-field",20)(42,"mat-label"),l(43),s(44,"transloco"),n(),i(45,"mat-select",21)(46,"mat-option",22),l(47,"A4"),n(),i(48,"mat-option",23),l(49,"Letter"),n(),i(50,"mat-option",24),l(51,"Legal"),n()()(),i(52,"mat-form-field",20)(53,"mat-label"),l(54),s(55,"transloco"),n(),i(56,"mat-select",25)(57,"mat-option",26),l(58),s(59,"transloco"),n(),i(60,"mat-option",27),l(61),s(62,"transloco"),n()()(),i(63,"mat-form-field",20)(64,"mat-label"),l(65),s(66,"transloco"),n(),i(67,"mat-select",28)(68,"mat-option",29),l(69,"Puppeteer"),n(),i(70,"mat-option",30),l(71,"PDFKit"),n()()()(),i(72,"div",31)(73,"label",32),l(74),s(75,"transloco"),n(),T(76,"input",33),n(),i(77,"div",34)(78,"label",35),l(79),s(80,"transloco"),n(),w(81,et,5,4,"div",4)(82,tt,8,3),n(),i(83,"div",34)(84,"label",36),l(85),s(86,"transloco"),n(),T(87,"textarea",37),s(88,"transloco"),n(),i(89,"div",34)(90,"div",38)(91,"label",39),l(92),s(93,"transloco"),n(),i(94,"label",40),T(95,"input",41)(96,"div",42),n()(),w(97,it,17,3,"mat-form-field",43),n()()(),i(98,"div",44)(99,"h3",45),l(100),s(101,"transloco"),n(),i(102,"p",46),l(103),s(104,"transloco"),n(),w(105,nt,3,3,"p",47)(106,lt,3,0,"div",48),n(),i(107,"div",44)(108,"h3",49),l(109),s(110,"transloco"),n(),i(111,"div",50),D(112,pt,5,4,"button",51,Ge),n()(),i(114,"div",52)(115,"div",53)(116,"div")(117,"h3",54),l(118),s(119,"transloco"),n(),i(120,"p",55),l(121),s(122,"transloco"),n()(),i(123,"span",56),l(124),s(125,"transloco"),n()(),i(126,"div",57),g("cdkDropListDropped",function(u){return t.onDrop(u)}),w(127,st,6,3,"div",58),D(128,_t,24,19,"div",59,Je),n()(),w(130,wt,17,12,"div",14),n(),i(131,"div",60)(132,"div",61)(133,"div",62)(134,"h3",63),l(135),s(136,"transloco"),n(),i(137,"span",55),l(138),s(139,"transloco"),n()(),T(140,"report-preview",64),n()()()()()),a&2){let p,u,y,R,A,I,$,z,U;o(5),f("matTooltip",d(6,47,"smartReport.back")),o(6),x(" ",d(12,49,t.templateId()?"smartReport.editReportTemplate":"smartReport.newReportTemplate")," "),o(3),x(" ",d(15,51,"smartReport.designReportLayout")," "),o(3),f("disabled",!t.templateId()||t.isSendingSample())("matTooltip",t.templateId()?"":d(18,53,"smartReport.saveTemplateFirst")),o(3),b(t.isSendingSample()?20:21),o(2),f("disabled",t.isSaving()),o(2),b(t.isSaving()?24:25),o(7),x(" ",d(32,55,"smartReport.templateSettings")," "),o(2),f("formGroup",t.templateForm),o(3),_(d(37,57,"smartReport.templateName")),o(2),f("placeholder",d(39,59,"smartReport.templateNamePlaceholder")),o(5),_(d(44,61,"smartReport.pageSize")),o(11),_(d(55,63,"smartReport.orientation")),o(4),_(d(59,65,"smartReport.portrait")),o(3),_(d(62,67,"smartReport.landscape")),o(4),_(d(66,69,"smartReport.pdfEngine")),o(9),x("",d(75,71,"smartReport.primaryColor"),":"),o(5),_(d(80,73,"smartReport.workspaceLogo")),o(2),b(t.logoUrl()?81:82),o(4),_(d(86,75,"smartReport.footerLegend")),o(2),f("placeholder",d(88,77,"smartReport.footerLegendPlaceholder")),o(5),_(d(93,79,"smartReport.pageNumbers")),o(5),b((p=t.templateForm.get("showPageNumbers"))!=null&&p.value?97:-1),o(3),x(" ",d(101,81,"smartReport.helperData")," "),o(3),x(" ",d(104,83,"smartReport.helperDataHint")," "),o(2),b(t.helperDataPaths().length===0?105:106),o(4),x(" ",d(110,85,"smartReport.addSections")," "),o(3),F(t.sectionTypes),o(6),x(" ",d(119,87,"smartReport.reportLayout")," "),o(3),x(" ",d(122,89,"smartReport.dragToReorder")," "),o(3),P("",t.sections().length," ",d(125,91,"smartReport.sections"),""),o(3),b(t.sections().length===0?127:-1),o(),F(t.sections()),o(2),b((u=t.currentSelectedSection())?130:-1,u),o(5),x(" ",d(136,93,"smartReport.preview")," "),o(3),_(d(139,95,"smartReport.livePreviewWithSample")),o(2),f("template",J(97,He,t.sections(),(y=t.templateForm.get("primaryColor"))==null?null:y.value))("previewData",t.previewData())("primaryColor",((R=t.templateForm.get("primaryColor"))==null?null:R.value)||"#4F46E5")("orientation",((A=t.templateForm.get("orientation"))==null?null:A.value)||"portrait")("clickable",!0)("selectedSectionId",(I=(I=t.currentSelectedSection())==null?null:I.id)!==null&&I!==void 0?I:null)("sectionClick",t.onPreviewSectionClick)("logoUrl",t.logoUrl())("legend",(($=t.templateForm.get("legend"))==null?null:$.value)||"")("showPageNumbers",((z=t.templateForm.get("showPageNumbers"))==null?null:z.value)||!1)("pageNumberPosition",((U=t.templateForm.get("pageNumberPosition"))==null?null:U.value)||"bottom-center")}},dependencies:[X,Q,te,Ee,Se,be,he,Ce,ye,we,Re,Ae,je,Le,Me,de,se,pe,ne,me,ce,le,ae,re,Ie,Te,Ve,Fe,oe,fe,ge,De,xe,_e,ze],encapsulation:2,data:{animation:[ve]}})}}return r})();export{ri as ReportBuilderComponent};
