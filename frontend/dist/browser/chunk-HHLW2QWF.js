import{a as Pe,b as Me,c as Ne}from"./chunk-Y4AEEAWU.js";import{a as Ie,b as ke,c as De,d as Fe,e as Ve}from"./chunk-JQW3TAJI.js";import{a as Ee}from"./chunk-2BYOOQLX.js";import{j as ue}from"./chunk-KA7WHGUA.js";import"./chunk-NJIOGT5G.js";import"./chunk-3RK6DDJD.js";import{a as Be,b as Te}from"./chunk-EHFGO5L2.js";import"./chunk-FRNVT4AA.js";import{a as Re,b as we}from"./chunk-AQRZ2FME.js";import"./chunk-36XZBL3Y.js";import"./chunk-7RWCIHFI.js";import{c as ye,d as Se}from"./chunk-JCQ5HMSW.js";import{c as Q,f as X}from"./chunk-6725JZD2.js";import{a as ce,b as me}from"./chunk-3NF2Z5WI.js";import{a as pe,c as se,d as de}from"./chunk-WWC66BHZ.js";import{b as q,d as U,i as Z}from"./chunk-RNDOSEN7.js";import{e as Y}from"./chunk-JW3TPNFN.js";import{d as ee,l as te,m as ie}from"./chunk-MBOJE2UO.js";import"./chunk-6YUO6TGL.js";import{A as be,c as _e,e as M,h as xe,i as ge,m as fe,q as ve,r as he,y as Ce}from"./chunk-HXRSGQBN.js";import"./chunk-WMLHEEES.js";import{U as ne,V as oe,X as re,Z as ae,_ as le}from"./chunk-WXW7J5FA.js";import{Bb as j,Cb as k,Cc as L,Db as D,Eb as o,Fb as r,Ga as w,Gb as V,Kb as C,Mb as x,Nb as c,Wa as n,Xb as l,Yb as _,Zb as b,_b as P,ad as G,bd as J,fb as A,ga as B,gc as z,hc as O,ic as H,lb as T,nc as s,oc as d,pc as W,qa as f,qc as K,ra as v,sb as g,tb as N,ub as I,zb as h}from"./chunk-VI5TFD4T.js";import{a as R,b as F}from"./chunk-66YHNWRR.js";function $(i,m=""){let e=[];for(let[a,t]of Object.entries(i)){let p=m?`${m}.${a}`:a;if(t!=null&&typeof t=="object"&&!Array.isArray(t))e.push({path:p,value:"",type:"object"}),e.push(...$(t,p));else{let u=t==null?"\u2014":typeof t=="string"?t:Array.isArray(t)?JSON.stringify(t):String(t);e.push({path:p,value:u.length>60?u.slice(0,60)+"\u2026":u,type:"leaf"})}}return e}function Le(i){let m=[];return i.inputData&&Object.keys(i.inputData).length>0&&(m.push({path:"inputData",value:"",type:"object"}),m.push(...$(i.inputData,"inputData"))),i.results&&Object.keys(i.results).length>0&&(m.push({path:"results",value:"",type:"object"}),m.push(...$(i.results,"results"))),m}var $e=(i,m)=>({sections:i,primaryColor:m}),Ae=i=>({num:i}),je=()=>["left","center","right"],ze=(i,m)=>m.type,Oe=(i,m)=>m.id,He=(i,m)=>m.path;function We(i,m){i&1&&(o(0,"mat-icon",55),l(1,"refresh"),r(),l(2),s(3,"transloco")),i&2&&(n(2),b(" ",d(3,1,"smartReport.sendingSample")," "))}function Ke(i,m){i&1&&(o(0,"mat-icon",56),l(1,"send"),r(),l(2),s(3,"transloco")),i&2&&(n(2),b(" ",d(3,1,"smartReport.sendSample")," "))}function Ge(i,m){i&1&&(o(0,"mat-icon",55),l(1,"refresh"),r(),l(2),s(3,"transloco")),i&2&&(n(2),b(" ",d(3,1,"smartReport.saving")," "))}function Je(i,m){i&1&&(o(0,"mat-icon",56),l(1,"save"),r(),l(2),s(3,"transloco")),i&2&&(n(2),b(" ",d(3,1,"smartReport.saveTemplate")," "))}function qe(i,m){i&1&&(o(0,"p",37),l(1),s(2,"transloco"),r()),i&2&&(n(),_(d(2,1,"smartReport.openFromReportViewer")))}function Ue(i,m){if(i&1){let e=C();o(0,"div",57)(1,"code",59),l(2),r(),o(3,"span",60),l(4),r(),o(5,"button",61),s(6,"transloco"),x("click",function(){f(e);let t=c().$implicit,p=c(2);return v(p.copyPathToClipboard(t.path))}),o(7,"mat-icon",62),l(8,"content_copy"),r()()()}if(i&2){let e=c().$implicit;n(2),_(e.path),n(),g("title",e.value),n(),_(e.value),n(),g("matTooltip",d(6,4,"smartReport.copyPath"))}}function Ze(i,m){if(i&1){let e=C();o(0,"div",58)(1,"span",63),l(2),r(),o(3,"button",61),s(4,"transloco"),x("click",function(){f(e);let t=c().$implicit,p=c(2);return v(p.copyPathToClipboard(t.path))}),o(5,"mat-icon",62),l(6,"content_copy"),r()()()}if(i&2){let e=c().$implicit;n(2),_(e.path),n(),g("matTooltip",d(4,2,"smartReport.copyPathForTable"))}}function Qe(i,m){if(i&1&&T(0,Ue,9,6,"div",57)(1,Ze,7,4,"div",58),i&2){let e=m.$implicit;h(e.type==="leaf"?0:1)}}function Xe(i,m){if(i&1&&(o(0,"div",38),k(1,Qe,2,1,null,null,He),r()),i&2){let e=c();n(),D(e.helperDataPaths())}}function Ye(i,m){if(i&1){let e=C();o(0,"button",64),x("click",function(){let t=f(e).$implicit,p=c();return v(p.addSection(t.type))}),o(1,"mat-icon",65),l(2),r(),l(3),s(4,"transloco"),r()}if(i&2){let e=m.$implicit;n(2),_(e.icon),n(),b(" ",d(4,2,e.labelKey)," ")}}function et(i,m){i&1&&(o(0,"div",48)(1,"mat-icon",66),l(2,"add_box"),r(),o(3,"p",67),l(4),s(5,"transloco"),r()()),i&2&&(n(4),_(d(5,1,"smartReport.addSectionsFromAbove")))}function tt(i,m){if(i&1&&l(0),i&2){let e=c().$implicit;b(" ",e.label," ")}}function it(i,m){if(i&1&&(l(0),s(1,"slice")),i&2){let e=c().$implicit;P(" ",K(1,2,e.staticContent,0,30),"",e.staticContent.length>30?"...":""," ")}}function nt(i,m){if(i&1&&l(0),i&2){let e=c().$implicit;b(" ",e.dataPath," ")}}function ot(i,m){if(i&1&&(l(0),s(1,"transloco")),i&2){let e=c().$implicit;b(" ",W(1,1,"smartReport.sectionNumber",O(4,Ae,e.order+1))," ")}}function rt(i,m){if(i&1){let e=C();o(0,"div",68),x("click",function(){let t=f(e).$implicit,p=c();return v(p.selectSection(t))}),o(1,"div",69)(2,"mat-icon",70),l(3,"drag_indicator"),r()(),o(4,"div",71)(5,"mat-icon",72),l(6),r()(),o(7,"div",73)(8,"p",74),l(9),r(),o(10,"p",75),T(11,tt,1,1)(12,it,2,6)(13,nt,1,1)(14,ot,2,6),r()(),o(15,"div",76)(16,"button",77),s(17,"transloco"),x("click",function(t){let p=f(e).$implicit;return c().duplicateSection(p),v(t.stopPropagation())}),o(18,"mat-icon",78),l(19,"content_copy"),r()(),o(20,"button",77),s(21,"transloco"),x("click",function(t){let p=f(e).$implicit;return c().deleteSection(p.id),v(t.stopPropagation())}),o(22,"mat-icon",79),l(23,"delete"),r()()()()}if(i&2){let e,a,t,p,u,y=m.$implicit,S=c();I("ring-2",((e=S.currentSelectedSection())==null?null:e.id)===y.id)("ring-indigo-500",((a=S.currentSelectedSection())==null?null:a.id)===y.id)("bg-indigo-50",((t=S.currentSelectedSection())==null?null:t.id)===y.id),n(4),N("background",((p=S.templateForm.get("primaryColor"))==null?null:p.value)+"15"),n(),N("color",(u=S.templateForm.get("primaryColor"))==null?null:u.value),n(),_(S.getSectionIcon(y.type)),n(3),b(" ",S.getSectionLabel(y.type)," "),n(2),h(y.label?11:y.staticContent?12:y.dataPath?13:14),n(5),g("matTooltip",d(17,15,"smartReport.duplicate")),n(4),g("matTooltip",d(21,17,"smartReport.delete"))}}function at(i,m){if(i&1){let e=C();o(0,"div")(1,"label",84),l(2),s(3,"transloco"),r(),o(4,"input",85),s(5,"transloco"),x("input",function(t){f(e);let p=c(),u=c();return v(u.updateSection(p.id,{staticContent:t.target.value,label:t.target.value}))}),r()()}if(i&2){let e=c();n(2),_(d(3,3,"smartReport.titleText")),n(2),g("value",e.staticContent||"")("placeholder",d(5,5,"smartReport.reportTitle"))}}function lt(i,m){if(i&1){let e=C();o(0,"div")(1,"label",84),l(2),s(3,"transloco"),r(),o(4,"textarea",86),s(5,"transloco"),x("input",function(t){f(e);let p=c(),u=c();return v(u.updateSection(p.id,{staticContent:t.target.value}))}),r()()}if(i&2){let e=c();n(2),_(d(3,3,"smartReport.content")),n(2),g("value",e.staticContent||"")("placeholder",d(5,5,"smartReport.enterTextContent"))}}function pt(i,m){if(i&1){let e=C();o(0,"div")(1,"label",84),l(2),s(3,"transloco"),r(),o(4,"input",85),s(5,"transloco"),x("input",function(t){f(e);let p=c(),u=c();return v(u.updateSection(p.id,{label:t.target.value}))}),r()(),o(6,"div")(7,"label",84),l(8),s(9,"transloco"),r(),o(10,"input",87),s(11,"transloco"),x("input",function(t){f(e);let p=c(),u=c();return v(u.updateSection(p.id,{dataPath:t.target.value}))}),r(),o(12,"p",88),l(13),s(14,"transloco"),r()()}if(i&2){let e=c();n(2),_(d(3,7,"smartReport.label")),n(2),g("value",e.label||"")("placeholder",d(5,9,"smartReport.fieldLabel")),n(4),_(d(9,11,"smartReport.dataPath")),n(2),g("value",e.dataPath||"")("placeholder",d(11,13,"smartReport.dataPathPlaceholder")),n(3),b(" ",d(14,15,"smartReport.dotSeparatedPath")," ")}}function st(i,m){if(i&1){let e=C();o(0,"div")(1,"label",84),l(2),s(3,"transloco"),r(),o(4,"input",85),s(5,"transloco"),x("input",function(t){f(e);let p=c(),u=c();return v(u.updateSection(p.id,{label:t.target.value}))}),r()(),o(6,"div")(7,"label",84),l(8),s(9,"transloco"),r(),o(10,"input",89),x("input",function(t){f(e);let p=c(),u=c();return v(u.updateSection(p.id,{dataPath:t.target.value}))}),r(),o(11,"p",88),l(12),s(13,"transloco"),r()()}if(i&2){let e=c();n(2),_(d(3,6,"smartReport.tableTitle")),n(2),g("value",e.label||"")("placeholder",d(5,8,"smartReport.tableLabel")),n(4),_(d(9,10,"smartReport.dataPathObject")),n(2),g("value",e.dataPath||""),n(2),b(" ",d(13,12,"smartReport.pathToObject")," ")}}function dt(i,m){if(i&1){let e=C();o(0,"div")(1,"label",84),l(2),s(3,"transloco"),r(),o(4,"input",90),x("input",function(t){f(e);let p=c(),u=c();return v(u.updateSection(p.id,{staticContent:t.target.value}))}),r()(),o(5,"div")(6,"label",84),l(7),s(8,"transloco"),r(),o(9,"input",85),s(10,"transloco"),x("input",function(t){f(e);let p=c(),u=c();return v(u.updateSection(p.id,{label:t.target.value}))}),r()()}if(i&2){let e=c();n(2),_(d(3,5,"smartReport.imageUrl")),n(2),g("value",e.staticContent||""),n(3),_(d(8,7,"smartReport.altText")),n(2),g("value",e.label||"")("placeholder",d(10,9,"smartReport.companyLogo"))}}function ct(i,m){if(i&1){let e=C();o(0,"div")(1,"label",84),l(2),s(3,"transloco"),r(),o(4,"input",91),x("input",function(t){f(e);let p=c(2);return v(p.updateSectionStyle("padding",t.target.value))}),r()()}if(i&2){let e=c();n(2),_(d(3,2,"smartReport.heightPx")),n(2),g("value",(e.style==null?null:e.style.padding)||16)}}function mt(i,m){if(i&1){let e=C();o(0,"div")(1,"label",84),l(2),s(3,"transloco"),r(),o(4,"input",92),x("input",function(t){f(e);let p=c(2);return v(p.updateStyleColor(t.target.value))}),r()()}if(i&2){let e=c();n(2),_(d(3,2,"smartReport.color")),n(2),g("value",(e.style==null?null:e.style.color)||"#E5E7EB")}}function ut(i,m){if(i&1){let e=C();o(0,"button",97),x("click",function(){let t=f(e).$implicit,p=c(3);return v(p.updateTextAlign(t))}),o(1,"mat-icon",72),l(2),r()()}if(i&2){let e=m.$implicit,a=c(2);I("bg-indigo-50",(a.style==null?null:a.style.textAlign)===e)("border-indigo-300",(a.style==null?null:a.style.textAlign)===e),n(2),b("format_align_",e,"")}}function _t(i,m){if(i&1){let e=C();o(0,"div",83)(1,"h4",63),l(2),s(3,"transloco"),r(),o(4,"div")(5,"label",93),l(6),s(7,"transloco"),r(),o(8,"div",94),k(9,ut,3,5,"button",95,j),r()(),o(11,"div")(12,"label",93),l(13),s(14,"transloco"),r(),o(15,"input",96),x("input",function(t){f(e);let p=c(2);return v(p.updateFontSize(+t.target.value))}),r()(),o(16,"div")(17,"label",93),l(18),s(19,"transloco"),r(),o(20,"div",94)(21,"button",97),x("click",function(){f(e);let t=c(2);return v(t.updateFontWeight("normal"))}),l(22),s(23,"transloco"),r(),o(24,"button",98),x("click",function(){f(e);let t=c(2);return v(t.updateFontWeight("bold"))}),l(25),s(26,"transloco"),r()()(),o(27,"div",4)(28,"label",45),l(29),s(30,"transloco"),r(),o(31,"input",99),x("input",function(t){f(e);let p=c(2);return v(p.updateStyleColor(t.target.value))}),r()()()}if(i&2){let e=c();n(2),_(d(3,17,"smartReport.style")),n(4),_(d(7,19,"smartReport.textAlign")),n(3),D(z(31,je)),n(4),_(d(14,21,"smartReport.fontSize")),n(2),g("value",(e.style==null?null:e.style.fontSize)||14),n(3),_(d(19,23,"smartReport.fontWeight")),n(3),I("bg-indigo-50",(e.style==null?null:e.style.fontWeight)!=="bold")("border-indigo-300",(e.style==null?null:e.style.fontWeight)!=="bold"),n(),_(d(23,25,"smartReport.normal")),n(2),I("bg-indigo-50",(e.style==null?null:e.style.fontWeight)==="bold")("border-indigo-300",(e.style==null?null:e.style.fontWeight)==="bold"),n(),_(d(26,27,"smartReport.bold")),n(4),_(d(30,29,"smartReport.textColor")),n(2),g("value",(e.style==null?null:e.style.color)||"#111827")}}function xt(i,m){if(i&1){let e=C();o(0,"div",14)(1,"div",80)(2,"h3",44),l(3),s(4,"transloco"),r(),o(5,"button",81),x("click",function(){f(e);let t=c();return v(t.selectedSection.set(null))}),o(6,"mat-icon",65),l(7,"close"),r()()(),o(8,"div",82),T(9,at,6,7,"div")(10,lt,6,7,"div")(11,pt,15,17)(12,st,14,14)(13,dt,11,11)(14,ct,5,4,"div")(15,mt,5,4,"div")(16,_t,32,32,"div",83),r()()}if(i&2){let e=m,a=c();n(3),P(" ",d(4,10,"smartReport.edit")," ",a.getSectionLabel(e.type)," "),n(6),h(e.type==="header"?9:-1),n(),h(e.type==="text"?10:-1),n(),h(e.type==="field"?11:-1),n(),h(e.type==="table"?12:-1),n(),h(e.type==="image"?13:-1),n(),h(e.type==="spacer"?14:-1),n(),h(e.type==="divider"?15:-1),n(),h(e.type==="header"||e.type==="text"||e.type==="field"?16:-1)}}var Zt=(()=>{class i{constructor(){this._route=B(q),this._router=B(U),this._fb=B(Ce),this._snack=B(Re),this._reportService=B(Ee),this._dialog=B(Q),this._previewDataService=B(Pe),this._transloco=B(pe),this.configId=w(null),this.templateId=w(null),this.template=w(null),this.isLoading=w(!1),this.isSaving=w(!1),this.isSendingSample=w(!1),this.sections=w([]),this.selectedSection=w(null),this.currentSelectedSection=L(()=>{let e=this.selectedSection();return e?this.sections().find(a=>a.id===e.id)??null:null}),this.sectionTypes=[{type:"header",labelKey:"smartReport.sectionHeader",icon:"title"},{type:"text",labelKey:"smartReport.sectionText",icon:"notes"},{type:"field",labelKey:"smartReport.sectionField",icon:"data_object"},{type:"table",labelKey:"smartReport.sectionTable",icon:"table_chart"},{type:"image",labelKey:"smartReport.sectionImage",icon:"image"},{type:"divider",labelKey:"smartReport.sectionDivider",icon:"horizontal_rule"},{type:"spacer",labelKey:"smartReport.sectionSpacer",icon:"space_bar"}],this.previewData=w({batchName:"Background Check - Batch #47",rowIndex:0,inputData:{documentNumber:"1032386359",documentType:"CC",fullName:"JOHN DOE SMITH"},results:{1:{fullName:"JOHN DOE SMITH",firstName:"JOHN",lastName:"DOE SMITH",documentNumber:"1032386359",documentType:"CC",birthDate:"1990-05-15",gender:"Male",nationality:"Colombian",email:"john.doe@example.com",phone:"+57 300 123 4567",address:"Calle 100 #15-20, Bogota"},2:{isValid:!0,score:.95,status:"VERIFIED",verifiedAt:"2026-02-10T14:30:00Z"}}}),this._hasPreviewDataFromNavigation=!1,this.onPreviewSectionClick=e=>{this.selectSection(e)},this.helperDataPaths=L(()=>Le(this.previewData())),this.templateForm=this._fb.group({name:["",[M.required,M.maxLength(150)]],description:["",M.maxLength(500)],primaryColor:["#4F46E5"],pageSize:["A4"],orientation:["portrait"],pdfEngine:["puppeteer"],legend:[""]})}ngOnInit(){this._applyPreviewDataFromRouterState(),this._route.params.subscribe(e=>{this.configId.set(e.configId),this.templateId.set(e.templateId),this.templateId()?this._loadTemplate():this._initDefaultSections()})}_applyPreviewDataFromRouterState(){let e=this._previewDataService.consumePendingPreviewData();if(e||(e=this._router.getCurrentNavigation()?.extras?.state?.previewData??void 0),e&&(e.inputData||e.results)){let a={batchName:e.batchName??"Batch",rowIndex:e.rowIndex??0,inputData:e.inputData??{},results:e.results??{}};this.previewData.set(a),this._hasPreviewDataFromNavigation=!0}}_loadTemplate(){let e=this.templateId();e&&(this.isLoading.set(!0),this._reportService.getTemplate(e).subscribe({next:a=>{this.template.set(a),this.sections.set(a.sections||[]),!this._hasPreviewDataFromNavigation&&a.sampleData&&(a.sampleData.inputData||a.sampleData.results)&&this.previewData.set({batchName:a.sampleData.batchName??"Batch",rowIndex:a.sampleData.rowIndex??0,inputData:a.sampleData.inputData??{},results:a.sampleData.results??{}}),this.templateForm.patchValue({name:a.name,description:a.description,primaryColor:a.primaryColor||"#4F46E5",pageSize:a.pageSize||"A4",orientation:a.orientation||"portrait",pdfEngine:a.pdfEngine||"puppeteer",legend:a.legend||""}),this.isLoading.set(!1)},error:a=>{console.error("Failed to load template:",a),this.isLoading.set(!1),this._snack.open("Failed to load template","Close",{duration:3e3})}}))}_initDefaultSections(){this.sections.set([{id:this._generateId(),type:"header",order:0,label:"Verification Report",staticContent:"Verification Report",style:{fontSize:22,fontWeight:"bold",textAlign:"center"}},{id:this._generateId(),type:"divider",order:1,style:{color:"#4F46E5"}},{id:this._generateId(),type:"field",order:2,label:"Document Number",dataPath:"results.1.documentNumber"},{id:this._generateId(),type:"field",order:3,label:"Full Name",dataPath:"results.1.fullName"}])}onDrop(e){let a=[...this.sections()];Ie(a,e.previousIndex,e.currentIndex),a.forEach((t,p)=>t.order=p),this.sections.set(a)}addSection(e){let a={header:{staticContent:"Section Title",style:{fontSize:18,fontWeight:"bold",textAlign:"left"}},text:{staticContent:"Enter your text here...",style:{fontSize:12}},field:{label:"New Field",dataPath:""},table:{label:"Data Table",dataPath:"results.1"},image:{staticContent:"",style:{textAlign:"center"}},divider:{style:{color:this.templateForm.get("primaryColor")?.value||"#4F46E5"}},spacer:{style:{padding:"16"}}},t=R({id:this._generateId(),type:e,order:this.sections().length},a[e]);this.sections.update(p=>[...p,t]),this.selectSection(t)}selectSection(e){this.selectedSection.set(R({},e))}updateSection(e,a){this.sections.update(p=>p.map(u=>u.id===e?R(R({},u),a):u));let t=this.selectedSection();t?.id===e&&this.selectedSection.set(R(R({},t),a))}deleteSection(e){this.sections.update(a=>{let t=a.filter(p=>p.id!==e);return t.forEach((p,u)=>p.order=u),t}),this.selectedSection()?.id===e&&this.selectedSection.set(null)}duplicateSection(e){let a=F(R({},e),{id:this._generateId(),order:this.sections().length,label:e.label?e.label+" (copy)":void 0});this.sections.update(t=>[...t,a])}updateSectionStyle(e,a){let t=this.currentSelectedSection();t&&this.updateSection(t.id,{style:F(R({},t.style),{[e]:a})})}updateTextAlign(e){this.updateSectionStyle("textAlign",e)}updateFontSize(e){this.updateSectionStyle("fontSize",e)}updateFontWeight(e){this.updateSectionStyle("fontWeight",e)}updateStyleColor(e){this.updateSectionStyle("color",e)}updateBgColor(e){this.updateSectionStyle("backgroundColor",e)}save(){if(this.templateForm.invalid){this._snack.open("Please fill in all required fields","Close",{duration:3e3});return}this.isSaving.set(!0);let e=F(R({},this.templateForm.value),{sections:this.sections(),batchConfiguration:this.configId()||void 0,sampleData:this.previewData()}),a=this.templateId();a?this._reportService.updateTemplate(a,e).subscribe({next:()=>{this._snack.open("Template saved!","Close",{duration:3e3}),this.isSaving.set(!1)},error:t=>{console.error("Save failed:",t),this._snack.open("Failed to save template","Close",{duration:3e3}),this.isSaving.set(!1)}}):this._reportService.createTemplate(e).subscribe({next:t=>{this._snack.open("Template created!","Close",{duration:3e3}),this.isSaving.set(!1),this._router.navigate(["/smart-batch",this.configId(),"report-builder",t._id])},error:t=>{console.error("Create failed:",t),this._snack.open("Failed to create template","Close",{duration:3e3}),this.isSaving.set(!1)}})}sendSample(){let e=this.templateId();if(!e){this._snack.open(this._transloco.translate("smartReport.saveTemplateFirst"),"Close",{duration:3500});return}let a=`Sample Report: ${this.templateForm.get("name")?.value||"Template Preview"}`;this._dialog.open(Ne,{panelClass:"send-sample-dialog",maxWidth:"560px",width:"95vw",disableClose:!1,autoFocus:!0,data:{defaultSubject:a,isSample:!0}}).afterClosed().subscribe(p=>{p?.recipients?.length&&(this.isSendingSample.set(!0),this._reportService.sendTemplateSample(e,{recipients:p.recipients,subject:p.subject,language:"en",sampleData:this.previewData()}).subscribe({next:u=>{u.success?this._snack.open(this._transloco.translate("smartReport.samplePdfSentSuccess"),"Close",{duration:3500}):this._snack.open(u.error||this._transloco.translate("smartReport.failedToSendSamplePdf"),"Close",{duration:4e3}),this.isSendingSample.set(!1)},error:u=>{console.error("Send sample failed:",u),this._snack.open(this._transloco.translate("smartReport.failedToSendSamplePdf"),"Close",{duration:4e3}),this.isSendingSample.set(!1)}}))})}goBack(){let e=this.configId();e?this._router.navigate(["/smart-batch",e]):this._router.navigate(["/smart-batch"])}getSectionIcon(e){return this.sectionTypes.find(a=>a.type===e)?.icon||"help"}getSectionLabel(e){let a=this.sectionTypes.find(t=>t.type===e)?.labelKey;return a?this._transloco.translate(a):e}copyPathToClipboard(e){navigator.clipboard.writeText(e).then(()=>this._snack.open(`${this._transloco.translate("smartReport.copied")}: ${e}`,"Close",{duration:2e3}),()=>this._snack.open(this._transloco.translate("smartReport.failedToCopy"),"Close",{duration:2e3}))}_generateId(){return"section_"+Math.random().toString(36).substring(2,11)}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=A({type:i,selectors:[["report-builder"]],decls:120,vars:82,consts:[[1,"min-h-screen","w-full","bg-gray-50"],[1,"bg-white","border-b","border-gray-200","sticky","top-0","z-20"],[1,"max-w-[1600px]","mx-auto","px-4","sm:px-6","lg:px-8","py-3"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],["mat-icon-button","",3,"click","matTooltip"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-xs","text-gray-500"],["mat-stroked-button","",1,"!rounded-xl",3,"click","disabled","matTooltip"],[1,"inline-flex","items-center","gap-2"],["mat-flat-button","",1,"!rounded-xl","!bg-indigo-600","!text-white",3,"click","disabled"],[1,"max-w-[1600px]","mx-auto","px-4","sm:px-6","lg:px-8","py-6"],[1,"flex","gap-6","items-start"],[1,"w-full","lg:w-[440px]","shrink-0","space-y-4"],[1,"bg-white","rounded-2xl","border","border-gray-200","p-5"],[1,"text-sm","font-semibold","text-gray-900","mb-4"],[1,"space-y-4",3,"formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","name",3,"placeholder"],[1,"grid","grid-cols-3","gap-3"],["appearance","outline"],["formControlName","pageSize"],["value","A4"],["value","Letter"],["value","Legal"],["formControlName","orientation"],["value","portrait"],["value","landscape"],["formControlName","pdfEngine"],["value","puppeteer"],["value","pdfkit"],[1,"flex","items-center","gap-4"],[1,"text-sm","text-gray-600"],["type","color","formControlName","primaryColor",1,"w-9","h-9","rounded-lg","border","border-gray-200","cursor-pointer"],[1,"bg-white","rounded-2xl","border","border-gray-200","p-4"],[1,"text-sm","font-semibold","text-gray-900","mb-2"],[1,"text-xs","text-gray-500","mb-3"],[1,"text-xs","text-gray-400","italic"],[1,"max-h-[240px]","overflow-y-auto","space-y-1","pr-1"],[1,"text-sm","font-semibold","text-gray-900","mb-3"],[1,"flex","flex-wrap","gap-2"],[1,"inline-flex","items-center","gap-1.5","px-3","py-2","rounded-lg","border","border-gray-200","hover:border-indigo-300","hover:bg-indigo-50","transition-colors","text-sm","text-gray-700"],[1,"bg-white","rounded-2xl","border","border-gray-200"],[1,"px-5","py-3","border-b","border-gray-100","flex","items-center","justify-between"],[1,"text-sm","font-semibold","text-gray-900"],[1,"text-xs","text-gray-400"],[1,"text-xs","font-medium","text-gray-400"],["cdkDropList","",1,"p-3","min-h-[200px]",3,"cdkDropListDropped"],[1,"flex","flex-col","items-center","justify-center","h-40","text-gray-300"],["cdkDrag","",1,"flex","items-center","gap-2","bg-white","border","rounded-lg","px-3","py-2.5","mb-2","cursor-pointer","hover:border-indigo-300","transition-colors","group",3,"ring-2","ring-indigo-500","bg-indigo-50"],[1,"flex-1","min-w-0"],[1,"sticky","top-20"],[1,"flex","items-center","justify-between","mb-3"],[1,"text-sm","font-semibold","text-gray-500"],[3,"template","previewData","primaryColor","orientation","clickable","selectedSectionId","sectionClick"],[1,"animate-spin","!text-lg"],[1,"!text-lg"],[1,"group","flex","items-center","gap-2","py-1.5","px-2","rounded","hover:bg-gray-50","text-xs"],[1,"group","flex","items-center","gap-2","pt-1.5","pb-0.5"],[1,"flex-1","min-w-0","truncate","text-gray-700","font-mono"],[1,"text-gray-400","truncate","max-w-[120px]",3,"title"],["mat-icon-button","",1,"!w-6","!h-6","!rounded","opacity-0","group-hover:opacity-100","transition-opacity",3,"click","matTooltip"],[1,"!text-sm","!w-4","!h-4"],[1,"text-xs","font-medium","text-gray-500"],[1,"inline-flex","items-center","gap-1.5","px-3","py-2","rounded-lg","border","border-gray-200","hover:border-indigo-300","hover:bg-indigo-50","transition-colors","text-sm","text-gray-700",3,"click"],[1,"!text-base","text-gray-400"],[1,"!text-4xl","!w-10","!h-10","mb-2"],[1,"text-sm"],["cdkDrag","",1,"flex","items-center","gap-2","bg-white","border","rounded-lg","px-3","py-2.5","mb-2","cursor-pointer","hover:border-indigo-300","transition-colors","group",3,"click"],["cdkDragHandle","",1,"shrink-0","w-6","h-6","rounded","flex","items-center","justify-center","cursor-grab","text-gray-300","hover:text-gray-500"],[1,"!text-sm"],[1,"shrink-0","w-7","h-7","rounded-md","flex","items-center","justify-center"],[1,"!text-base"],[1,"min-w-0","flex-1"],[1,"text-sm","font-medium","text-gray-800","truncate"],[1,"text-xs","text-gray-400","truncate"],[1,"shrink-0","flex","items-center","gap-0.5","opacity-0","group-hover:opacity-100","transition-opacity"],["mat-icon-button","",1,"!w-7","!h-7",3,"click","matTooltip"],[1,"!text-sm","text-gray-400"],[1,"!text-sm","text-red-400"],[1,"flex","items-center","justify-between","mb-4"],["mat-icon-button","",1,"!w-7","!h-7",3,"click"],[1,"space-y-4"],[1,"pt-3","border-t","border-gray-100","space-y-3"],[1,"text-xs","font-medium","text-gray-500","mb-1","block"],["type","text",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm",3,"input","value","placeholder"],["rows","4",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm",3,"input","value","placeholder"],["type","text",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm","font-mono",3,"input","value","placeholder"],[1,"text-xs","text-gray-400","mt-1"],["type","text","placeholder","results.1",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm","font-mono",3,"input","value"],["type","text","placeholder","https://example.com/logo.png",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm","font-mono",3,"input","value"],["type","number","min","4","max","200",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm",3,"input","value"],["type","color",1,"w-9","h-9","rounded-lg","border","border-gray-200","cursor-pointer",3,"input","value"],[1,"text-xs","text-gray-400","mb-1","block"],[1,"flex","gap-1"],[1,"flex-1","py-2","rounded-lg","border","text-sm","transition-colors",3,"bg-indigo-50","border-indigo-300"],["type","number","min","8","max","72",1,"w-full","px-3","py-2","border","border-gray-200","rounded-lg","text-sm",3,"input","value"],[1,"flex-1","py-2","rounded-lg","border","text-sm","transition-colors",3,"click"],[1,"flex-1","py-2","rounded-lg","border","text-sm","font-bold","transition-colors",3,"click"],["type","color",1,"w-8","h-8","rounded","border","border-gray-200","cursor-pointer",3,"input","value"]],template:function(a,t){if(a&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),s(6,"transloco"),x("click",function(){return t.goBack()}),o(7,"mat-icon"),l(8,"arrow_back"),r()(),o(9,"div")(10,"h1",6),l(11),s(12,"transloco"),r(),o(13,"p",7),l(14),s(15,"transloco"),r()()(),o(16,"div",4)(17,"button",8),s(18,"transloco"),x("click",function(){return t.sendSample()}),o(19,"span",9),T(20,We,4,3)(21,Ke,4,3),r()(),o(22,"button",10),x("click",function(){return t.save()}),o(23,"span",9),T(24,Ge,4,3)(25,Je,4,3),r()()()()()(),o(26,"div",11)(27,"div",12)(28,"div",13)(29,"div",14)(30,"h3",15),l(31),s(32,"transloco"),r(),o(33,"form",16)(34,"mat-form-field",17)(35,"mat-label"),l(36),s(37,"transloco"),r(),V(38,"input",18),s(39,"transloco"),r(),o(40,"div",19)(41,"mat-form-field",20)(42,"mat-label"),l(43),s(44,"transloco"),r(),o(45,"mat-select",21)(46,"mat-option",22),l(47,"A4"),r(),o(48,"mat-option",23),l(49,"Letter"),r(),o(50,"mat-option",24),l(51,"Legal"),r()()(),o(52,"mat-form-field",20)(53,"mat-label"),l(54),s(55,"transloco"),r(),o(56,"mat-select",25)(57,"mat-option",26),l(58),s(59,"transloco"),r(),o(60,"mat-option",27),l(61),s(62,"transloco"),r()()(),o(63,"mat-form-field",20)(64,"mat-label"),l(65),s(66,"transloco"),r(),o(67,"mat-select",28)(68,"mat-option",29),l(69,"Puppeteer"),r(),o(70,"mat-option",30),l(71,"PDFKit"),r()()()(),o(72,"div",31)(73,"label",32),l(74),s(75,"transloco"),r(),V(76,"input",33),r()()(),o(77,"div",34)(78,"h3",35),l(79),s(80,"transloco"),r(),o(81,"p",36),l(82),s(83,"transloco"),r(),T(84,qe,3,3,"p",37)(85,Xe,3,0,"div",38),r(),o(86,"div",34)(87,"h3",39),l(88),s(89,"transloco"),r(),o(90,"div",40),k(91,Ye,5,4,"button",41,ze),r()(),o(93,"div",42)(94,"div",43)(95,"div")(96,"h3",44),l(97),s(98,"transloco"),r(),o(99,"p",45),l(100),s(101,"transloco"),r()(),o(102,"span",46),l(103),s(104,"transloco"),r()(),o(105,"div",47),x("cdkDropListDropped",function(u){return t.onDrop(u)}),T(106,et,6,3,"div",48),k(107,rt,24,19,"div",49,Oe),r()(),T(109,xt,17,12,"div",14),r(),o(110,"div",50)(111,"div",51)(112,"div",52)(113,"h3",53),l(114),s(115,"transloco"),r(),o(116,"span",45),l(117),s(118,"transloco"),r()(),V(119,"report-preview",54),r()()()()()),a&2){let p,u,y,S,E;n(5),g("matTooltip",d(6,37,"smartReport.back")),n(6),b(" ",d(12,39,t.templateId()?"smartReport.editReportTemplate":"smartReport.newReportTemplate")," "),n(3),_(d(15,41,"smartReport.designReportLayout")),n(3),g("disabled",!t.templateId()||t.isSendingSample())("matTooltip",t.templateId()?"":d(18,43,"smartReport.saveTemplateFirst")),n(3),h(t.isSendingSample()?20:21),n(2),g("disabled",t.isSaving()),n(2),h(t.isSaving()?24:25),n(7),_(d(32,45,"smartReport.templateSettings")),n(2),g("formGroup",t.templateForm),n(3),_(d(37,47,"smartReport.templateName")),n(2),g("placeholder",d(39,49,"smartReport.templateNamePlaceholder")),n(5),_(d(44,51,"smartReport.pageSize")),n(11),_(d(55,53,"smartReport.orientation")),n(4),_(d(59,55,"smartReport.portrait")),n(3),_(d(62,57,"smartReport.landscape")),n(4),_(d(66,59,"smartReport.pdfEngine")),n(9),b("",d(75,61,"smartReport.primaryColor"),":"),n(5),_(d(80,63,"smartReport.helperData")),n(3),_(d(83,65,"smartReport.helperDataHint")),n(2),h(t.helperDataPaths().length===0?84:85),n(4),_(d(89,67,"smartReport.addSections")),n(3),D(t.sectionTypes),n(6),_(d(98,69,"smartReport.reportLayout")),n(3),_(d(101,71,"smartReport.dragToReorder")),n(3),P("",t.sections().length," ",d(104,73,"smartReport.sections"),""),n(3),h(t.sections().length===0?106:-1),n(),D(t.sections()),n(2),h((p=t.currentSelectedSection())?109:-1,p),n(5),_(d(115,75,"smartReport.preview")),n(3),_(d(118,77,"smartReport.livePreviewWithSample")),n(2),g("template",H(79,$e,t.sections(),(u=t.templateForm.get("primaryColor"))==null?null:u.value))("previewData",t.previewData())("primaryColor",((y=t.templateForm.get("primaryColor"))==null?null:y.value)||"#4F46E5")("orientation",((S=t.templateForm.get("orientation"))==null?null:S.value)||"portrait")("clickable",!0)("selectedSectionId",(E=(E=t.currentSelectedSection())==null?null:E.id)!==null&&E!==void 0?E:null)("sectionClick",t.onPreviewSectionClick)}},dependencies:[J,G,Z,be,fe,_e,xe,ge,ve,he,Ve,Fe,De,ke,re,oe,ne,X,le,ae,ie,te,ee,Se,ye,Te,Be,Y,me,ce,we,de,se,Me],encapsulation:2,data:{animation:[ue]}})}}return i})();export{Zt as ReportBuilderComponent};
