import{b as Z}from"./chunk-ZFUUUSU4.js";import{a as ne,b as ye}from"./chunk-RWLYOVKK.js";import{b as ge}from"./chunk-7CWISZAP.js";import{a as ve}from"./chunk-Q3BZAESG.js";import{a as X}from"./chunk-P6TIVLNX.js";import{d as he}from"./chunk-AI5UHXVQ.js";import{a as fe,b as xe}from"./chunk-XQDPKUEO.js";import{a as ee,b as te,h as ie}from"./chunk-4SHPDLNO.js";import{c as de,d as pe}from"./chunk-IHQN5EVA.js";import{d as J}from"./chunk-YGFCFPCR.js";import{m as oe}from"./chunk-BHDFSUEM.js";import{A as _e,c as ce,h as ue,l as me}from"./chunk-2NRSUFHY.js";import{V as re,X as ae,Z as se,_ as le}from"./chunk-AFVGM62N.js";import{Eb as r,Fb as a,Ga as C,Gb as S,Hb as L,Ib as O,Kb as M,Mb as g,Nb as p,Pc as z,Qc as G,Ra as T,Rb as H,Sb as j,Tb as K,Va as N,Wa as o,Wb as U,Xb as s,Yb as b,Zb as w,_b as W,aa as B,cd as Q,fb as F,ga as E,ic as Y,lb as I,oc as c,pc as u,pd as P,qa as h,qc as $,ra as f,sb as d,tb as R,tc as q,ub as D}from"./chunk-DCQLSIRV.js";import{h as k}from"./chunk-MG3ERZGY.js";var be=(()=>{class n{constructor(){this._httpWrapper=E(X),this._apiUrl=P.apiUrl}sendEmailOtp(e){return this._httpWrapper.sendRequest("post",`${this._apiUrl}/v2/email-validations`,e)}validateEmailOtp(e){return this._httpWrapper.sendRequest("post",`${this._apiUrl}/v2/email-validations/validate`,e)}sendPhoneOtp(e){return this._httpWrapper.sendRequest("post",`${this._apiUrl}/v2/phone-validations`,e)}validatePhoneOtp(e){return this._httpWrapper.sendRequest("post",`${this._apiUrl}/v2/phone-validations/validate`,e)}projectLogin(){return this._httpWrapper.sendRequest("post",`${this._apiUrl}/v2/auth/project-login`,{})}getSession(){return this._httpWrapper.sendRequest("post",`${this._apiUrl}/v2/auth/session`,{origin:"app"})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=B({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var we=["countryButton"],Ie=(n,m)=>({email:n,phone:m});function Me(n,m){if(n&1&&(r(0,"span"),s(1),c(2,"transloco"),a()),n&2){let e=p(2);o(),b(u(2,1,e.errorKey()))}}function Se(n,m){if(n&1&&(r(0,"span"),s(1),a()),n&2){let e=p(2);o(),b(e.error())}}function Ee(n,m){if(n&1&&(r(0,"div",10),I(1,Me,3,3,"span",11)(2,Se,2,1,"span",11),a()),n&2){let e=p();o(),d("ngIf",e.errorKey()),o(),d("ngIf",!e.errorKey()&&e.error())}}function ke(n,m){if(n&1){let e=M();L(0),r(1,"button",15),g("click",function(){h(e);let i=p(2);return f(i.startEmailFlow())}),r(2,"mat-icon",16),s(3,"mail"),a(),r(4,"span",17),s(5),c(6,"transloco"),a()(),r(7,"button",15),g("click",function(){h(e);let i=p(2);return f(i.startPhoneFlow())}),r(8,"mat-icon",16),s(9,"smartphone"),a(),r(10,"span",17),s(11),c(12,"transloco"),a()(),r(13,"button",15),g("click",function(){h(e);let i=p(2);return f(i.startWhatsAppFlow())}),r(14,"mat-icon",16),s(15,"message"),a(),r(16,"span",17),s(17),c(18,"transloco"),a()(),r(19,"div",18)(20,"div",19),S(21,"div",20),a(),r(22,"div",21)(23,"span",22),s(24),c(25,"transloco"),a()()(),O()}n&2&&(o(5),b(u(6,4,"authModal.choice.continueEmail")),o(6),b(u(12,6,"authModal.choice.continueSMS")),o(6),b(u(18,8,"authModal.choice.continueWhatsApp")),o(7),b(u(25,10,"authModal.choice.or")))}function Ae(n,m){if(n&1){let e=M();L(0),r(1,"button",23),g("click",function(){h(e);let i=p(2);return f(i.startWalletFlow())}),r(2,"div",24)(3,"mat-icon",16),s(4,"account_balance_wallet"),a(),r(5,"span",17),s(6),c(7,"transloco"),a()()(),O()}n&2&&(o(6),b(u(7,1,"authModal.choice.continueWallet")))}function Te(n,m){if(n&1&&(r(0,"div",25)(1,"div",26)(2,"mat-icon",27),s(3,"check_circle"),a(),r(4,"div",28)(5,"span",29),s(6),c(7,"transloco"),a(),r(8,"span",30),s(9),a()()()()),n&2){let e,t=p(2);o(6),b(u(7,3,"authModal.walletConnected.title")),o(3),W(" ",(e=t.connectedWalletAddress())==null?null:e.substring(0,6),"...",(e=t.connectedWalletAddress())==null?null:e.substring(38)," ")}}function Pe(n,m){n&1&&(r(0,"div",31)(1,"span",32),s(2),c(3,"transloco"),a(),r(4,"a",33),s(5),c(6,"transloco"),a()()),n&2&&(o(2),b(u(3,2,"authModal.choice.noAccount")),o(3),b(u(6,4,"authModal.choice.signUp")))}function Ve(n,m){if(n&1&&(r(0,"div",12),I(1,ke,26,12,"ng-container",11)(2,Ae,8,3,"ng-container",13)(3,Te,10,5,"ng-template",null,0,q)(5,Pe,7,6,"div",14),a()),n&2){let e=U(4),t=p();o(),d("ngIf",!t.hasWeb2Auth()),o(),d("ngIf",!t.connectedWalletAddress())("ngIfElse",e),o(3),d("ngIf",!t.hasWeb2Auth())}}function Le(n,m){n&1&&(r(0,"span"),s(1),c(2,"transloco"),a()),n&2&&(o(),b(u(2,1,"authModal.emailInput.continue")))}function Oe(n,m){n&1&&S(0,"mat-progress-spinner",44)}function We(n,m){if(n&1){let e=M();r(0,"div",34)(1,"div",35)(2,"mat-icon",36),s(3,"info"),a(),S(4,"p",37),c(5,"transloco"),a(),r(6,"div",38)(7,"mat-icon",39),s(8,"mail"),a(),r(9,"input",40),c(10,"transloco"),g("ngModelChange",function(i){h(e);let l=p();return f(l.email.set(i))})("keyup.enter",function(){h(e);let i=p();return f(i.sendEmailOtp())}),a()(),r(11,"button",41),g("click",function(){h(e);let i=p();return f(i.sendEmailOtp())}),I(12,Le,3,3,"span",11)(13,Oe,1,0,"mat-progress-spinner",42),a(),r(14,"button",43),g("click",function(){h(e);let i=p();return f(i.setState("CHOICE"))}),s(15),c(16,"transloco"),a()()}if(n&2){let e=p();o(4),d("innerHTML",u(5,7,"authModal.emailInput.infoMessage"),T),o(5),d("ngModel",e.email())("placeholder",u(10,9,"authModal.emailInput.placeholder")),o(2),d("disabled",!e.isEmailValid||e.isLoading()),o(),d("ngIf",!e.isLoading()),o(),d("ngIf",e.isLoading()),o(2),w(" ",u(16,11,"authModal.emailInput.back")," ")}}function Be(n,m){if(n&1&&(r(0,"span"),s(1),a()),n&2){let e=p(2);o(),b(e.selectedCountry().flag)}}function Ne(n,m){if(n&1&&(r(0,"span",54),s(1),a()),n&2){let e=p(2);o(),b(e.selectedCountry().dialCode)}}function Fe(n,m){n&1&&(r(0,"span",55),s(1),c(2,"transloco"),a()),n&2&&(o(),b(u(2,1,"authModal.phoneInput.selectCountry")))}function Re(n,m){if(n&1){let e=M();r(0,"button",63),g("click",function(){let i=h(e).$implicit,l=p(3);return f(l.selectCountry(i))}),r(1,"span",64),s(2),a(),r(3,"div",65)(4,"div",66),s(5),a()(),r(6,"span",67),s(7),a()()}if(n&2){let e,t=m.$implicit,i=p(3);D("bg-blue-50",((e=i.selectedCountry())==null?null:e.dialCode)===t.dialCode),o(2),b(t.flag),o(3),w(" ",t.name," "),o(2),w(" ",t.dialCode," ")}}function De(n,m){n&1&&(r(0,"div",68),s(1),c(2,"transloco"),a()),n&2&&(o(),w(" ",u(2,1,"authModal.phoneInput.noCountries")," "))}function He(n,m){if(n&1){let e=M();r(0,"div",56)(1,"div",57)(2,"div",38)(3,"mat-icon",58),s(4,"search"),a(),r(5,"input",59),c(6,"transloco"),g("input",function(i){h(e);let l=p(2);return f(l.onCountrySearchChange(i.target.value))})("click",function(i){return h(e),f(i.stopPropagation())}),a()()(),r(7,"div",60),I(8,Re,8,5,"button",61)(9,De,3,3,"div",62),a()()}if(n&2){let e=p(2);R("top",e.dropdownPosition().top)("left",e.dropdownPosition().left),o(5),d("value",e.countrySearchTerm())("placeholder",u(6,8,"authModal.phoneInput.searchCountry")),o(3),d("ngForOf",e.filteredCountries()),o(),d("ngIf",e.filteredCountries().length===0)}}function je(n,m){n&1&&(r(0,"span"),s(1),c(2,"transloco"),a()),n&2&&(o(),b(u(2,1,"authModal.phoneInput.continue")))}function Ke(n,m){n&1&&S(0,"mat-progress-spinner",44)}function Ue(n,m){if(n&1){let e=M();r(0,"div",34)(1,"div",35)(2,"mat-icon",36),s(3,"info"),a(),S(4,"p",37),c(5,"transloco"),c(6,"transloco"),a(),r(7,"div",45)(8,"div",46)(9,"button",47,1),g("click",function(){h(e);let i=p();return f(i.toggleCountryDropdown())}),r(11,"span",48),I(12,Be,2,1,"span",11)(13,Ne,2,1,"span",49)(14,Fe,3,3,"span",50),a(),r(15,"mat-icon",51),s(16,"arrow_drop_down"),a()(),I(17,He,10,10,"div",52),a(),r(18,"input",53),c(19,"transloco"),g("input",function(i){h(e);let l=p();return f(l.onPhoneInput(i))})("keyup.enter",function(){h(e);let i=p();return f(i.sendPhoneOtp())}),a()(),r(20,"button",41),g("click",function(){h(e);let i=p();return f(i.sendPhoneOtp())}),I(21,je,3,3,"span",11)(22,Ke,1,0,"mat-progress-spinner",42),a(),r(23,"button",43),g("click",function(){h(e);let i=p();return f(i.setState("CHOICE"))}),s(24),c(25,"transloco"),a()()}if(n&2){let e=p();o(4),d("innerHTML",e.state()==="WHATSAPP_INPUT"?u(5,11,"authModal.phoneInput.whatsappInfoMessage"):u(6,13,"authModal.phoneInput.infoMessage"),T),o(8),d("ngIf",e.selectedCountry()),o(),d("ngIf",e.selectedCountry()),o(),d("ngIf",!e.selectedCountry()),o(3),d("ngIf",e.isCountryDropdownOpen()&&e.dropdownPosition()),o(),d("ngModel",e.phone())("placeholder",u(19,15,"authModal.phoneInput.phonePlaceholder")),o(2),d("disabled",!e.phone()||!e.selectedCountry()||e.isLoading()),o(),d("ngIf",!e.isLoading()),o(),d("ngIf",e.isLoading()),o(2),w(" ",u(25,17,"authModal.phoneInput.back")," ")}}function Ye(n,m){if(n&1){let e=M();r(0,"input",74),g("input",function(i){let l=h(e).index,_=p(2);return f(_.onOtpInput(i,l))})("keydown",function(i){let l=h(e).index,_=p(2);return f(_.onKeyDown(i,l))}),a()}if(n&2){let e=m.$implicit,t=m.index;d("id","otp-"+t)("value",e)}}function $e(n,m){n&1&&(r(0,"span"),s(1),c(2,"transloco"),a()),n&2&&(o(),b(u(2,1,"authModal.otpVerify.verify")))}function qe(n,m){n&1&&S(0,"mat-progress-spinner",44)}function ze(n,m){if(n&1){let e=M();r(0,"div",69)(1,"div",70)(2,"h3",71),s(3),c(4,"transloco"),a(),r(5,"p",32),s(6),c(7,"transloco"),a()(),r(8,"div",72),I(9,Ye,1,2,"input",73),a(),r(10,"button",41),g("click",function(){h(e);let i=p();return f(i.state()==="OTP_VERIFY_EMAIL"?i.verifyEmailOtp():i.verifyPhoneOtp())}),I(11,$e,3,3,"span",11)(12,qe,1,0,"mat-progress-spinner",42),a(),r(13,"button",43),g("click",function(){h(e);let i=p();return f(i.setState("CHOICE"))}),s(14),c(15,"transloco"),a()()}if(n&2){let e=p();o(3),b(u(4,7,"authModal.otpVerify.title")),o(3),w(" ",$(7,9,e.state()==="OTP_VERIFY_EMAIL"?"authModal.otpVerify.emailMessage":e.state()==="OTP_VERIFY_WHATSAPP"?"authModal.otpVerify.whatsappMessage":"authModal.otpVerify.phoneMessage",Y(14,Ie,e.email(),e.phone()))," "),o(3),d("ngForOf",e.otpArray()),o(),d("disabled",e.otpArray().join("").length!==6||e.isLoading()),o(),d("ngIf",!e.isLoading()),o(),d("ngIf",e.isLoading()),o(2),w(" ",u(15,12,"authModal.otpVerify.back")," ")}}function Ge(n,m){if(n&1){let e=M();r(0,"div",34)(1,"h3",75),s(2),c(3,"transloco"),a(),r(4,"p",76),s(5),c(6,"transloco"),a(),r(7,"div",77)(8,"button",78),g("click",function(){h(e);let i=p();return f(i.connectMetaMask())}),r(9,"span"),s(10),c(11,"transloco"),a()(),r(12,"button",79),g("click",function(){h(e);let i=p();return f(i.createAgentWallet())}),r(13,"span"),s(14),c(15,"transloco"),a()()(),r(16,"button",43),g("click",function(){h(e);let i=p();return f(i.handleWalletBack())}),s(17),c(18,"transloco"),a()()}if(n&2){let e=p();o(2),b(u(3,6,"authModal.walletConnect.title")),o(3),w(" ",u(6,8,"authModal.walletConnect.subtitle")," "),o(3),d("disabled",e.isLoading()),o(2),b(u(11,10,"authModal.walletConnect.metamask")),o(4),b(u(15,12,"authModal.walletConnect.createAgent")),o(3),w(" ",u(18,14,"authModal.walletConnect.back")," ")}}function Qe(n,m){if(n&1){let e=M();r(0,"button",95),g("click",function(){h(e);let i=p(2);return f(i.encryptWithPasskey())}),r(1,"div",91)(2,"mat-icon",96),s(3,"fingerprint"),a(),r(4,"span"),s(5),c(6,"transloco"),a()()()}if(n&2){let e=p(2);d("disabled",e.isLoading()),o(5),b(u(6,2,"authModal.walletEncrypt.createPasskey"))}}function Je(n,m){n&1&&(r(0,"div",97)(1,"p",98),s(2),c(3,"transloco"),a()()),n&2&&(o(2),w(" ",u(3,1,"authModal.walletEncrypt.notSupported")," "))}function Xe(n,m){n&1&&(r(0,"div",99),S(1,"mat-progress-spinner",100),a())}function Ze(n,m){if(n&1){let e=M();r(0,"div",69)(1,"div",80)(2,"div",81)(3,"mat-icon",82),s(4,"account_balance_wallet"),a()(),r(5,"div",83),S(6,"span",84),r(7,"span",85),s(8),a()()(),r(9,"div",86),S(10,"p",87),c(11,"transloco"),a(),r(12,"div",88),I(13,Qe,7,4,"button",89),r(14,"button",90),g("click",function(){h(e);let i=p();return f(i.usePINInstead())}),r(15,"div",91)(16,"mat-icon",92),s(17,"pin"),a(),r(18,"span",17),s(19),c(20,"transloco"),a()()()(),I(21,Je,4,3,"div",93)(22,Xe,2,0,"div",94),a()}if(n&2){let e,t=p();o(8),W(" ",(e=t.tempWalletAddress())==null?null:e.substring(0,6),"...",(e=t.tempWalletAddress())==null?null:e.substring(38)," "),o(2),d("innerHTML",u(11,8,"authModal.walletEncrypt.instruction"),T),o(3),d("ngIf",t.passkeySupported()),o(),d("disabled",t.isLoading()),o(5),w(" ",u(20,10,"authModal.walletEncrypt.usePIN")," "),o(2),d("ngIf",!t.passkeySupported()),o(),d("ngIf",t.isLoading())}}function et(n,m){if(n&1){let e=M();r(0,"input",108),g("input",function(i){let l=h(e).index,_=p(2);return f(_.onPinInput(i,l))})("keydown",function(i){let l=h(e).index,_=p(2);return f(_.onPinKeyDown(i,l))}),a()}if(n&2){let e=m.$implicit,t=m.index;d("id","pin-"+t)("value",e)}}function tt(n,m){n&1&&(r(0,"span"),s(1),c(2,"transloco"),a()),n&2&&(o(),b(u(2,1,"authModal.pinSetup.encryptWallet")))}function it(n,m){n&1&&S(0,"mat-progress-spinner",44)}function nt(n,m){if(n&1){let e=M();r(0,"div",69)(1,"div",70)(2,"div",101)(3,"mat-icon",102),s(4,"pin"),a()(),r(5,"h3",71),s(6),c(7,"transloco"),a(),r(8,"p",32),s(9),c(10,"transloco"),a()(),r(11,"div",103)(12,"div",104)(13,"mat-icon",105),s(14,"warning"),a(),S(15,"p",106),c(16,"transloco"),a()(),r(17,"div",72),I(18,et,1,2,"input",107),a(),r(19,"button",41),g("click",function(){h(e);let i=p();return f(i.encryptWithPIN())}),I(20,tt,3,3,"span",11)(21,it,1,0,"mat-progress-spinner",42),a(),r(22,"button",43),g("click",function(){h(e);let i=p();return f(i.setState("WALLET_ENCRYPT_CHOICE"))}),s(23),c(24,"transloco"),a()()}if(n&2){let e=p();o(6),b(u(7,8,"authModal.pinSetup.title")),o(3),w(" ",u(10,10,"authModal.pinSetup.subtitle")," "),o(6),d("innerHTML",u(16,12,"authModal.pinSetup.warning"),T),o(3),d("ngForOf",e.pinArray()),o(),d("disabled",e.pinArray().join("").length!==6||e.isLoading()),o(),d("ngIf",!e.isLoading()),o(),d("ngIf",e.isLoading()),o(2),w(" ",u(24,14,"authModal.pinSetup.back")," ")}}var Nt=(()=>{class n{get countryDialCodes(){return this._countryService.countryDialCodes}constructor(){this.state=C("CHOICE"),this.isLoading=C(!1),this.email=C(""),this.phone=C(""),this.otp=C(""),this.otpArray=C(new Array(6).fill("")),this.pin=C(""),this.pinArray=C(new Array(6).fill("")),this.tempWalletAddress=C(null),this.tempWalletPrivateKey=C(null),this.passkeySupported=C(!1),this.connectedWalletAddress=C(null),this.hasWeb2Auth=C(!1),this.selectedCountry=C(null),this.countrySearchTerm=C(""),this.filteredCountries=C([]),this.isCountryDropdownOpen=C(!1),this.dropdownPosition=C(null),this.validationId=C(null),this.phoneGateway=C("sms"),this._authService=E(Z),this._authApiService=E(be),this._dialogRef=E(ee),this._router=E(J),this._countryService=E(ve),this._encryptionService=E(ye),this._sessionService=E(ne),this._dialogData=E(te,{optional:!0}),this.projectId=P.projectId,this.projectFlowId=P.loginProjectFlowId,this.error=C(null),this.errorKey=C(null);let e=this._countryService.countryDialCodes.find(l=>l.countryCode==="us");e&&this.selectedCountry.set(e),this.filteredCountries.set(this.countryDialCodes);let t=localStorage.getItem("x402_agent_address");t&&this.connectedWalletAddress.set(t);let i=localStorage.getItem("verifik_account");if(i)try{let l=JSON.parse(i);l&&(l.id||l._id)&&this.hasWeb2Auth.set(!0)}catch(l){console.warn("Failed to parse stored user data",l)}this._dialogData?.startWithWallet&&setTimeout(()=>{this.startWalletFlow()},0)}setState(e){if(this.state.set(e),this.otp.set(""),this.otpArray.set(new Array(6).fill("")),this.error.set(null),this.errorKey.set(null),e==="PHONE_INPUT"||e==="WHATSAPP_INPUT"){let t=this._countryService.countryDialCodes.find(i=>i.countryCode==="us");t&&this.selectedCountry.set(t),this.countrySearchTerm.set(""),this.filteredCountries.set(this.countryDialCodes)}}startEmailFlow(){this.setState("EMAIL_INPUT")}isValidEmail(e){return!e||!e.trim()?!1:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.trim())}get isEmailValid(){return this.isValidEmail(this.email())}sendEmailOtp(){return k(this,null,function*(){let e=this.email().trim();if(!e){this.error.set("Please enter your email address");return}if(!this.isValidEmail(e)){this.error.set("Please enter a valid email address");return}this.isLoading.set(!0),this.error.set(null),this.errorKey.set(null),this._authApiService.sendEmailOtp({email:e,project:this.projectId,type:"login",validationMethod:"verificationCode"}).subscribe({next:t=>{this.isLoading.set(!1),t.data?._id&&(this.validationId.set(t.data._id),this.setState("OTP_VERIFY_EMAIL"))},error:t=>{this.isLoading.set(!1),this.setState("EMAIL_INPUT"),this.setError(t.error?.message||"Failed to send OTP")}})})}verifyEmailOtp(){return k(this,null,function*(){let e=this.otpArray().join("");e.length!==6||!this.validationId()||(this.isLoading.set(!0),this.error.set(null),this.errorKey.set(null),this._authApiService.validateEmailOtp({otp:e,email:this.email(),projectFlow:this.projectFlowId,project:this.projectId,type:"login"}).subscribe({next:t=>{this.isLoading.set(!1),this.handleSuccess(t)},error:t=>{console.error(t),this.isLoading.set(!1),this.error.set("Invalid Code")}}))})}startPhoneFlow(){this.phoneGateway.set("sms"),this.setState("PHONE_INPUT")}startWhatsAppFlow(){this.phoneGateway.set("whatsapp"),this.setState("WHATSAPP_INPUT")}isValidPhone(e){let t=e.replace(/\D/g,"");return t.length>=7&&t.length<=15}onPhoneInput(e){let i=e.target.value;i=i.replace(/[^\d\s\-()]/g,""),this.phone.set(i)}onCountrySearchChange(e){this.countrySearchTerm.set(e);let t=e.toLowerCase().trim();if(!t){this.filteredCountries.set(this.countryDialCodes);return}let i=this.countryDialCodes.filter(l=>l.name.toLowerCase().includes(t)||l.dialCode.includes(t)||l.countryCode.toLowerCase().includes(t));this.filteredCountries.set(i)}toggleCountryDropdown(){let e=!this.isCountryDropdownOpen();if(this.isCountryDropdownOpen.set(e),e&&this.countryButtonRef){let i=this.countryButtonRef.nativeElement.getBoundingClientRect();this.dropdownPosition.set({top:`${i.bottom+4}px`,left:`${i.left}px`})}else this.dropdownPosition.set(null)}selectCountry(e){this.selectedCountry.set(e),this.countrySearchTerm.set(""),this.filteredCountries.set(this.countryDialCodes),this.isCountryDropdownOpen.set(!1),this.dropdownPosition.set(null)}sendPhoneOtp(){return k(this,null,function*(){let e=this.phone().trim(),t=this.selectedCountry();if(!e){this.error.set("Please enter your phone number");return}if(!t){this.error.set("Please select a country");return}let i=e.replace(/\D/g,"");if(!this.isValidPhone(i)){this.error.set("Please enter a valid phone number");return}this.isLoading.set(!0),this.error.set(null),this.errorKey.set(null);let l=i,_=t.dialCode.replace("+","");i.startsWith(_)&&(l=i.substring(_.length));let v=this.phoneGateway();this._authApiService.sendPhoneOtp({phone:l,countryCode:t.dialCode,project:this.projectId,type:"login",validationMethod:"verificationCode",phoneGateway:v}).subscribe({next:x=>{this.isLoading.set(!1),x.data?._id&&(this.validationId.set(x.data._id),this.setState(v==="whatsapp"?"OTP_VERIFY_WHATSAPP":"OTP_VERIFY_PHONE"))},error:x=>{this.isLoading.set(!1),this.setState(v==="whatsapp"?"WHATSAPP_INPUT":"PHONE_INPUT"),this.setError(x.error?.message||"Failed to send OTP")}})})}verifyPhoneOtp(){return k(this,null,function*(){let e=this.otpArray().join("");if(e.length!==6||!this.validationId())return;this.isLoading.set(!0),this.error.set(null),this.errorKey.set(null);let t=this.selectedCountry();if(!t)return;let i=this.phone().replace(/\D/g,""),l=t.dialCode.replace("+","");i.startsWith(l)&&(i=i.substring(l.length)),this._authApiService.validatePhoneOtp({otp:e,phoneValidation:this.validationId(),project:this.projectId,type:"login",phone:i,countryCode:t.dialCode}).subscribe({next:_=>{this.isLoading.set(!1),this.handleSuccess(_)},error:_=>{this.isLoading.set(!1),this.error.set("Invalid Code")}})})}verifyWhatsAppOtp(){return k(this,null,function*(){yield this.verifyPhoneOtp()})}startWalletFlow(){this.setState("WALLET_CONNECT")}handleWalletBack(){this.hasWeb2Auth()?this._dialogRef.close():this.setState("CHOICE")}createAgentWallet(){return k(this,null,function*(){this.isLoading.set(!0);try{let{ethers:e}=yield import("./chunk-FKPPIUBK.js"),t=e.Wallet.createRandom();console.log("Created Wallet:",t.address),this.tempWalletAddress.set(t.address),this.tempWalletPrivateKey.set(t.privateKey),localStorage.setItem("x402_agent_address",t.address);let i=yield this._encryptionService.isPasskeysSupported();this.passkeySupported.set(i),this.isLoading.set(!1),this.setState("WALLET_ENCRYPT_CHOICE")}catch(e){console.error("Wallet creation failed:",e),this.error.set("Failed to create wallet"),this.isLoading.set(!1)}})}connectMetaMask(){return k(this,null,function*(){this.isLoading.set(!0),this.error.set(null),this.errorKey.set(null);try{if(!window.ethereum){this.error.set("MetaMask is not installed. Please install MetaMask extension."),this.isLoading.set(!1);return}let e=yield window.ethereum.request({method:"eth_requestAccounts"});if(!e||e.length===0){this.error.set("No accounts found in MetaMask"),this.isLoading.set(!1);return}let t=e[0];console.log("Connected MetaMask:",t),localStorage.setItem("x402_agent_address",t),localStorage.setItem("x402_wallet_type","metamask"),this.isLoading.set(!1),this._dialogRef.close(),this._sessionService.resetReloadTracking(),this._sessionService.safeReload()}catch(e){console.error("MetaMask connection failed:",e),e.code===4001?this.error.set("Connection rejected. Please approve the connection in MetaMask."):this.error.set("Failed to connect to MetaMask"),this.isLoading.set(!1)}})}encryptWithPasskey(){return k(this,null,function*(){let e=this.tempWalletPrivateKey();if(!e){this.error.set("No wallet to encrypt");return}this.isLoading.set(!0),this.error.set(null),this.errorKey.set(null),(yield this._encryptionService.encryptWithPasskeys(e))?(localStorage.setItem("x402_wallet_type","encrypted-model"),this.tempWalletPrivateKey.set(null),this._dialogRef.close(!0),this._sessionService.resetReloadTracking(),this._sessionService.safeReload()):(this.isLoading.set(!1),this.error.set("Passkey encryption failed. Please try PIN instead."))})}usePINInstead(){this.setState("WALLET_ENCRYPT_PIN")}encryptWithPIN(){return k(this,null,function*(){let e=this.tempWalletPrivateKey(),t=this.pinArray().join("");if(!e){this.error.set("No wallet to encrypt");return}if(t.length!==6){this.error.set("Please enter a 6-digit PIN");return}this.isLoading.set(!0),this.error.set(null),this.errorKey.set(null),(yield this._encryptionService.encryptWithPIN(e,t))?(localStorage.setItem("x402_wallet_type","encrypted-model"),this.tempWalletPrivateKey.set(null),this.pinArray.set(new Array(6).fill("")),this._dialogRef.close(!0),this._sessionService.resetReloadTracking(),this._sessionService.safeReload()):(this.isLoading.set(!1),this.error.set("PIN encryption failed. Please try again."))})}setError(e){let i={invalid_email:"authModal.errors.invalidEmail",invalid_phone:"authModal.errors.invalidPhone"}[e];i?(this.errorKey.set(i),this.error.set(null)):(this.error.set(e),this.errorKey.set(null))}handleSuccess(e){let t=e.data||e,i=t.token||t.accessToken;i?(this._authService.accessToken=i,this._authApiService.projectLogin().subscribe({next:l=>{let _=l.data?.accessToken||l.accessToken;_?(this._authService.accessToken=_,localStorage.setItem("accessToken",_),this._authApiService.getSession().subscribe({next:v=>{let x=v.data?.user||v.user||v;localStorage.setItem("verifik_account",JSON.stringify(x)),this._dialogRef.close(!0),this._sessionService.resetReloadTracking(),this._sessionService.safeReload()},error:v=>{console.error("Session fetch failed",v),this.error.set("Failed to fetch session"),this.isLoading.set(!1)}})):(this.error.set("Failed to obtain access token"),this.isLoading.set(!1))},error:l=>{console.error("Project login failed",l),this.error.set("Login failed"),this.isLoading.set(!1)}})):(console.warn("No temp token found in response",e),this._dialogRef.close(!0))}onOtpInput(e,t){let i=e.target,l=i.value;if(l=l.replace(/\D/g,""),l.length>1){let v=[...this.otpArray()],x=l.split("").slice(0,6-t);for(let y=0;y<x.length&&t+y<6;y++){v[t+y]=x[y];let A=document.getElementById(`otp-${t+y}`);A&&(A.value=x[y])}this.otpArray.set(v),i.value=v[t]||"";let V=Math.min(t+x.length,5);setTimeout(()=>{let y=document.getElementById(`otp-${V}`);y&&(y.focus(),y.select())},0),v.every(y=>y!=="")&&v.length===6&&setTimeout(()=>{this.state()==="OTP_VERIFY_EMAIL"&&this.verifyEmailOtp(),this.state()==="OTP_VERIFY_PHONE"&&this.verifyPhoneOtp(),this.state()==="OTP_VERIFY_WHATSAPP"&&this.verifyWhatsAppOtp()},100);return}let _=[...this.otpArray()];if(l.length>0){let v=l.slice(-1);_[t]=v,this.otpArray.set(_),i.value=v,t<5&&setTimeout(()=>{let x=document.getElementById(`otp-${t+1}`);x&&(x.focus(),x.select())},0),_.every(x=>x!=="")&&_.length===6&&setTimeout(()=>{this.state()==="OTP_VERIFY_EMAIL"&&this.verifyEmailOtp(),this.state()==="OTP_VERIFY_PHONE"&&this.verifyPhoneOtp(),this.state()==="OTP_VERIFY_WHATSAPP"&&this.verifyWhatsAppOtp()},100)}else _[t]="",this.otpArray.set(_),i.value=""}onKeyDown(e,t){e.key==="Backspace"&&!this.otpArray()[t]&&t>0&&document.getElementById(`otp-${t-1}`)?.focus()}onPinInput(e,t){let i=e.target,l=i.value;if(l=l.replace(/\D/g,""),l.length>1){let v=[...this.pinArray()],x=l.split("").slice(0,6-t);for(let y=0;y<x.length&&t+y<6;y++){v[t+y]=x[y];let A=document.getElementById(`pin-${t+y}`);A&&(A.value=x[y])}this.pinArray.set(v),i.value=v[t]||"";let V=Math.min(t+x.length,5);setTimeout(()=>{let y=document.getElementById(`pin-${V}`);y&&(y.focus(),y.select())},0);return}let _=[...this.pinArray()];if(l.length>0){let v=l.slice(-1);_[t]=v,this.pinArray.set(_),i.value=v,t<5&&setTimeout(()=>{let x=document.getElementById(`pin-${t+1}`);x&&(x.focus(),x.select())},0)}else _[t]="",this.pinArray.set(_),i.value=""}onPinKeyDown(e,t){e.key==="Backspace"&&!this.pinArray()[t]&&t>0&&document.getElementById(`pin-${t-1}`)?.focus()}onDocumentClick(e){let t=e.target;this.isCountryDropdownOpen()&&!t.closest(".country-selector-container")&&(this.isCountryDropdownOpen.set(!1),this.dropdownPosition.set(null))}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=F({type:n,selectors:[["auth-modal"]],viewQuery:function(t,i){if(t&1&&H(we,5),t&2){let l;j(l=K())&&(i.countryButtonRef=l.first)}},hostBindings:function(t,i){t&1&&g("click",function(_){return i.onDocumentClick(_)},!1,N)},decls:16,vars:14,consts:[["connectedWallet",""],["countryButton",""],[1,"w-full","max-w-sm","mx-auto","p-2"],[1,"text-center","mb-8"],[1,"text-xl","font-bold","text-slate-900","dark:text-white"],["class","mb-4 p-3 bg-red-100 text-red-700 rounded-md text-sm text-center",4,"ngIf"],["class","space-y-3",4,"ngIf"],["class","space-y-4",4,"ngIf"],["class","space-y-6",4,"ngIf"],[1,"mt-8","text-center","text-[10px]","text-slate-400"],[1,"mb-4","p-3","bg-red-100","text-red-700","rounded-md","text-sm","text-center"],[4,"ngIf"],[1,"space-y-3"],[4,"ngIf","ngIfElse"],["class","pt-4 text-center",4,"ngIf"],["mat-stroked-button","",1,"w-full","!h-12","!justify-start","!px-4","!rounded-lg","!border-slate-300","dark:!border-slate-700",3,"click"],[1,"mr-3","text-slate-500"],[1,"text-slate-700","dark:text-slate-300"],[1,"relative","py-2"],[1,"absolute","inset-0","flex","items-center"],[1,"w-full","border-t","border-slate-200","dark:border-slate-700"],[1,"relative","flex","justify-center","text-xs","uppercase"],[1,"bg-white","dark:bg-slate-800","px-2","text-slate-500"],["mat-stroked-button","",1,"w-full","!h-12","!justify-start","!px-4","!rounded-lg","!border-slate-300","dark:!border-slate-700","hover:bg-slate-50","dark:hover:bg-slate-800","transition-colors",3,"click"],[1,"flex","items-center","w-full"],[1,"w-full","h-12","px-4","rounded-lg","border","border-green-200","dark:border-green-800","bg-green-50","dark:bg-green-900/10","flex","items-center","justify-between","cursor-default"],[1,"flex","items-center","gap-3"],[1,"text-green-600","dark:text-green-400"],[1,"flex","flex-col"],[1,"text-xs","font-semibold","text-green-700","dark:text-green-300"],[1,"text-[10px]","font-mono","text-green-600","dark:text-green-400","opacity-80"],[1,"pt-4","text-center"],[1,"text-sm","text-slate-500"],["href","https://access.verifik.co/sign-up/6332941ccde4f719d9c00f9e",1,"text-sm","text-blue-600","font-semibold","ml-1","cursor-pointer","hover:underline"],[1,"space-y-4"],[1,"p-3","bg-blue-50","dark:bg-blue-900/10","border","border-blue-100","dark:border-blue-900/20","rounded-lg","flex","gap-3"],[1,"text-blue-500","!w-5","!h-5","!text-[20px]","shrink-0","mt-0.5"],[1,"text-xs","text-blue-700","dark:text-blue-300","leading-snug",3,"innerHTML"],[1,"relative"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-slate-400"],["type","email",1,"w-full","pl-10","pr-4","py-3","rounded-lg","border","border-slate-300","dark:border-slate-700","bg-transparent","focus:ring-2","focus:ring-blue-500","focus:outline-none",3,"ngModelChange","keyup.enter","ngModel","placeholder"],["mat-flat-button","","color","primary",1,"w-full","!h-11","!rounded-lg",3,"click","disabled"],["diameter","20","mode","indeterminate",4,"ngIf"],["mat-button","",1,"w-full",3,"click"],["diameter","20","mode","indeterminate"],[1,"flex","space-x-2"],[1,"relative","country-selector-container"],["type","button",1,"w-28","px-3","py-3","rounded-lg","border","border-slate-300","dark:border-slate-700","bg-white","dark:bg-slate-800","text-slate-700","dark:text-slate-300","flex","items-center","justify-between","hover:bg-slate-50","dark:hover:bg-slate-700","focus:ring-2","focus:ring-blue-500","focus:outline-none","transition-colors",3,"click"],[1,"flex","items-center","gap-2","text-sm"],["class","font-medium",4,"ngIf"],["class","text-slate-400",4,"ngIf"],[1,"!w-4","!h-4","!text-[16px]","text-slate-400"],["class","fixed z-[1000] w-80 max-h-80 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg shadow-lg overflow-hidden",3,"top","left",4,"ngIf"],["type","tel",1,"flex-1","px-4","py-3","rounded-lg","border","border-slate-300","dark:border-slate-700","bg-transparent","focus:ring-2","focus:ring-blue-500","focus:outline-none",3,"input","keyup.enter","ngModel","placeholder"],[1,"font-medium"],[1,"text-slate-400"],[1,"fixed","z-[1000]","w-80","max-h-80","bg-white","dark:bg-slate-800","border","border-slate-200","dark:border-slate-700","rounded-lg","shadow-lg","overflow-hidden"],[1,"p-2","border-b","border-slate-200","dark:border-slate-700"],[1,"absolute","left-2","top-1/2","-translate-y-1/2","!w-4","!h-4","!text-[16px]","text-slate-400"],["type","text",1,"w-full","pl-8","pr-3","py-2","text-sm","rounded-md","border","border-slate-300","dark:border-slate-600","bg-transparent","focus:ring-2","focus:ring-blue-500","focus:outline-none",3,"input","click","value","placeholder"],[1,"max-h-64","overflow-y-auto"],["type","button","class","w-full px-4 py-3 flex items-center gap-3 hover:bg-slate-50 dark:hover:bg-slate-700 text-left transition-colors",3,"bg-blue-50","click",4,"ngFor","ngForOf"],["class","px-4 py-3 text-sm text-slate-500 text-center",4,"ngIf"],["type","button",1,"w-full","px-4","py-3","flex","items-center","gap-3","hover:bg-slate-50","dark:hover:bg-slate-700","text-left","transition-colors",3,"click"],[1,"text-2xl"],[1,"flex-1","min-w-0"],[1,"text-sm","font-medium","text-slate-900","dark:text-slate-100","truncate"],[1,"text-sm","text-slate-500","dark:text-slate-400","font-medium"],[1,"px-4","py-3","text-sm","text-slate-500","text-center"],[1,"space-y-6"],[1,"text-center","space-y-2"],[1,"font-bold"],[1,"flex","justify-between","gap-2"],["type","text","inputmode","numeric","maxlength","1","class","w-12 h-14 text-center text-2xl font-bold rounded-lg border border-slate-300 dark:border-slate-700 bg-transparent focus:ring-2 focus:ring-blue-500 focus:outline-none",3,"id","value","input","keydown",4,"ngFor","ngForOf"],["type","text","inputmode","numeric","maxlength","1",1,"w-12","h-14","text-center","text-2xl","font-bold","rounded-lg","border","border-slate-300","dark:border-slate-700","bg-transparent","focus:ring-2","focus:ring-blue-500","focus:outline-none",3,"input","keydown","id","value"],[1,"font-bold","text-center"],[1,"text-xs","text-center","text-slate-500","mb-4"],[1,"space-y-2"],["mat-stroked-button","",1,"w-full","!h-12","!justify-start","!px-4","!rounded-lg",3,"click","disabled"],["mat-stroked-button","",1,"w-full","!h-12","!justify-start","!px-4","!rounded-lg","bg-slate-50","dark:bg-slate-800",3,"click"],[1,"flex","flex-col","items-center","gap-3","mb-2"],[1,"w-20","h-20","rounded-full","bg-gradient-to-br","from-indigo-50","to-blue-50","dark:from-indigo-900/20","dark:to-blue-900/20","flex","items-center","justify-center","shadow-inner"],[1,"text-indigo-500","!w-10","!h-10","!text-[40px]"],[1,"flex","items-center","gap-2","px-3","py-1.5","bg-slate-100","dark:bg-slate-800","rounded-full","border","border-slate-200","dark:border-slate-700"],[1,"w-2","h-2","rounded-full","bg-green-500"],[1,"text-xs","font-mono","text-slate-600","dark:text-slate-300"],[1,"text-center","px-2"],[1,"text-sm","leading-relaxed","text-slate-600","dark:text-slate-400",3,"innerHTML"],[1,"space-y-3","pt-2"],["mat-flat-button","","color","primary","class","w-full !h-12 !rounded-lg !text-base shadow-lg shadow-indigo-500/20",3,"disabled","click",4,"ngIf"],["mat-stroked-button","",1,"w-full","!h-12","!rounded-lg","!text-base","!border-slate-300","dark:!border-slate-700","hover:!bg-slate-50","dark:hover:!bg-slate-800","transition-colors",3,"click","disabled"],[1,"flex","items-center","justify-center","gap-2"],[1,"!w-5","!h-5","!text-[20px]","text-slate-500"],["class","text-center",4,"ngIf"],["class","flex justify-center py-2",4,"ngIf"],["mat-flat-button","","color","primary",1,"w-full","!h-12","!rounded-lg","!text-base","shadow-lg","shadow-indigo-500/20",3,"click","disabled"],[1,"!w-5","!h-5","!text-[20px]"],[1,"text-center"],[1,"text-xs","text-amber-600","dark:text-amber-500"],[1,"flex","justify-center","py-2"],["diameter","24","mode","indeterminate"],[1,"w-12","h-12","bg-indigo-100","dark:bg-indigo-900/30","rounded-full","mx-auto","flex","items-center","justify-center","mb-4"],[1,"text-indigo-600","dark:text-indigo-400","!w-6","!h-6","!text-[24px]"],[1,"bg-amber-50","dark:bg-amber-900/20","border","border-amber-200","dark:border-amber-800","rounded-lg","p-3"],[1,"flex","items-start","gap-2"],[1,"text-amber-600","dark:text-amber-400","!w-4","!h-4","!text-[16px]","mt-0.5"],[1,"text-xs","text-amber-700","dark:text-amber-300",3,"innerHTML"],["type","password","inputmode","numeric","maxlength","1","class","w-12 h-14 text-center text-2xl font-bold rounded-lg border border-slate-300 dark:border-slate-700 bg-transparent focus:ring-2 focus:ring-indigo-500 focus:outline-none",3,"id","value","input","keydown",4,"ngFor","ngForOf"],["type","password","inputmode","numeric","maxlength","1",1,"w-12","h-14","text-center","text-2xl","font-bold","rounded-lg","border","border-slate-300","dark:border-slate-700","bg-transparent","focus:ring-2","focus:ring-indigo-500","focus:outline-none",3,"input","keydown","id","value"]],template:function(t,i){t&1&&(r(0,"div",2)(1,"div",3)(2,"h2",4),s(3),c(4,"transloco"),a()(),I(5,Ee,3,2,"div",5)(6,Ve,6,4,"div",6)(7,We,17,13,"div",7)(8,Ue,26,19,"div",7)(9,ze,16,17,"div",8)(10,Ge,19,16,"div",7)(11,Ze,23,12,"div",8)(12,nt,25,16,"div",8),r(13,"div",9),s(14),c(15,"transloco"),a()()),t&2&&(o(3),w(" ",u(4,10,i.state()==="WALLET_ENCRYPT_CHOICE"||i.state()==="WALLET_ENCRYPT_PIN"?"authModal.header.secureWallet":"authModal.header.login")," "),o(2),d("ngIf",i.error()||i.errorKey()),o(),d("ngIf",i.state()==="CHOICE"),o(),d("ngIf",i.state()==="EMAIL_INPUT"),o(),d("ngIf",i.state()==="PHONE_INPUT"||i.state()==="WHATSAPP_INPUT"),o(),d("ngIf",i.state()==="OTP_VERIFY_EMAIL"||i.state()==="OTP_VERIFY_PHONE"||i.state()==="OTP_VERIFY_WHATSAPP"),o(),d("ngIf",i.state()==="WALLET_CONNECT"),o(),d("ngIf",i.state()==="WALLET_ENCRYPT_CHOICE"),o(),d("ngIf",i.state()==="WALLET_ENCRYPT_PIN"),o(2),w(" ",u(15,12,"authModal.footer.protectedBy")," "))},dependencies:[Q,z,G,_e,ce,ue,me,ae,re,le,se,he,oe,ie,xe,fe,ge,pe,de],encapsulation:2})}}return n})();export{be as a,Nt as b};
