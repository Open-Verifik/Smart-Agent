import{a as tt,b as et,c as it}from"./chunk-VPUS4F4G.js";import{a as nt}from"./chunk-SD536L7G.js";import{a as at}from"./chunk-NROCMDI2.js";import"./chunk-QD66ZOCP.js";import{a as K,b as Q,c as W,d as X}from"./chunk-K67EF26S.js";import{a as Y,b as Z}from"./chunk-MVXXFAEU.js";import{a as G,b as q}from"./chunk-53WRULVM.js";import{a as O,c as H,d as J}from"./chunk-YTRC6VXI.js";import{d as R,i as P}from"./chunk-QIQIZ3Q6.js";import"./chunk-ZAUDAUJV.js";import"./chunk-QWR6CIPV.js";import"./chunk-MVN6OMHF.js";import{U as z,V as U,X as j,Z as A,_ as N}from"./chunk-KMUH6FME.js";import{Cb as k,Db as w,Eb as n,Fb as a,Ga as E,Gb as y,Kb as B,Mb as g,Nb as _,Wa as o,Wb as L,Xb as r,Yb as f,Yc as F,Zb as s,Zc as $,_b as M,cd as D,fb as I,ga as T,lb as v,oc as p,pc as m,qa as h,qc as V,ra as C,sb as b,zb as x}from"./chunk-BMVGBJ55.js";import"./chunk-66YHNWRR.js";function ot(e,d){let t;return(t=d._id)!==null&&t!==void 0?t:d.id}var lt=(e,d)=>d._id;function ct(e,d){if(e&1){let t=B();n(0,"button",10),g("click",function(){h(t);let i=_();return C(i.createConfiguration())}),n(1,"mat-icon",11),r(2,"add"),a(),r(3),p(4,"transloco"),a()}e&2&&(o(3),s(" ",m(4,1,"smartBatchLanding.createConfiguration")," "))}function pt(e,d){e&1&&(n(0,"button",12),p(1,"transloco"),n(2,"mat-icon",11),r(3,"add"),a(),r(4),p(5,"transloco"),a()),e&2&&(b("matTooltip",m(1,2,"smartBatchLanding.createTemplateFirstHint")),o(4),s(" ",m(5,4,"smartBatchLanding.createTemplate")," "))}function mt(e,d){if(e&1){let t=B();n(0,"button",10),g("click",function(){let i;h(t);let c=_(2);return C(c.createTemplate((i=(i=c.configurations()[0]._id)!==null&&i!==void 0?i:c.configurations()[0].id)!==null&&i!==void 0?i:""))}),n(1,"mat-icon",11),r(2,"add"),a(),r(3),p(4,"transloco"),a()}e&2&&(o(3),s(" ",m(4,1,"smartBatchLanding.createTemplate")," "))}function dt(e,d){if(e&1){let t=B();n(0,"button",16),g("click",function(){let i,c=h(t).$implicit,u=_(3);return C(u.createTemplate((i=(i=c._id)!==null&&i!==void 0?i:c.id)!==null&&i!==void 0?i:""))}),r(1),a()}if(e&2){let t=d.$implicit;o(),s(" ",t.name," ")}}function st(e,d){if(e&1&&(n(0,"button",13)(1,"mat-icon",11),r(2,"add"),a(),r(3),p(4,"transloco"),n(5,"mat-icon",14),r(6,"arrow_drop_down"),a()(),n(7,"mat-menu",null,0),k(9,dt,2,1,"button",15,ot),a()),e&2){let t=L(8),l=_(2);b("matMenuTriggerFor",t),o(3),s(" ",m(4,2,"smartBatchLanding.createTemplate")," "),o(6),w(l.configurations())}}function _t(e,d){if(e&1&&v(0,pt,6,6,"button",12)(1,mt,5,3,"button",9)(2,st,11,4),e&2){let t=_();x(t.configurations().length===0?0:t.configurations().length===1?1:2)}}function ut(e,d){e&1&&(n(0,"div",17),y(1,"mat-spinner",20),n(2,"p",21),r(3),p(4,"transloco"),a()()),e&2&&(o(3),s(" ",m(4,1,"smartBatchLanding.loadingConfigurations")," "))}function xt(e,d){if(e&1){let t=B();n(0,"div",18)(1,"div",22)(2,"mat-icon",23),r(3,"layers"),a()(),n(4,"h3",24),r(5),p(6,"transloco"),a(),n(7,"p",25),r(8),p(9,"transloco"),a(),n(10,"button",26),g("click",function(){h(t);let i=_(2);return C(i.createConfiguration())}),r(11),p(12,"transloco"),a()()}e&2&&(o(5),s(" ",m(6,3,"smartBatchLanding.noConfigurations")," "),o(3),s(" ",m(9,5,"smartBatchLanding.noConfigurationsDesc")," "),o(3),s(" ",m(12,7,"smartBatchLanding.createFirstConfiguration")," "))}function gt(e,d){e&1&&(n(0,"span",39),r(1),p(2,"transloco"),a()),e&2&&(o(),s(" ",m(2,1,"smartBatchLanding.inactive")," "))}function ft(e,d){if(e&1){let t=B();n(0,"div",28),g("click",function(){let i,c=h(t).$implicit,u=_(3);return C(u.openDashboard((i=(i=c._id)!==null&&i!==void 0?i:c.id)!==null&&i!==void 0?i:""))}),n(1,"div",29)(2,"button",30),p(3,"transloco"),g("click",function(i){let c,u=h(t).$implicit,S=_(3);return C(S.editConfiguration((c=(c=u._id)!==null&&c!==void 0?c:u.id)!==null&&c!==void 0?c:"",i))}),n(4,"mat-icon",31),r(5,"edit"),a()(),n(6,"button",32),p(7,"transloco"),g("click",function(i){let c,u=h(t).$implicit,S=_(3);return C(S.deleteConfiguration((c=(c=u._id)!==null&&c!==void 0?c:u.id)!==null&&c!==void 0?c:"",i))}),n(8,"mat-icon",31),r(9,"delete"),a()()(),n(10,"div",33)(11,"div",34)(12,"span",35),r(13),a(),n(14,"div")(15,"h3",36),r(16),a(),n(17,"div",37)(18,"span",38),r(19),p(20,"uppercase"),p(21,"uppercase"),a(),v(22,gt,3,3,"span",39),a()()()(),n(23,"p",40),r(24),p(25,"transloco"),a(),n(26,"div",41)(27,"div")(28,"span",42),r(29),p(30,"transloco"),a(),n(31,"span",43),r(32),a()(),n(33,"div")(34,"span",42),r(35),p(36,"transloco"),a(),n(37,"span",44),r(38),a()()()()}if(e&2){let t=d.$implicit,l=_(3);o(2),b("matTooltip",m(3,12,"smartBatchLanding.edit")),o(4),b("matTooltip",m(7,14,"smartBatchLanding.delete")),o(7),f(l.getCountryFlag(t.country)),o(3),s(" ",t.name," "),o(3),M(" ",m(20,16,t.inputFormat)," \u2192 ",m(21,18,t.outputFormat)," "),o(3),x(t.isActive?-1:22),o(2),s(" ",t.description||m(25,20,"smartBatchLanding.noDescription")," "),o(5),f(m(30,22,"smartBatchLanding.steps")),o(3),f(t.steps.length),o(3),f(m(36,24,"smartBatchLanding.strategy")),o(3),f(t.mergeStrategy.replace("-"," "))}}function ht(e,d){if(e&1&&(n(0,"div",19),k(1,ft,39,26,"div",27,ot),a()),e&2){let t=_(2);o(),w(t.configurations())}}function Ct(e,d){if(e&1&&v(0,ut,5,3,"div",17)(1,xt,13,9,"div",18)(2,ht,3,0,"div",19),e&2){let t=_();x(t.isLoading()?0:t.configurations().length===0?1:2)}}function vt(e,d){e&1&&(n(0,"div",17),y(1,"mat-spinner",20),n(2,"p",21),r(3),p(4,"transloco"),a()()),e&2&&(o(3),s(" ",m(4,1,"smartBatchLanding.loadingTemplates")," "))}function bt(e,d){e&1&&(n(0,"div",18)(1,"div",22)(2,"mat-icon",23),r(3,"description"),a()(),n(4,"h3",24),r(5),p(6,"transloco"),a(),n(7,"p",45),r(8),p(9,"transloco"),a(),n(10,"p",46),r(11),p(12,"transloco"),a()()),e&2&&(o(5),s(" ",m(6,3,"smartBatchLanding.noTemplates")," "),o(3),s(" ",m(9,5,"smartBatchLanding.noTemplatesDesc")," "),o(3),s(" ",m(12,7,"smartBatchLanding.noTemplatesHint")," "))}function Bt(e,d){if(e&1&&(n(0,"span",38),r(1),a()),e&2){let t=_().$implicit;o(),s(" ",t.pageSize," ")}}function St(e,d){if(e&1&&r(0),e&2){let t=_().$implicit,l=_(3);s(" ",l.getConfigName(t.batchConfiguration)," ")}}function Tt(e,d){e&1&&(r(0),p(1,"transloco")),e&2&&s(" ",m(1,1,"smartBatchLanding.standalone")," ")}function kt(e,d){if(e&1&&(n(0,"p",52),r(1),p(2,"date"),a()),e&2){let t=_().$implicit;o(),s(" ",V(2,1,t.createdAt,"medium")," ")}}function wt(e,d){if(e&1){let t=B();n(0,"div",47)(1,"div",29)(2,"button",30),p(3,"transloco"),g("click",function(i){let c=h(t).$implicit,u=_(3);return C(u.openTemplateEditor(c,i))}),n(4,"mat-icon",31),r(5,"edit"),a()(),n(6,"button",32),p(7,"transloco"),g("click",function(i){let c,u=h(t).$implicit,S=_(3);return C(S.deleteTemplate((c=u._id)!==null&&c!==void 0?c:"",i))}),n(8,"mat-icon",31),r(9,"delete"),a()()(),n(10,"h3",48),r(11),a(),n(12,"div",49)(13,"span",38),r(14),p(15,"uppercase"),a(),v(16,Bt,2,1,"span",38),a(),n(17,"p",50),r(18),p(19,"transloco"),a(),n(20,"div",41)(21,"div")(22,"span",42),r(23),p(24,"transloco"),a(),n(25,"span",43),r(26),a()(),n(27,"div")(28,"span",42),r(29),p(30,"transloco"),a(),n(31,"span",51),v(32,St,1,1)(33,Tt,2,3),a()()(),v(34,kt,3,4,"p",52),a()}if(e&2){let t,l,i=d.$implicit;o(2),b("matTooltip",m(3,11,"smartBatchLanding.edit")),o(4),b("matTooltip",m(7,13,"smartBatchLanding.delete")),o(5),s(" ",i.name," "),o(3),s(" ",m(15,15,(t=i.pdfEngine)!==null&&t!==void 0?t:"pdfkit")," "),o(2),x(i.pageSize?16:-1),o(2),s(" ",i.description||m(19,17,"smartBatchLanding.noDescription")," "),o(5),f(m(24,19,"smartBatchLanding.sections")),o(3),f((l=i.sections==null?null:i.sections.length)!==null&&l!==void 0?l:0),o(3),f(m(30,21,"smartBatchLanding.linkedTo")),o(3),x(i.batchConfiguration?32:33),o(2),x(i.createdAt?34:-1)}}function yt(e,d){if(e&1&&(n(0,"div",19),k(1,wt,35,23,"div",47,lt),a()),e&2){let t=_(2);o(),w(t.templates())}}function Et(e,d){if(e&1&&v(0,vt,5,3,"div",17)(1,bt,13,9,"div",18)(2,yt,3,0,"div",19),e&2){let t=_();x(t.isLoadingTemplates()?0:t.templates().length===0?1:2)}}var rt=(()=>{class e{constructor(){this._smartBatchService=T(nt),this._smartReportService=T(at),this._router=T(R),this._transloco=T(O),this.configurations=this._smartBatchService.configurations,this.isLoading=this._smartBatchService.isLoading,this.activeTab=E("configurations"),this.templates=this._smartReportService.templates,this.isLoadingTemplates=this._smartReportService.isLoading}ngOnInit(){this._smartBatchService.getConfigurations().subscribe({next:()=>{let t=this.configurations();console.log("[SmartBatch] configurations loaded",{count:t?.length,configs:t?.map(l=>({_id:l._id,id:l.id,name:l.name,country:l.country,countryType:typeof l.country,countryJson:JSON.stringify(l.country)}))})},error:t=>console.error("[SmartBatch] getConfigurations error",t)}),this._smartReportService.getTemplates().subscribe({error:t=>console.error("[SmartBatch] getTemplates error",t)})}setActiveTab(t){this.activeTab.set(t)}createConfiguration(){this._router.navigate(["smart-batch/create"])}createTemplate(t){t&&this._router.navigate(["smart-batch",t,"report-builder"])}deleteConfiguration(t,l){l.stopPropagation(),confirm("Are you sure you want to delete this configuration?")&&this._smartBatchService.deleteConfiguration(t).subscribe()}deleteTemplate(t,l){l.stopPropagation();let i=this._transloco.translate("smartBatchLanding.deleteConfirmation");confirm(i)&&this._smartReportService.deleteTemplate(t).subscribe()}openTemplateEditor(t,l){l.stopPropagation();let i=t.batchConfiguration;if(!i){alert("This template is not linked to a configuration. Open it from a configuration's report builder.");return}let c=t._id??t.id??"";c&&this._router.navigate(["smart-batch",i,"report-builder",c])}getConfigName(t){return this.configurations().find(i=>(i._id??i.id)===t)?.name??t}editConfiguration(t,l){l.stopPropagation(),this._router.navigate(["smart-batch/edit",t])}openDashboard(t){let l=`/smart-batch/${t}`;if(console.log("[SmartBatch] openDashboard called",{id:t,idType:typeof t,idLength:t?.length,targetUrl:l,currentUrl:this._router.url}),!t){console.warn("[SmartBatch] openDashboard: id is falsy, skipping navigation");return}this._router.navigateByUrl(l).then(i=>{console.log("[SmartBatch] navigateByUrl result",{success:i,targetUrl:l}),i||console.warn("[SmartBatch] navigateByUrl returned false - route may not have matched")},i=>{console.error("[SmartBatch] navigateByUrl failed",{targetUrl:l,err:i})})}getCountryFlag(t){let l={colombia:"\u{1F1E8}\u{1F1F4}",col:"\u{1F1E8}\u{1F1F4}",co:"\u{1F1E8}\u{1F1F4}","united states":"\u{1F1FA}\u{1F1F8}",usa:"\u{1F1FA}\u{1F1F8}",us:"\u{1F1FA}\u{1F1F8}",peru:"\u{1F1F5}\u{1F1EA}",pe:"\u{1F1F5}\u{1F1EA}",world:"\u{1F310}",mexico:"\u{1F1F2}\u{1F1FD}",mx:"\u{1F1F2}\u{1F1FD}",brazil:"\u{1F1E7}\u{1F1F7}",br:"\u{1F1E7}\u{1F1F7}",chile:"\u{1F1E8}\u{1F1F1}",cl:"\u{1F1E8}\u{1F1F1}",argentina:"\u{1F1E6}\u{1F1F7}",ar:"\u{1F1E6}\u{1F1F7}",ecuador:"\u{1F1EA}\u{1F1E8}",ec:"\u{1F1EA}\u{1F1E8}",venezuela:"\u{1F1FB}\u{1F1EA}",ve:"\u{1F1FB}\u{1F1EA}",bolivia:"\u{1F1E7}\u{1F1F4}",bo:"\u{1F1E7}\u{1F1F4}",uruguay:"\u{1F1FA}\u{1F1FE}",uy:"\u{1F1FA}\u{1F1FE}",paraguay:"\u{1F1F5}\u{1F1FE}",py:"\u{1F1F5}\u{1F1FE}",panama:"\u{1F1F5}\u{1F1E6}",pa:"\u{1F1F5}\u{1F1E6}","costa rica":"\u{1F1E8}\u{1F1F7}",cr:"\u{1F1E8}\u{1F1F7}",guatemala:"\u{1F1EC}\u{1F1F9}",gt:"\u{1F1EC}\u{1F1F9}",honduras:"\u{1F1ED}\u{1F1F3}",hn:"\u{1F1ED}\u{1F1F3}","el salvador":"\u{1F1F8}\u{1F1FB}",sv:"\u{1F1F8}\u{1F1FB}","dominican republic":"\u{1F1E9}\u{1F1F4}","rep\xFAblica dominicana":"\u{1F1E9}\u{1F1F4}","republica dominicana":"\u{1F1E9}\u{1F1F4}",do:"\u{1F1E9}\u{1F1F4}",canada:"\u{1F1E8}\u{1F1E6}",ca:"\u{1F1E8}\u{1F1E6}",spain:"\u{1F1EA}\u{1F1F8}",es:"\u{1F1EA}\u{1F1F8}"},i=(t||"").trim().toLowerCase(),c=l[i]??"\u{1F3F3}\uFE0F";return(!t||c==="\u{1F3F3}\uFE0F")&&console.log("[SmartBatch] getCountryFlag",{raw:t,key:i,resolved:c,hasMatch:i in l}),c}static{this.\u0275fac=function(l){return new(l||e)}}static{this.\u0275cmp=I({type:e,selectors:[["smart-batch"]],decls:21,vars:17,consts:[["createTemplateMenu","matMenu"],[1,"flex","flex-col","w-full","h-full","bg-[#f8fafc]","dark:bg-[#0f172a]","p-6","gap-6"],[1,"text-2xl","font-bold","tracking-tight","text-slate-900","dark:text-white"],[1,"mt-1","text-slate-500","dark:text-slate-400"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-4"],[1,"!rounded-lg",3,"change","value"],["value","configurations"],["value","templates"],[1,"flex","gap-2"],["mat-flat-button","","color","primary",1,"!rounded-lg","!px-6","!py-2"],["mat-flat-button","","color","primary",1,"!rounded-lg","!px-6","!py-2",3,"click"],[1,"mr-2","icon-size-5"],["mat-flat-button","","color","primary","disabled","",1,"!rounded-lg","!px-6","!py-2",3,"matTooltip"],["mat-flat-button","","color","primary",1,"!rounded-lg","!px-6","!py-2",3,"matMenuTriggerFor"],[1,"ml-2","icon-size-5"],["mat-menu-item",""],["mat-menu-item","",3,"click"],[1,"flex","flex-col","items-center","justify-center","flex-1"],[1,"flex","flex-col","items-center","justify-center","flex-1","border-2","border-dashed","border-slate-200","dark:border-slate-800","rounded-2xl","p-12","text-center"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-6"],["diameter","48"],[1,"mt-4","text-slate-500"],[1,"w-20","h-20","bg-slate-50","dark:bg-slate-900","rounded-full","flex","items-center","justify-center","mb-6"],[1,"text-slate-400","icon-size-10"],[1,"text-lg","font-medium","text-slate-900","dark:text-white"],[1,"text-slate-500","dark:text-slate-400","max-w-sm","mt-2","mb-6"],["mat-stroked-button","","color","primary",3,"click"],[1,"group","relative","bg-white","dark:bg-slate-900","rounded-2xl","border","border-slate-200","dark:border-slate-800","p-6","transition-all","hover:shadow-md","hover:border-blue-500/50","cursor-pointer"],[1,"group","relative","bg-white","dark:bg-slate-900","rounded-2xl","border","border-slate-200","dark:border-slate-800","p-6","transition-all","hover:shadow-md","hover:border-blue-500/50","cursor-pointer",3,"click"],[1,"absolute","top-4","right-4","opacity-0","group-hover:opacity-100","transition-opacity","flex","gap-1"],["mat-icon-button","",3,"click","matTooltip"],[1,"icon-size-5"],["mat-icon-button","","color","warn",3,"click","matTooltip"],[1,"flex","items-start","justify-between","mb-4"],[1,"flex","items-center","gap-3"],[1,"text-2xl"],[1,"font-semibold","text-slate-900","dark:text-white","line-clamp-1"],[1,"flex","items-center","gap-2","mt-0.5"],[1,"text-xs","font-medium","px-2","py-0.5","rounded-full","bg-slate-100","dark:bg-slate-800","text-slate-600","dark:text-slate-400"],[1,"text-xs","font-medium","px-2","py-0.5","rounded-full","bg-red-100","dark:bg-red-900/30","text-red-600","dark:text-red-400"],[1,"text-sm","text-slate-500","dark:text-slate-400","mb-6","line-clamp-2","min-h-[2.5rem]"],[1,"grid","grid-cols-2","gap-4","pt-4","border-t","border-slate-100","dark:border-slate-800"],[1,"block","text-xs","text-slate-400","font-medium","uppercase","tracking-wider"],[1,"text-lg","font-semibold","text-slate-900","dark:text-white"],[1,"text-sm","font-medium","text-slate-700","dark:text-slate-300","capitalize","truncate"],[1,"text-slate-500","dark:text-slate-400","max-w-sm","mt-2"],[1,"text-slate-400","dark:text-slate-500","text-sm","max-w-sm","mt-2"],[1,"group","relative","bg-white","dark:bg-slate-900","rounded-2xl","border","border-slate-200","dark:border-slate-800","p-6","transition-all","hover:shadow-md","hover:border-blue-500/50"],[1,"font-semibold","text-slate-900","dark:text-white","line-clamp-1","pr-16"],[1,"flex","flex-wrap","gap-2","mt-2"],[1,"text-sm","text-slate-500","dark:text-slate-400","mt-4","mb-4","line-clamp-2","min-h-[2.5rem]"],[1,"text-sm","font-medium","text-slate-700","dark:text-slate-300","truncate","block"],[1,"text-xs","text-slate-400","mt-3"]],template:function(l,i){l&1&&(n(0,"div",1)(1,"div")(2,"h1",2),r(3),p(4,"transloco"),a(),n(5,"p",3),r(6),p(7,"transloco"),a()(),n(8,"div",4)(9,"mat-button-toggle-group",5),g("change",function(u){return i.setActiveTab(u.value)}),n(10,"mat-button-toggle",6),r(11),p(12,"transloco"),a(),n(13,"mat-button-toggle",7),r(14),p(15,"transloco"),a()(),n(16,"div",8),v(17,ct,5,3,"button",9)(18,_t,3,1),a()(),v(19,Ct,3,1)(20,Et,3,1),a()),l&2&&(o(3),s(" ",m(4,9,"smartBatchLanding.title")," "),o(3),s(" ",m(7,11,"smartBatchLanding.subtitle")," "),o(3),b("value",i.activeTab()),o(2),f(m(12,13,"smartBatchLanding.configurationsTab")),o(3),f(m(15,15,"smartBatchLanding.reportTemplatesTab")),o(3),x(i.activeTab()==="configurations"?17:-1),o(),x(i.activeTab()==="templates"?18:-1),o(),x(i.activeTab()==="configurations"?19:-1),o(),x(i.activeTab()==="templates"?20:-1))},dependencies:[D,F,$,J,H,P,j,U,z,it,tt,et,X,Q,K,W,N,A,q,G,Z,Y],encapsulation:2})}}return e})();var te=[{path:"",component:rt},{path:"create",loadComponent:()=>import("./chunk-ZMNTNDFZ.js").then(e=>e.CreateBatchConfigComponent)},{path:"edit/:id",loadComponent:()=>import("./chunk-ZMNTNDFZ.js").then(e=>e.CreateBatchConfigComponent)},{path:":configId",loadComponent:()=>import("./chunk-SKKZKFQN.js").then(e=>e.BatchDashboardComponent)},{path:":configId/batch/new",loadComponent:()=>import("./chunk-OS42INQJ.js").then(e=>e.CreateBatchComponent)},{path:":configId/batch/:batchId",loadComponent:()=>import("./chunk-OMMLLWKJ.js").then(e=>e.BatchProcessingComponent)},{path:":configId/report-builder",loadComponent:()=>import("./chunk-BCYNGYKO.js").then(e=>e.ReportBuilderComponent)},{path:":configId/report-builder/:templateId",loadComponent:()=>import("./chunk-BCYNGYKO.js").then(e=>e.ReportBuilderComponent)},{path:":configId/batch/:batchId/report",loadComponent:()=>import("./chunk-I2GIJX2A.js").then(e=>e.ReportViewerComponent)}];export{te as default};
