import{a as H}from"./chunk-IOBAWF3C.js";import{b}from"./chunk-FTR6VSJR.js";import"./chunk-P6TIVLNX.js";import{a as q,b as G}from"./chunk-XQDPKUEO.js";import{a as z,b as U}from"./chunk-DLAWIIUM.js";import{c as R,d as $}from"./chunk-IHQN5EVA.js";import{b as K,d as j}from"./chunk-YGFCFPCR.js";import"./chunk-YM2RJPUK.js";import{V as L,X as N,Z as O,_ as P}from"./chunk-AFVGM62N.js";import{Eb as a,Fb as n,Gb as u,Hb as v,Ib as C,Mb as M,Nb as x,Oc as T,Pc as B,Qc as A,Wa as t,X as _,Xb as r,Yb as m,Zb as c,cd as F,f as k,fb as I,ga as y,hc as S,lb as f,oc as d,pc as g,qc as E,sb as s,ub as w,yc as D}from"./chunk-DCQLSIRV.js";import"./chunk-MG3ERZGY.js";var J=i=>({count:i});function Q(i,p){i&1&&(a(0,"div",8),u(1,"mat-spinner",9),n())}function V(i,p){i&1&&(a(0,"div",10)(1,"mat-icon",11),r(2,"search_off"),n(),a(3,"p",12),r(4),d(5,"transloco"),n()()),i&2&&(t(4),m(g(5,1,"smartMonitor.incidentNotFound")))}function W(i,p){if(i&1&&(a(0,"div",22)(1,"span",23),r(2),d(3,"transloco"),n(),a(4,"span",24),r(5),n()()),i&2){let e=x(2);t(2),m(g(3,2,"smartMonitor.resolved")),t(3),m(e.formatDate(e.incident.endDate))}}function X(i,p){i&1&&(a(0,"div",32)(1,"mat-icon",33),r(2,"article"),n(),a(3,"p",34),r(4),d(5,"transloco"),n(),a(6,"p",35),r(7),d(8,"transloco"),n()()),i&2&&(t(4),c(" ",g(5,2,"smartMonitor.noPublicUpdates")," "),t(3),c(" ",g(8,4,"smartMonitor.investigatingMessage")," "))}function Y(i,p){if(i&1&&u(0,"div",50),i&2){let e=x().$implicit,l=x(3);s("ngClass",l.getCategoryCfg(e.category).connectorClass)}}function Z(i,p){if(i&1&&(a(0,"p",51),r(1),n()),i&2){let e=x().$implicit;t(),c(" ",e.publicLog," ")}}function ee(i,p){i&1&&(a(0,"p",52),r(1),d(2,"transloco"),n()),i&2&&(t(),c(" ",g(2,1,"smartMonitor.automaticSystemUpdate")," "))}function te(i,p){i&1&&(a(0,"p",52),r(1),d(2,"transloco"),n()),i&2&&(t(),c(" ",g(2,1,"smartMonitor.noDetailsProvided")," "))}function ie(i,p){if(i&1&&(v(0),a(1,"div",38)(2,"div",39)(3,"div",40)(4,"mat-icon",41),r(5),n()(),f(6,Y,1,1,"div",42),n(),a(7,"div",43)(8,"div",44)(9,"span",45),r(10),d(11,"transloco"),n(),a(12,"span",46),r(13),n()(),a(14,"div",47),f(15,Z,2,1,"p",48)(16,ee,3,3,"p",49)(17,te,3,3,"p",49),n()()(),C()),i&2){let e=p.$implicit,l=p.last,o=x(3);t(3),s("ngClass",o.getCategoryCfg(e.category).classes),t(2),m(o.getCategoryCfg(e.category).icon),t(),s("ngIf",!l),t(),w("pb-0",l),t(2),s("ngClass",o.getCategoryCfg(e.category).classes),t(),c(" ",g(11,12,o.getCategoryCfg(e.category).labelKey)," "),t(2),s("matTooltip",o.formatDate(e.createdAt)),t(),c(" ",o.formatRelative(e.createdAt)," "),t(2),s("ngIf",e.publicLog),t(),s("ngIf",!e.publicLog&&e.automaticMessage),t(),s("ngIf",!e.publicLog&&!e.automaticMessage)}}function ne(i,p){if(i&1&&(a(0,"div",36),f(1,ie,18,14,"ng-container",37),n()),i&2){let e=x(2);t(),s("ngForOf",e.logs)}}function ae(i,p){if(i&1&&(v(0),a(1,"div",13)(2,"div",14)(3,"div",15)(4,"div",16)(5,"h2",17),r(6),d(7,"transloco"),n(),a(8,"p",18),r(9),n()(),a(10,"span",19),u(11,"span",20),r(12),d(13,"transloco"),n()()(),a(14,"div",21)(15,"div",22)(16,"span",23),r(17),d(18,"transloco"),n(),a(19,"span",24),r(20),n()(),a(21,"div",22)(22,"span",23),r(23),d(24,"transloco"),n(),a(25,"span",24),r(26),n()(),f(27,W,6,4,"div",25),n()(),a(28,"div",26)(29,"h3",27)(30,"mat-icon",28),r(31,"timeline"),n(),r(32),d(33,"transloco"),a(34,"span",29),r(35),d(36,"transloco"),n()(),f(37,X,9,6,"div",30)(38,ne,2,1,"div",31),n(),C()),i&2){let e=x();t(6),c(" ",e.getServiceName()||g(7,14,"smartMonitor.unknownService")," "),t(3),c(" ",e.incident.code," "),t(),s("ngClass",e.getStatusCfg(e.incident.status).classes),t(),s("ngClass",e.getStatusCfg(e.incident.status).dotClass),t(),c(" ",g(13,16,e.getStatusCfg(e.incident.status).labelKey)," "),t(5),m(g(18,18,"smartMonitor.started")),t(3),m(e.formatDate(e.incident.startDate)),t(3),m(g(24,20,"smartMonitor.duration")),t(3),m(e.formatDuration(e.incident.duration)),t(),s("ngIf",e.incident.endDate),t(5),c(" ",g(33,22,"smartMonitor.incidentLog")," "),t(3),c(" ",E(36,24,"smartMonitor.updatesCount",S(27,J,e.logs.length))," "),t(2),s("ngIf",e.logs.length===0),t(),s("ngIf",e.logs.length>0)}}var we=(()=>{class i{constructor(){this._service=y(H),this._route=y(K),this._router=y(j),this._cdr=y(D),this._unsubscribeAll=new k,this.loading=!0,this.incident=null,this.logs=[],this.categoryConfig={investigating:{labelKey:"smartMonitor.categoryInvestigating",icon:"search",classes:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800",connectorClass:"bg-blue-300 dark:bg-blue-700"},identified:{labelKey:"smartMonitor.categoryIdentified",icon:"manage_search",classes:"bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400 border-orange-200 dark:border-orange-800",connectorClass:"bg-orange-300 dark:bg-orange-700"},fixing:{labelKey:"smartMonitor.categoryFixing",icon:"build",classes:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400 border-yellow-200 dark:border-yellow-800",connectorClass:"bg-yellow-300 dark:bg-yellow-700"},resolved:{labelKey:"smartMonitor.categoryResolved",icon:"check_circle",classes:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 border-green-200 dark:border-green-800",connectorClass:"bg-green-300 dark:bg-green-700"},privateNote:{labelKey:"smartMonitor.categoryNote",icon:"sticky_note_2",classes:"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400 border-gray-200 dark:border-gray-700",connectorClass:"bg-gray-300 dark:bg-gray-700"}},this.statusConfig={down:{labelKey:"smartMonitor.statusDown",classes:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",dotClass:"bg-red-500 animate-pulse"},review:{labelKey:"smartMonitor.statusReview",classes:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",dotClass:"bg-yellow-500 animate-pulse"},up:{labelKey:"smartMonitor.statusUp",classes:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",dotClass:"bg-green-500"},closed:{labelKey:"smartMonitor.statusClosed",classes:"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400",dotClass:"bg-gray-400"}}}ngOnInit(){let e=this._route.snapshot.paramMap.get("id");e&&this._loadIncident(e)}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}_loadIncident(e){this._service.getIncidents({_id:e,populates:["appFeature","resolution"]}).pipe(_(this._unsubscribeAll)).subscribe({next:l=>{let o=l.data||l;this.incident=Array.isArray(o)?o[0]:o,this._loadLogs(e)},error:()=>{this.loading=!1,this._cdr.markForCheck()}})}_loadLogs(e){this._service.getIncidentLogs({where_incident:e,sort:"createdAt"}).pipe(_(this._unsubscribeAll)).subscribe({next:l=>{let o=l.data||l||[];this.logs=o.filter(h=>h.category!=="privateNote"),this.loading=!1,this._cdr.markForCheck()},error:()=>{this.loading=!1,this._cdr.markForCheck()}})}getCategoryCfg(e){return this.categoryConfig[e]??this.categoryConfig.investigating}getStatusCfg(e){return this.statusConfig[e]??this.statusConfig.closed}getServiceName(){return this.incident?.appFeature?.name||this.incident?.code||""}formatDate(e){return e?b.fromISO(e).toLocaleString(b.DATETIME_MED):"N/A"}formatRelative(e){return e?b.fromISO(e).toRelative()??"":""}formatDuration(e){if(!e)return"\u2014";if(e<60)return`${e}m`;let l=Math.floor(e/60),o=e%60;return o?`${l}h ${o}m`:`${l}h`}goBack(){this._router.navigate(["/smart-monitor/incidents"])}static{this.\u0275fac=function(l){return new(l||i)}}static{this.\u0275cmp=I({type:i,selectors:[["incident-detail"]],decls:11,vars:6,consts:[[1,"flex","flex-col","flex-auto","min-w-0","bg-gray-50","dark:bg-gray-900","min-h-screen"],[1,"flex","flex-col","w-full","max-w-3xl","mx-auto","p-6","md:p-8"],[1,"mb-6"],["mat-button","",1,"-ml-2","text-gray-500","hover:text-gray-900","dark:hover:text-white",3,"click"],[1,"icon-size-4","mr-1"],["class","flex flex-auto justify-center items-center py-24",4,"ngIf"],["class","flex flex-col items-center justify-center py-24 text-center",4,"ngIf"],[4,"ngIf"],[1,"flex","flex-auto","justify-center","items-center","py-24"],["diameter","56"],[1,"flex","flex-col","items-center","justify-center","py-24","text-center"],[1,"icon-size-16","text-gray-300","dark:text-gray-600","mb-4"],[1,"text-lg","font-medium","text-gray-600","dark:text-gray-400"],[1,"bg-white","dark:bg-gray-800","rounded-2xl","shadow-sm","border","border-gray-200","dark:border-gray-700","overflow-hidden","mb-8"],[1,"p-6","border-b","border-gray-100","dark:border-gray-700/50"],[1,"flex","items-start","justify-between","gap-4"],[1,"min-w-0"],[1,"text-xl","font-bold","text-gray-900","dark:text-white","leading-tight"],[1,"text-sm","text-gray-400","font-mono","mt-0.5"],[1,"flex-shrink-0","inline-flex","items-center","gap-2","px-3","py-1.5","rounded-full","text-sm","font-semibold",3,"ngClass"],[1,"w-2","h-2","rounded-full",3,"ngClass"],[1,"grid","grid-cols-2","sm:grid-cols-3","gap-0","divide-x","divide-y","divide-gray-100","dark:divide-gray-700/50"],[1,"px-5","py-4","flex","flex-col","gap-0.5"],[1,"text-xs","font-semibold","uppercase","tracking-wide","text-gray-400"],[1,"text-sm","font-medium","text-gray-800","dark:text-gray-200"],["class","px-5 py-4 flex flex-col gap-0.5",4,"ngIf"],[1,"mb-4"],[1,"text-base","font-semibold","text-gray-700","dark:text-gray-300","mb-5","flex","items-center","gap-2"],[1,"icon-size-5","text-gray-400"],[1,"ml-2","text-xs","font-medium","bg-gray-100","dark:bg-gray-700","text-gray-500","dark:text-gray-400","px-2","py-0.5","rounded-full"],["class","flex flex-col items-center justify-center py-12 text-center bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700",4,"ngIf"],["class","relative flex flex-col gap-0",4,"ngIf"],[1,"flex","flex-col","items-center","justify-center","py-12","text-center","bg-white","dark:bg-gray-800","rounded-2xl","border","border-gray-200","dark:border-gray-700"],[1,"icon-size-12","text-gray-300","dark:text-gray-600","mb-3"],[1,"text-gray-500","dark:text-gray-400"],[1,"text-gray-400","dark:text-gray-500","text-sm","mt-1"],[1,"relative","flex","flex-col","gap-0"],[4,"ngFor","ngForOf"],[1,"flex","gap-4"],[1,"flex","flex-col","items-center","flex-shrink-0"],[1,"flex","items-center","justify-center","w-8","h-8","rounded-full","border-2","z-10",3,"ngClass"],[1,"icon-size-4"],["class","timeline-connector w-0.5 flex-auto my-1 min-h-[1.5rem]",3,"ngClass",4,"ngIf"],[1,"flex-auto","pb-6"],[1,"flex","flex-wrap","items-center","gap-2","mb-2"],[1,"inline-flex","items-center","px-2.5","py-0.5","rounded-full","text-xs","font-semibold","border",3,"ngClass"],[1,"text-xs","text-gray-400","dark:text-gray-500",3,"matTooltip"],[1,"bg-white","dark:bg-gray-800","rounded-xl","border","border-gray-200","dark:border-gray-700","px-4","py-3","text-sm","text-gray-700","dark:text-gray-300","leading-relaxed"],["class","whitespace-pre-wrap",4,"ngIf"],["class","text-gray-400 italic text-xs",4,"ngIf"],[1,"timeline-connector","w-0.5","flex-auto","my-1","min-h-[1.5rem]",3,"ngClass"],[1,"whitespace-pre-wrap"],[1,"text-gray-400","italic","text-xs"]],template:function(l,o){l&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),M("click",function(){return o.goBack()}),a(4,"mat-icon",4),r(5,"arrow_back"),n(),r(6),d(7,"transloco"),n()(),f(8,Q,2,0,"div",5)(9,V,6,3,"div",6)(10,ae,39,29,"ng-container",7),n()()),l&2&&(t(6),c(" ",g(7,4,"smartMonitor.backToIncidents")," "),t(2),s("ngIf",o.loading),t(),s("ngIf",!o.loading&&!o.incident),t(),s("ngIf",!o.loading&&o.incident))},dependencies:[F,T,B,A,$,R,G,q,N,L,P,O,U,z],styles:["incident-detail[_ngcontent-%COMP%]{display:block}.timeline-connector[_ngcontent-%COMP%]{width:2px;flex-shrink:0}"],changeDetection:0})}}return i})();export{we as IncidentDetailComponent};
