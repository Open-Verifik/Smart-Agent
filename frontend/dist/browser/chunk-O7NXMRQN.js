import{a as Ce}from"./chunk-SD536L7G.js";import{b as le}from"./chunk-XJE64V44.js";import"./chunk-3RK6DDJD.js";import{l as ve}from"./chunk-2F4JBQLG.js";import"./chunk-QD66ZOCP.js";import{c as fe,d as _e}from"./chunk-IEVXMBCH.js";import{a as he,b as be}from"./chunk-MVXXFAEU.js";import{a as ee,c as te,h as $}from"./chunk-BJAZCYPM.js";import{a as se,b as de}from"./chunk-53WRULVM.js";import{d as oe}from"./chunk-YTRC6VXI.js";import{b as X,d as Q,i as Z}from"./chunk-QIQIZ3Q6.js";import{d as ie,f as re,l as ne,m as ae}from"./chunk-CTJ3YQQD.js";import{A as ge,B as xe,c as ce,e as Y,h as me,q as pe,z as ue}from"./chunk-QWR6CIPV.js";import"./chunk-MVN6OMHF.js";import{U as z,V as N,X as A,Z as U,_ as J}from"./chunk-KMUH6FME.js";import{Dc as E,Eb as a,Fb as r,Ga as k,Gb as T,Kb as y,Mb as b,Nb as p,Oc as H,Pc as O,Qc as j,Wa as l,Xb as o,Yb as R,Zb as h,_b as V,cd as P,fb as D,ga as B,hc as K,kc as W,lb as f,qa as C,ra as w,sb as d,tb as G,ub as L}from"./chunk-BMVGBJ55.js";import"./chunk-66YHNWRR.js";function Te(i,c){if(i&1&&(a(0,"div",20)(1,"mat-icon",21),o(2,"lightbulb"),r(),a(3,"span",22),o(4),r()()),i&2){let e=p();l(4),R(e.currentStepData().tip)}}function Fe(i,c){if(i&1&&T(0,"span",23),i&2){let e=c.index,t=p();L("bg-indigo-500",e===t.currentStep())("bg-slate-300",e!==t.currentStep())("dark:bg-slate-600",e!==t.currentStep())}}function Be(i,c){if(i&1){let e=y();a(0,"button",24),b("click",function(){C(e);let n=p();return w(n.nextStep())}),o(1," Next "),a(2,"mat-icon",25),o(3,"arrow_forward"),r()()}}function Ve(i,c){if(i&1){let e=y();a(0,"button",24),b("click",function(){C(e);let n=p();return w(n.close())}),o(1," Get Started "),a(2,"mat-icon",25),o(3,"rocket_launch"),r()()}}var we=(()=>{class i{constructor(){this._dialogRef=B(ee),this.currentStep=k(0),this.steps=[{icon:"waving_hand",title:"Welcome to Batch Creation!",description:"This wizard will help you upload and process data in bulk. Let's walk through the key steps together.",tip:"You can replay this tutorial anytime by clicking the help button in the top right corner."},{icon:"edit",title:"Step 1: Name Your Batch",description:'Give your batch a descriptive name so you can easily identify it later. For example: "January 2026 Verifications" or "HR Background Checks Q1".'},{icon:"download",title:"Step 2: Download the Template",description:"Before uploading, download the CSV template. This template includes all the required columns based on your batch configuration.",tip:"The template ensures your data has the correct format and all required fields are present."},{icon:"table_chart",title:"Step 3: Fill Your Data",description:"Open the template in Excel or Google Sheets and fill in your data. Each row represents one record to be processed.",tip:"Make sure all required fields (marked with *) are filled in. Empty required fields will cause errors."},{icon:"cloud_upload",title:"Step 4: Upload Your File",description:"Drag and drop your completed CSV file into the upload area, or click to browse. We'll validate the data and show you a preview."},{icon:"visibility",title:"Step 5: Review & Submit",description:'Check the data preview to make sure everything looks correct. Review the estimated cost, then click "Create Batch" to start processing!',tip:"You can remove the file and upload a different one if you spot any issues."}],this.currentStepData=()=>this.steps[this.currentStep()],this.progressPercent=()=>(this.currentStep()+1)/this.steps.length*100}nextStep(){this.currentStep()<this.steps.length-1&&this.currentStep.update(e=>e+1)}prevStep(){this.currentStep()>0&&this.currentStep.update(e=>e-1)}close(){this._dialogRef.close()}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=D({type:i,selectors:[["batch-tutorial-modal"]],decls:29,vars:12,consts:[[1,"flex","flex-col","w-full","max-w-lg"],[1,"relative","px-6","pt-6","pb-4"],[1,"absolute","top-0","left-0","right-0","h-1","bg-slate-200","dark:bg-slate-700"],[1,"h-full","bg-gradient-to-r","from-indigo-500","to-purple-600","transition-all","duration-300"],[1,"flex","items-center","justify-between"],[1,"text-xs","font-medium","text-slate-500","dark:text-slate-400"],["mat-icon-button","",1,"!-mr-2",3,"click"],[1,"px-6","pb-6"],[1,"flex","flex-col","items-center","text-center","py-8"],[1,"w-20","h-20","rounded-2xl","bg-gradient-to-br","from-indigo-500","to-purple-600","flex","items-center","justify-center","mb-6","shadow-lg","shadow-indigo-500/25","animate-pulse"],[1,"!w-10","!h-10","text-white","icon-size-10"],[1,"text-xl","font-bold","text-slate-900","dark:text-white","mb-3"],[1,"text-slate-600","dark:text-slate-400","text-sm","leading-relaxed","max-w-md"],["class","mt-4 flex items-start gap-2 p-3 rounded-lg bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800/50 text-left",4,"ngIf"],[1,"flex","items-center","justify-between","pt-4","border-t","border-slate-200","dark:border-slate-700"],["mat-button","",1,"!text-slate-600",3,"click","disabled"],[1,"mr-1"],[1,"flex","gap-1.5"],["class","w-2 h-2 rounded-full transition-all duration-300",3,"bg-indigo-500","bg-slate-300","dark:bg-slate-600",4,"ngFor","ngForOf"],["mat-flat-button","","color","primary",3,"click",4,"ngIf"],[1,"mt-4","flex","items-start","gap-2","p-3","rounded-lg","bg-amber-50","dark:bg-amber-900/20","border","border-amber-200","dark:border-amber-800/50","text-left"],[1,"text-amber-500","!w-5","!h-5","shrink-0","icon-size-5"],[1,"text-xs","text-amber-700","dark:text-amber-300"],[1,"w-2","h-2","rounded-full","transition-all","duration-300"],["mat-flat-button","","color","primary",3,"click"],[1,"ml-1"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),T(3,"div",3),r(),a(4,"div",4)(5,"span",5),o(6),r(),a(7,"button",6),b("click",function(){return n.close()}),a(8,"mat-icon"),o(9,"close"),r()()()(),a(10,"div",7)(11,"div",8)(12,"div",9)(13,"mat-icon",10),o(14),r()(),a(15,"h2",11),o(16),r(),a(17,"p",12),o(18),r(),f(19,Te,5,1,"div",13),r(),a(20,"div",14)(21,"button",15),b("click",function(){return n.prevStep()}),a(22,"mat-icon",16),o(23,"arrow_back"),r(),o(24," Back "),r(),a(25,"div",17),f(26,Fe,1,6,"span",18),r(),f(27,Be,4,0,"button",19)(28,Ve,4,0,"button",19),r()()()),t&2&&(l(3),G("width",n.progressPercent(),"%"),l(3),V(" Step ",n.currentStep()+1," of ",n.steps.length," "),l(8),R(n.currentStepData().icon),l(2),h(" ",n.currentStepData().title," "),l(2),h(" ",n.currentStepData().description," "),l(),d("ngIf",n.currentStepData().tip),l(2),d("disabled",n.currentStep()===0),l(5),d("ngForOf",n.steps),l(),d("ngIf",n.currentStep()<n.steps.length-1),l(),d("ngIf",n.currentStep()===n.steps.length-1))},dependencies:[P,O,j,$,A,N,z,J,U],styles:["[_nghost-%COMP%]{display:block}"]})}}return i})();var Me=i=>({"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":i}),Re=(i,c,e,t)=>({"bg-orange-100 dark:bg-orange-900/30 border-l-4 border-l-orange-400":i,"bg-red-100 dark:bg-red-900/30 border-l-4 border-l-red-500":c,"text-slate-700 dark:text-slate-300":e,"text-red-800 dark:text-red-300 font-medium":t});function qe(i,c){i&1&&(a(0,"div",10),T(1,"mat-spinner",11),a(2,"p",12),o(3,"Loading configuration..."),r()())}function De(i,c){i&1&&(a(0,"mat-icon",67),o(1,"priority_high"),r())}function Le(i,c){i&1&&(a(0,"mat-icon",67),o(1,"remove"),r())}function Oe(i,c){i&1&&(a(0,"span",68),o(1,"Required"),r())}function je(i,c){i&1&&(a(0,"span",69),o(1,"Optional"),r())}function Pe(i,c){i&1&&(a(0,"span",70),o(1," \u2022 Options "),r())}function $e(i,c){if(i&1&&(a(0,"span",73),o(1),r()),i&2){let e=c.$implicit;l(),h(" ",e," ")}}function ze(i,c){if(i&1&&(a(0,"div",71),f(1,$e,2,1,"span",72),r()),i&2){let e=p().$implicit;l(),d("ngForOf",e.enumValues)}}function Ne(i,c){if(i&1&&(a(0,"div",56)(1,"div",57),f(2,De,2,0,"mat-icon",58)(3,Le,2,0,"mat-icon",58),r(),a(4,"div",59)(5,"div",60)(6,"code",61),o(7),r(),f(8,Oe,2,0,"span",62)(9,je,2,0,"span",63)(10,Pe,2,0,"span",64),r(),a(11,"p",65),o(12),r(),f(13,ze,2,1,"div",66),r()()),i&2){let e=c.$implicit;d("ngClass",e.required?"border-orange-200 dark:border-orange-800/50":"border-slate-200 dark:border-slate-700"),l(),d("ngClass",e.required?"bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400":"bg-slate-100 text-slate-500 dark:bg-slate-700"),l(),d("ngIf",e.required),l(),d("ngIf",!e.required),l(4),R(e.field),l(),d("ngIf",e.required),l(),d("ngIf",!e.required),l(),d("ngIf",e.enumValues==null?null:e.enumValues.length),l(2),h(" Used by: ",e.stepName," "),l(),d("ngIf",e.enumValues==null?null:e.enumValues.length)}}function Ae(i,c){if(i&1&&(a(0,"div")(1,"h4",53),o(2," Required Fields "),r(),a(3,"div",54),f(4,Ne,14,10,"div",55),r()()),i&2){let e=p(3);l(4),d("ngForOf",e.requiredFields())}}function Ue(i,c){i&1&&(a(0,"div",74)(1,"mat-icon",75),o(2,"table_chart"),r(),a(3,"p"),o(4,"No specific fields required. You can upload any CSV structure."),r()())}function Je(i,c){if(i&1){let e=y();a(0,"div",39)(1,"div",40)(2,"div",41)(3,"mat-icon",42),o(4,"rocket_launch"),r()(),a(5,"div",43)(6,"h4",44),o(7,"Quick Start"),r(),a(8,"p",45),o(9," Download our pre-configured template with all the required columns, fill it with your data, then upload it here. "),r(),a(10,"button",46),b("click",function(n){return C(e),p(2).downloadTemplate(),w(n.stopPropagation())}),a(11,"mat-icon",47),o(12,"download"),r(),o(13," Download CSV Template "),r()()(),f(14,Ae,5,1,"div",48)(15,Ue,5,0,"div",49),a(16,"div",50)(17,"mat-icon",51),o(18,"lightbulb"),r(),a(19,"div",52)(20,"strong"),o(21,"Pro tip:"),r(),o(22," Make sure your CSV headers match the field names exactly. The column order doesn't matter, but the names must match. "),r()()()}if(i&2){let e=p(2);l(14),d("ngIf",e.requiredFields().length>0),l(),d("ngIf",e.requiredFields().length===0)}}function Ye(i,c){if(i&1){let e=y();a(0,"button",76),b("click",function(){C(e);let n=p(2);return w(n.downloadTemplate())}),a(1,"mat-icon",77),o(2,"download"),r(),o(3," Template "),r()}}function Ge(i,c){if(i&1){let e=y();a(0,"div",78),b("dragover",function(n){C(e);let s=p(2);return w(s.onDragOver(n))})("dragleave",function(n){C(e);let s=p(2);return w(s.onDragLeave(n))})("drop",function(n){C(e);let s=p(2);return w(s.onDrop(n))}),a(1,"input",79),b("change",function(n){C(e);let s=p(2);return w(s.onFileSelected(n))}),r(),a(2,"label",80)(3,"div",81)(4,"mat-icon",82),o(5,"cloud_upload"),r()(),a(6,"p",83),o(7," Drop your file here or click to browse "),r(),a(8,"p",84),o(9),r()()()}if(i&2){let e,t=p(2);d("ngClass",K(3,Me,t.isDragging())),l(),d("accept",t.acceptedFormats()),l(8),h(" Accepts ",((e=t.configuration())==null||e.inputFormat==null?null:e.inputFormat.toUpperCase())||"CSV, XLSX, JSONL"," files ")}}function Ke(i,c){if(i&1){let e=y();a(0,"div",92)(1,"mat-icon",93),o(2,"error"),r(),a(3,"div")(4,"p",94),o(5),r(),a(6,"button",95),b("click",function(){C(e);let n=p(3);return w(n.downloadTemplate())}),a(7,"mat-icon",96),o(8,"download"),r(),o(9," Download Template "),r()()()}if(i&2){let e=p(3);l(5),R(e.parseError())}}function We(i,c){if(i&1&&(a(0,"div",97)(1,"mat-icon",98),o(2,"check_circle"),r(),a(3,"div")(4,"p",99),o(5),r(),a(6,"p",100),o(7),r()()()),i&2){let e=p(3);l(5),h(" ",e.parsedRows().length," rows parsed successfully "),l(2),h(" ",e.previewColumns().length," columns detected ")}}function He(i,c){if(i&1){let e=y();a(0,"div",85)(1,"div",86)(2,"div",87)(3,"mat-icon",7),o(4,"description"),r()(),a(5,"div",43)(6,"p",88),o(7),r(),a(8,"p",84),o(9),r()(),a(10,"button",89),b("click",function(){C(e);let n=p(2);return w(n.removeFile())}),a(11,"mat-icon"),o(12,"close"),r()()(),f(13,Ke,10,1,"div",90)(14,We,8,2,"div",91),r()}if(i&2){let e,t,n=p(2);l(7),h(" ",(e=n.selectedFile())==null?null:e.name," "),l(2),h(" ",n.formatFileSize(((t=n.selectedFile())==null?null:t.size)||0)," "),l(4),d("ngIf",n.parseError()),l(),d("ngIf",n.parsedRows().length>0&&!n.parseError())}}function Xe(i,c){if(i&1&&(a(0,"span",111)(1,"mat-icon",112),o(2,"error"),r(),o(3),r()),i&2){let e,t=p(3);l(3),V(" ",(e=t.errorSummary())==null?null:e.totalErrors," issue",((e=t.errorSummary())==null?null:e.totalErrors)!==1?"s":""," ")}}function Qe(i,c){if(i&1&&(a(0,"span",118),T(1,"span",119),o(2),r()),i&2){let e,t=p(4);l(2),V(" ",(e=t.errorSummary())==null?null:e.missingCount," missing value",((e=t.errorSummary())==null?null:e.missingCount)!==1?"s":""," ")}}function Ze(i,c){if(i&1&&(a(0,"span",118),T(1,"span",120),o(2),r()),i&2){let e,t=p(4);l(2),V(" ",(e=t.errorSummary())==null?null:e.invalidEnumCount," invalid value",((e=t.errorSummary())==null?null:e.invalidEnumCount)!==1?"s":""," ")}}function et(i,c){if(i&1&&(a(0,"div",113)(1,"span",114)(2,"mat-icon",115),o(3,"warning"),r(),o(4," Fix the highlighted cells to continue "),r(),a(5,"div",116),f(6,Qe,3,2,"span",117)(7,Ze,3,2,"span",117),r()()),i&2){let e,t,n=p(3);l(6),d("ngIf",(e=n.errorSummary())==null?null:e.missingCount),l(),d("ngIf",(t=n.errorSummary())==null?null:t.invalidEnumCount)}}function tt(i,c){if(i&1&&(a(0,"th",121),o(1),r()),i&2){let e=c.$implicit;l(),h(" ",e," ")}}function it(i,c){if(i&1&&(a(0,"mat-icon",127),o(1," error_outline "),r()),i&2){let e=p().index,t=p(3);d("matTooltip",t.getRowErrors(e).length+" error"+(t.getRowErrors(e).length>1?"s":"")+" in this row")}}function rt(i,c){if(i&1&&(a(0,"mat-icon",130),o(1),r()),i&2){let e,t,n=p().$implicit,s=p().index,m=p(3);d("ngClass",((e=m.getCellError(s,n))==null?null:e.type)==="missing"?"text-orange-500":"text-red-500"),l(),h(" ",((t=m.getCellError(s,n))==null?null:t.type)==="missing"?"warning":"error"," ")}}function nt(i,c){if(i&1&&(a(0,"td",128)(1,"span",124)(2,"span"),o(3),r(),f(4,rt,2,2,"mat-icon",129),r()()),i&2){let e,t,n,s=c.$implicit,m=p(),u=m.$implicit,_=m.index,x=p(3);d("ngClass",W(5,Re,((e=x.getCellError(_,s))==null?null:e.type)==="missing",((e=x.getCellError(_,s))==null?null:e.type)==="invalid_enum",!x.getCellError(_,s),x.getCellError(_,s)))("matTooltip",((t=x.getCellError(_,s))==null?null:t.message)||"")("matTooltipDisabled",!x.getCellError(_,s)),l(3),R(u[s]||(((n=x.getCellError(_,s))==null?null:n.type)==="missing"?"(empty)":"-")),l(),d("ngIf",x.getCellError(_,s))}}function at(i,c){if(i&1&&(a(0,"tr",122)(1,"td",123)(2,"span",124),o(3),f(4,it,2,1,"mat-icon",125),r()(),f(5,nt,5,10,"td",126),r()),i&2){let e=c.index,t=p(3);d("ngClass",t.rowHasErrors(e)?"border-red-200 dark:border-red-800 bg-red-50/30 dark:bg-red-900/10":"border-slate-100 dark:border-slate-800"),l(3),h(" ",e+1," "),l(),d("ngIf",t.rowHasErrors(e)),l(),d("ngForOf",t.previewColumns())}}function ot(i,c){if(i&1&&(a(0,"div",131)(1,"mat-icon",115),o(2,"info"),r(),o(3),r()),i&2){let e=p(3);l(3),h(" ",e.errorSummary().rowsWithErrors-10," more rows have errors (not shown in preview) ")}}function lt(i,c){if(i&1&&(a(0,"div",101)(1,"div",27)(2,"div",16)(3,"h2",19),o(4," Data Preview "),r(),f(5,Xe,4,2,"span",102),r(),a(6,"span",84),o(7),r()(),f(8,et,8,2,"div",103),a(9,"div",104)(10,"table",105)(11,"thead")(12,"tr",106)(13,"th",107),o(14," # "),r(),f(15,tt,2,1,"th",108),r()(),a(16,"tbody"),f(17,at,6,4,"tr",109),r()()(),f(18,ot,4,1,"div",110),r()),i&2){let e=p(2);d("ngClass",e.parseError()?"border-red-300 dark:border-red-800":"border-slate-200 dark:border-slate-800"),l(5),d("ngIf",e.errorSummary()),l(2),V(" Showing first ",e.parsedRows().length>10?10:e.parsedRows().length," of ",e.parsedRows().length," rows "),l(),d("ngIf",e.errorSummary()),l(7),d("ngForOf",e.previewColumns()),l(2),d("ngForOf",e.parsedRows().slice(0,10)),l(),d("ngIf",e.errorSummary()&&e.errorSummary().rowsWithErrors>10)}}function st(i,c){if(i&1&&(a(0,"div",132)(1,"div",1)(2,"div")(3,"p",133),o(4,"Estimated Cost"),r(),a(5,"p",134),o(6),r()(),a(7,"div",135)(8,"p",133),o(9),r(),a(10,"p",136),o(11),r()()()()),i&2){let e,t=p(2);l(6),h("$",t.estimatedCost().toFixed(2),""),l(3),h("",t.parsedRows().length," rows"),l(2),h("\xD7 ",((e=t.configuration())==null||e.steps==null?null:e.steps.length)||0," steps")}}function dt(i,c){i&1&&T(0,"mat-spinner",137)}function ct(i,c){i&1&&(a(0,"mat-icon",47),o(1,"rocket_launch"),r())}function mt(i,c){if(i&1){let e=y();a(0,"div",13)(1,"div",14)(2,"div",15),b("click",function(){C(e);let n=p();return w(n.toggleRequiredFieldsPanel())}),a(3,"div",16)(4,"div",17)(5,"mat-icon",18),o(6,"info"),r()(),a(7,"div")(8,"h2",19),o(9," CSV File Requirements "),r(),a(10,"p",20),o(11),r()()(),a(12,"mat-icon",21),o(13," expand_more "),r()(),f(14,Je,23,2,"div",22),r(),a(15,"div",23)(16,"h2",24),o(17,"Batch Details"),r(),a(18,"mat-form-field",25)(19,"mat-label"),o(20,"Batch Name"),r(),T(21,"input",26),a(22,"mat-hint"),o(23,"Give your batch a descriptive name"),r()()(),a(24,"div",23)(25,"div",27)(26,"h2",19),o(27,"Upload Data"),r(),f(28,Ye,4,0,"button",28),r(),f(29,Ge,10,5,"div",29)(30,He,15,4,"div",30),r(),f(31,lt,19,8,"div",31)(32,st,12,3,"div",32),a(33,"div",33)(34,"button",34),b("click",function(){C(e);let n=p();return w(n.goBack())}),o(35,"Cancel"),r(),a(36,"span",35)(37,"button",36),b("click",function(){C(e);let n=p();return w(n.submit())}),f(38,dt,1,0,"mat-spinner",37)(39,ct,2,0,"mat-icon",38),o(40),r()()()()}if(i&2){let e=p();l(11),V(" ",e.templateFields().length," required field",e.templateFields().length!==1?"s":""," based on your configuration "),l(),L("rotate-180",e.showRequiredFieldsPanel()),l(2),d("ngIf",e.showRequiredFieldsPanel()),l(7),d("formControl",e.batchForm.get("name")),l(7),d("ngIf",!e.selectedFile()),l(),d("ngIf",!e.selectedFile()),l(),d("ngIf",e.selectedFile()),l(),d("ngIf",e.parsedRows().length>0),l(),d("ngIf",e.parsedRows().length>0&&!e.parseError()),l(4),d("matTooltip",(!e.hasValidData()||e.parseError())&&e.createBatchDisabledReason()?e.createBatchDisabledReason():""),l(),d("disabled",!e.hasValidData()||e.isSubmitting()||e.parseError()),l(),d("ngIf",e.isSubmitting()),l(),d("ngIf",!e.isSubmitting()),l(),h(" ",e.isSubmitting()?"Creating...":"Create Batch"," ")}}var At=(()=>{class i{constructor(){this._smartBatchService=B(Ce),this._router=B(Q),this._route=B(X),this._formBuilder=B(ue),this._dialog=B(te),this.TUTORIAL_STORAGE_KEY="smart-batch-tutorial-shown",this.configId=k(null),this.configuration=k(null),this.isLoading=k(!0),this.isSubmitting=k(!1),this.showRequiredFieldsPanel=k(!0),this.batchForm=this._formBuilder.group({name:["",[Y.required,Y.maxLength(150)]]}),this.batchFormValid=k(!1),this.selectedFile=k(null),this.isDragging=k(!1),this.parseError=k(null),this.parsedRows=k([]),this.previewColumns=k([]),this.requiredFields=E(()=>{let e=this.configuration();if(!e?.steps)return[];let t=new Map;return e.steps.sort((n,s)=>n.sequence-s.sequence).forEach(n=>{let s=n.appFeature;(s?.dependencies||[]).forEach(u=>{(!t.has(u.field)||u.required)&&t.set(u.field,{field:u.field,required:u.required||!1,stepName:s?.name||"Unknown Step",stepSequence:n.sequence,enumValues:u.enum||void 0,type:u.type||"string",description:u.description||void 0})})}),Array.from(t.values()).sort((n,s)=>n.required!==s.required?s.required?1:-1:n.field.localeCompare(s.field))}),this.templateFields=E(()=>this.requiredFields().filter(e=>e.required)),this.allFields=E(()=>this.requiredFields()),this.validationResult=k(null),this.cellErrors=E(()=>{let e=this.validationResult();if(!e)return new Map;let t=new Map;return e.errors.forEach(n=>{let s=`${n.rowIndex}-${n.column}`;t.set(s,n)}),t}),this.errorSummary=E(()=>{let e=this.validationResult();if(!e||e.isValid)return null;let t=e.errors.filter(m=>m.type==="missing").length,n=e.errors.filter(m=>m.type==="invalid_enum").length,s=new Set(e.errors.map(m=>m.rowIndex)).size;return{totalErrors:e.errors.length,missingCount:t,invalidEnumCount:n,rowsWithErrors:s}}),this.hasValidData=E(()=>{this.batchFormValid();let e=this.validationResult();return this.batchForm.valid&&this.parsedRows().length>0&&(!e||e.isValid)}),this.createBatchDisabledReason=E(()=>{if(this.batchFormValid(),this.isSubmitting())return"Creating batch...";if(this.parseError())return this.parseError();if(this.parsedRows().length===0)return"Upload a file with data to continue";if(!this.batchForm.get("name")?.value?.trim())return"Enter a batch name to continue";let e=this.validationResult();return e&&!e.isValid?"Fix the errors in your data to continue":null}),this.estimatedCost=E(()=>{let e=this.configuration();return e?.steps?e.steps.reduce((n,s)=>{let m=s.appFeature;return n+(m?.price||m?.smartCheckPrice||0)},0)*this.parsedRows().length:0}),this.acceptedFormats=E(()=>{let e=this.configuration();if(!e)return".csv,.xlsx,.jsonl";switch(e.inputFormat){case"csv":return".csv";case"xlsx":return".xlsx";case"jsonl":return".jsonl";default:return".csv,.xlsx,.jsonl"}})}ngOnInit(){this.batchFormValid.set(this.batchForm.valid),this.batchForm.statusChanges.subscribe(()=>{this.batchFormValid.set(this.batchForm.valid)});let e=this._route.snapshot.paramMap.get("configId");e?(this.configId.set(e),this.loadConfiguration(e)):this._router.navigate(["/smart-batch"]),this.checkAndShowTutorial()}checkAndShowTutorial(){localStorage.getItem(this.TUTORIAL_STORAGE_KEY)||setTimeout(()=>{this.openTutorial(),localStorage.setItem(this.TUTORIAL_STORAGE_KEY,"true")},500)}openTutorial(){this._dialog.open(we,{panelClass:"tutorial-dialog",maxWidth:"500px",width:"95vw",disableClose:!1,autoFocus:!1})}loadConfiguration(e){this.isLoading.set(!0),this._smartBatchService.getConfiguration(e).subscribe({next:t=>{this.configuration.set(t.data),this.isLoading.set(!1)},error:()=>{this._router.navigate(["/smart-batch"])}})}downloadTemplate(){let e=this.configuration();if(!e)return;let t=this.requiredFields().map(x=>x.field);t.length===0&&t.push("id");let n=[t.join(","),t.map(()=>"").join(",")].join(`
`),s=new Blob([n],{type:"text/csv;charset=utf-8;"}),m=document.createElement("a"),u=URL.createObjectURL(s),_=`${e.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_template.csv`;m.setAttribute("href",u),m.setAttribute("download",_),m.style.visibility="hidden",document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(u)}toggleRequiredFieldsPanel(){this.showRequiredFieldsPanel.update(e=>!e)}onDragOver(e){e.preventDefault(),e.stopPropagation(),this.isDragging.set(!0)}onDragLeave(e){e.preventDefault(),e.stopPropagation(),this.isDragging.set(!1)}onDrop(e){e.preventDefault(),e.stopPropagation(),this.isDragging.set(!1);let t=e.dataTransfer?.files;t&&t.length>0&&this.handleFile(t[0])}onFileSelected(e){let t=e.target;t.files&&t.files.length>0&&this.handleFile(t.files[0])}handleFile(e){this.selectedFile.set(e),this.parseError.set(null),this.parsedRows.set([]),this.previewColumns.set([]);let t=e.name.split(".").pop()?.toLowerCase();t==="csv"?this.parseCSV(e):t==="jsonl"?this.parseJSONL(e):t==="xlsx"?this.parseError.set("XLSX parsing requires a library. Please use CSV or JSONL for now."):this.parseError.set(`Unsupported file format: .${t}`)}parseCSV(e){let t=new FileReader;t.onload=n=>{try{let m=(n.target?.result).split(`
`).filter(x=>x.trim());if(m.length<2){this.parseError.set("CSV must have a header row and at least one data row.");return}let u=this.parseCSVLine(m[0]);this.previewColumns.set(u);let _=[];for(let x=1;x<m.length;x++){let I=this.parseCSVLine(m[x]);if(I.length===u.length){let g={};u.forEach((S,v)=>{g[S]=I[v]}),_.push(g)}}this.parsedRows.set(_),this.validateAllData(u,_)}catch{this.parseError.set("Failed to parse CSV file.")}},t.readAsText(e)}parseCSVLine(e){let t=[],n="",s=!1;for(let m=0;m<e.length;m++){let u=e[m];u==='"'?s=!s:u===","&&!s?(t.push(n.trim()),n=""):n+=u}return t.push(n.trim()),t}parseJSONL(e){let t=new FileReader;t.onload=n=>{try{let m=(n.target?.result).split(`
`).filter(x=>x.trim());if(m.length===0){this.parseError.set("JSONL file is empty.");return}let u=[],_=new Set;for(let x of m){let I=JSON.parse(x);u.push(I),Object.keys(I).forEach(g=>_.add(g))}this.previewColumns.set(Array.from(_)),this.parsedRows.set(u),this.validateAllData(Array.from(_),u)}catch{this.parseError.set("Failed to parse JSONL file. Ensure each line is valid JSON.")}},t.readAsText(e)}validateAllData(e,t){let n=this.requiredFields(),s=[],m=n.filter(g=>g.required).filter(g=>!e.some(S=>S.toLowerCase()===g.field.toLowerCase()));if(m.length>0){let g=m.map(S=>S.field).join(", ");this.parseError.set(`Missing required columns: ${g}. Please download the template for the correct format.`),this.validationResult.set({isValid:!1,errors:[],errorsByRow:new Map,errorsByColumn:new Map});return}let u=new Map;n.forEach(g=>{u.set(g.field.toLowerCase(),g)}),t.forEach((g,S)=>{n.forEach(v=>{let q=this.findColumnKey(g,v.field),F=q?g[q]:void 0;if(v.required&&this.isEmptyValue(F)&&s.push({rowIndex:S,column:v.field,type:"missing",message:`"${v.field}" is required but empty`}),v.enumValues&&v.enumValues.length>0&&!this.isEmptyValue(F)){let M=String(F).trim().toLowerCase();v.enumValues.map(ke=>ke.toLowerCase()).includes(M)||s.push({rowIndex:S,column:v.field,type:"invalid_enum",message:`"${F}" is not a valid value. Expected: ${v.enumValues.join(", ")}`,expectedValues:v.enumValues})}})});let _=new Map,x=new Map;s.forEach(g=>{_.has(g.rowIndex)||_.set(g.rowIndex,[]),_.get(g.rowIndex).push(g),x.has(g.column)||x.set(g.column,[]),x.get(g.column).push(g)});let I={isValid:s.length===0,errors:s,errorsByRow:_,errorsByColumn:x};if(this.validationResult.set(I),s.length>0){let g=s.filter(M=>M.type==="missing").length,S=s.filter(M=>M.type==="invalid_enum").length,v=new Set(s.map(M=>M.rowIndex)).size,q=`Found ${s.length} issue${s.length>1?"s":""} in ${v} row${v>1?"s":""}: `,F=[];g>0&&F.push(`${g} missing value${g>1?"s":""}`),S>0&&F.push(`${S} invalid value${S>1?"s":""}`),q+=F.join(", ")+". Check the highlighted cells below.",this.parseError.set(q)}else this.parseError.set(null)}findColumnKey(e,t){let n=t.toLowerCase();return Object.keys(e).find(u=>u.toLowerCase()===n)||null}isEmptyValue(e){return e==null||typeof e=="string"&&e.trim()===""}getCellError(e,t){let n=`${e}-${t.toLowerCase()}`,s=this.cellErrors().get(n);if(s)return s;let m=this.cellErrors();for(let[u,_]of m){let[x,I]=u.split("-");if(parseInt(x)===e&&I.toLowerCase()===t.toLowerCase())return _}return null}rowHasErrors(e){let t=this.validationResult();return t?t.errorsByRow.has(e):!1}getRowErrors(e){let t=this.validationResult();return t?t.errorsByRow.get(e)||[]:[]}removeFile(){this.selectedFile.set(null),this.parsedRows.set([]),this.previewColumns.set([]),this.parseError.set(null),this.validationResult.set(null)}submit(){if(!this.hasValidData()||!this.configId())return;this.isSubmitting.set(!0);let e={batchConfiguration:this.configId(),name:this.batchForm.value.name,rows:this.parsedRows()};this._smartBatchService.createSmartBatch(e).subscribe({next:()=>{this._router.navigate(["/smart-batch",this.configId()])},error:t=>{console.error("Failed to create batch:",t),this.isSubmitting.set(!1)}})}goBack(){this._router.navigate(["/smart-batch",this.configId()])}formatFileSize(e){if(e===0)return"0 Bytes";let t=1024,n=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,s)).toFixed(2))+" "+n[s]}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=D({type:i,selectors:[["create-batch"]],decls:16,vars:3,consts:[[1,"flex","flex-col","w-full","h-full","bg-[#f8fafc]","dark:bg-[#0f172a]","p-6","gap-6"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],["mat-icon-button","",1,"!bg-white","dark:!bg-slate-800","!shadow-sm",3,"click"],[1,"text-2xl","font-bold","tracking-tight","text-slate-900","dark:text-white"],[1,"text-slate-500","dark:text-slate-400"],["mat-icon-button","","matTooltip","Show Tutorial",1,"!bg-white","dark:!bg-slate-800","!shadow-sm","hover:!bg-indigo-50","dark:hover:!bg-indigo-900/30",3,"click"],[1,"text-indigo-600","dark:text-indigo-400"],["class","flex flex-col items-center justify-center flex-1",4,"ngIf"],["class","flex flex-col gap-6 max-w-4xl",4,"ngIf"],[1,"flex","flex-col","items-center","justify-center","flex-1"],["diameter","48"],[1,"mt-4","text-slate-500"],[1,"flex","flex-col","gap-6","max-w-4xl"],[1,"bg-gradient-to-br","from-indigo-50","to-purple-50","dark:from-indigo-900/20","dark:to-purple-900/20","rounded-xl","border","border-indigo-200","dark:border-indigo-800/50","overflow-hidden"],[1,"flex","items-center","justify-between","px-6","py-4","bg-white/50","dark:bg-slate-900/50","border-b","border-indigo-100","dark:border-indigo-800/30","cursor-pointer",3,"click"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","rounded-lg","bg-gradient-to-br","from-indigo-500","to-purple-600","flex","items-center","justify-center","shadow-lg","shadow-indigo-500/25"],[1,"text-white"],[1,"text-lg","font-semibold","text-slate-900","dark:text-white"],[1,"text-sm","text-slate-500","dark:text-slate-400"],[1,"text-slate-400","transition-transform"],["class","p-6 space-y-6",4,"ngIf"],[1,"bg-white","dark:bg-slate-900","rounded-xl","border","border-slate-200","dark:border-slate-800","p-6"],[1,"text-lg","font-semibold","text-slate-900","dark:text-white","mb-4"],["appearance","outline",1,"w-full"],["matInput","","placeholder","e.g., January 2026 Background Checks",3,"formControl"],[1,"flex","items-center","justify-between","mb-4"],["mat-stroked-button","","color","primary","class","!text-sm",3,"click",4,"ngIf"],["class","border-2 border-dashed border-slate-300 dark:border-slate-700 rounded-xl p-12 text-center transition-all cursor-pointer hover:border-indigo-400 hover:bg-slate-50 dark:hover:bg-slate-800/50",3,"ngClass","dragover","dragleave","drop",4,"ngIf"],["class","space-y-4",4,"ngIf"],["class","bg-white dark:bg-slate-900 rounded-xl border p-6",3,"ngClass",4,"ngIf"],["class","bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl p-6 text-white",4,"ngIf"],[1,"flex","items-center","justify-between","pt-4"],["mat-button","",3,"click"],[3,"matTooltip"],["mat-flat-button","","color","primary",1,"!px-8",3,"click","disabled"],["diameter","20","class","mr-2",4,"ngIf"],["class","mr-2",4,"ngIf"],[1,"p-6","space-y-6"],[1,"flex","items-start","gap-4","p-4","bg-white/60","dark:bg-slate-800/40","rounded-lg","border","border-white","dark:border-slate-700"],[1,"shrink-0","w-8","h-8","rounded-full","bg-green-100","dark:bg-green-900/30","flex","items-center","justify-center"],[1,"text-green-600","dark:text-green-400","icon-size-5"],[1,"flex-1"],[1,"font-medium","text-slate-900","dark:text-white","mb-1"],[1,"text-sm","text-slate-600","dark:text-slate-400","mb-3"],["mat-flat-button","","color","primary",1,"!shadow-lg","!shadow-indigo-500/25",3,"click"],[1,"mr-2"],[4,"ngIf"],["class","text-center py-8 text-slate-500 dark:text-slate-400",4,"ngIf"],[1,"flex","items-start","gap-3","p-4","bg-amber-50","dark:bg-amber-900/20","rounded-lg","border","border-amber-200","dark:border-amber-800/50"],[1,"text-amber-500","shrink-0"],[1,"text-sm","text-amber-700","dark:text-amber-300"],[1,"text-sm","font-semibold","text-slate-700","dark:text-slate-300","uppercase","tracking-wider","mb-3"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-3"],["class","flex items-start gap-3 p-3 bg-white/80 dark:bg-slate-800/60 rounded-lg border",3,"ngClass",4,"ngFor","ngForOf"],[1,"flex","items-start","gap-3","p-3","bg-white/80","dark:bg-slate-800/60","rounded-lg","border",3,"ngClass"],[1,"shrink-0","w-6","h-6","rounded-full","flex","items-center","justify-center","text-xs","font-bold",3,"ngClass"],["class","icon-size-4",4,"ngIf"],[1,"flex-1","min-w-0"],[1,"flex","items-center","gap-2","flex-wrap"],[1,"text-sm","font-medium","text-slate-900","dark:text-white","bg-slate-100","dark:bg-slate-700","px-1.5","py-0.5","rounded"],["class","text-[10px] font-bold uppercase text-orange-600 dark:text-orange-400",4,"ngIf"],["class","text-[10px] font-medium uppercase text-slate-400",4,"ngIf"],["class","text-[10px] font-medium uppercase text-purple-600 dark:text-purple-400",4,"ngIf"],[1,"text-xs","text-slate-500","dark:text-slate-400","mt-1"],["class","mt-2 flex flex-wrap gap-1",4,"ngIf"],[1,"icon-size-4"],[1,"text-[10px]","font-bold","uppercase","text-orange-600","dark:text-orange-400"],[1,"text-[10px]","font-medium","uppercase","text-slate-400"],[1,"text-[10px]","font-medium","uppercase","text-purple-600","dark:text-purple-400"],[1,"mt-2","flex","flex-wrap","gap-1"],["class","text-[10px] px-1.5 py-0.5 rounded bg-purple-50 dark:bg-purple-900/20 text-purple-700 dark:text-purple-300 border border-purple-200 dark:border-purple-800/50",4,"ngFor","ngForOf"],[1,"text-[10px]","px-1.5","py-0.5","rounded","bg-purple-50","dark:bg-purple-900/20","text-purple-700","dark:text-purple-300","border","border-purple-200","dark:border-purple-800/50"],[1,"text-center","py-8","text-slate-500","dark:text-slate-400"],[1,"icon-size-12","mb-2","opacity-50"],["mat-stroked-button","","color","primary",1,"!text-sm",3,"click"],[1,"mr-1","icon-size-5"],[1,"border-2","border-dashed","border-slate-300","dark:border-slate-700","rounded-xl","p-12","text-center","transition-all","cursor-pointer","hover:border-indigo-400","hover:bg-slate-50","dark:hover:bg-slate-800/50",3,"dragover","dragleave","drop","ngClass"],["type","file","id","fileInput",1,"hidden",3,"change","accept"],["for","fileInput",1,"cursor-pointer"],[1,"w-16","h-16","mx-auto","mb-4","rounded-full","bg-slate-100","dark:bg-slate-800","flex","items-center","justify-center"],[1,"text-slate-400","icon-size-8"],[1,"text-lg","font-medium","text-slate-900","dark:text-white","mb-1"],[1,"text-sm","text-slate-500"],[1,"space-y-4"],[1,"flex","items-center","gap-4","p-4","bg-slate-50","dark:bg-slate-800/50","rounded-lg"],[1,"w-12","h-12","rounded-lg","bg-indigo-100","dark:bg-indigo-900/30","flex","items-center","justify-center"],[1,"font-medium","text-slate-900","dark:text-white"],["mat-icon-button","","matTooltip","Remove file",3,"click"],["class","flex items-start gap-3 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",4,"ngIf"],["class","flex items-center gap-3 p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",4,"ngIf"],[1,"flex","items-start","gap-3","p-4","bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-800","rounded-lg"],[1,"text-red-600","dark:text-red-400","shrink-0"],[1,"text-red-700","dark:text-red-300","font-medium"],["mat-button","","color","primary",1,"!mt-2","!-ml-4",3,"click"],[1,"mr-1"],[1,"flex","items-center","gap-3","p-4","bg-green-50","dark:bg-green-900/20","border","border-green-200","dark:border-green-800","rounded-lg"],[1,"text-green-600","dark:text-green-400"],[1,"font-medium","text-green-700","dark:text-green-300"],[1,"text-sm","text-green-600","dark:text-green-400"],[1,"bg-white","dark:bg-slate-900","rounded-xl","border","p-6",3,"ngClass"],["class","inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",4,"ngIf"],["class","flex flex-wrap items-center gap-4 mb-4 p-3 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-200 dark:border-red-800/50",4,"ngIf"],[1,"overflow-x-auto"],[1,"w-full","text-sm"],[1,"bg-slate-50","dark:bg-slate-800/50"],[1,"text-left","px-2","py-2","font-medium","text-slate-500","dark:text-slate-500","w-10"],["class","text-left px-4 py-2 font-medium text-slate-600 dark:text-slate-400 whitespace-nowrap",4,"ngFor","ngForOf"],["class","border-t",3,"ngClass",4,"ngFor","ngForOf"],["class","mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800/50 text-sm text-amber-700 dark:text-amber-300",4,"ngIf"],[1,"inline-flex","items-center","gap-1","px-2","py-0.5","rounded-full","text-xs","font-medium","bg-red-100","text-red-700","dark:bg-red-900/30","dark:text-red-400"],[1,"icon-size-3"],[1,"flex","flex-wrap","items-center","gap-4","mb-4","p-3","bg-red-50","dark:bg-red-900/10","rounded-lg","border","border-red-200","dark:border-red-800/50"],[1,"text-sm","text-red-700","dark:text-red-300","font-medium"],[1,"icon-size-4","align-middle","mr-1"],[1,"flex","items-center","gap-4","text-xs"],["class","flex items-center gap-1.5",4,"ngIf"],[1,"flex","items-center","gap-1.5"],[1,"w-3","h-3","rounded-sm","bg-orange-400"],[1,"w-3","h-3","rounded-sm","bg-red-500"],[1,"text-left","px-4","py-2","font-medium","text-slate-600","dark:text-slate-400","whitespace-nowrap"],[1,"border-t",3,"ngClass"],[1,"px-2","py-2","text-slate-400","text-xs","font-mono"],[1,"flex","items-center","gap-1"],["class","text-red-500 icon-size-4",3,"matTooltip",4,"ngIf"],["class","px-4 py-2 whitespace-nowrap max-w-xs truncate relative",3,"ngClass","matTooltip","matTooltipDisabled",4,"ngFor","ngForOf"],[1,"text-red-500","icon-size-4",3,"matTooltip"],[1,"px-4","py-2","whitespace-nowrap","max-w-xs","truncate","relative",3,"ngClass","matTooltip","matTooltipDisabled"],["class","icon-size-4 shrink-0",3,"ngClass",4,"ngIf"],[1,"icon-size-4","shrink-0",3,"ngClass"],[1,"mt-4","p-3","bg-amber-50","dark:bg-amber-900/20","rounded-lg","border","border-amber-200","dark:border-amber-800/50","text-sm","text-amber-700","dark:text-amber-300"],[1,"bg-gradient-to-r","from-indigo-500","to-purple-600","rounded-xl","p-6","text-white"],[1,"text-indigo-100","text-sm"],[1,"text-3xl","font-bold"],[1,"text-right"],[1,"text-lg"],["diameter","20",1,"mr-2"]],template:function(t,n){if(t&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),b("click",function(){return n.goBack()}),a(4,"mat-icon"),o(5,"arrow_back"),r()(),a(6,"div")(7,"h1",4),o(8," Create New Batch "),r(),a(9,"p",5),o(10),r()()(),a(11,"button",6),b("click",function(){return n.openTutorial()}),a(12,"mat-icon",7),o(13,"help_outline"),r()()(),f(14,qe,4,0,"div",8)(15,mt,41,16,"div",9),r()),t&2){let s;l(10),h(' Upload data to process with "',(s=n.configuration())==null?null:s.name,'" '),l(4),d("ngIf",n.isLoading()),l(),d("ngIf",!n.isLoading())}},dependencies:[P,H,O,j,ge,ce,me,xe,pe,Z,A,N,z,$,J,U,_e,fe,ne,ie,re,ae,le,be,he,ve,de,se,oe],encapsulation:2})}}return i})();export{At as CreateBatchComponent};
