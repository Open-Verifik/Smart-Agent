import{a as P}from"./chunk-SAQWL5AZ.js";import{b as _}from"./chunk-LSIKLBMU.js";import"./chunk-UZOJVLL6.js";import{a as $,b as z}from"./chunk-TRCJCSTR.js";import{b as V}from"./chunk-3AXJ3YCT.js";import{d as N}from"./chunk-Y2ZKGQKJ.js";import{d as T}from"./chunk-H5UQ2FZ7.js";import"./chunk-EJ24FNNM.js";import{V as F,X as j,Z as A,_ as O}from"./chunk-RN2OM5JC.js";import{Eb as i,Fb as t,Gb as b,Kb as h,Mb as v,Nb as d,Oc as I,Pc as E,Qc as M,Wa as o,X as x,Xb as n,Yb as C,Zb as m,_b as w,cd as D,f as y,fb as k,ga as g,lb as p,qa as f,ra as u,sb as l,yc as S}from"./chunk-M2SB6WSN.js";import"./chunk-66YHNWRR.js";function B(s,c){s&1&&(i(0,"div",11),b(1,"mat-spinner",12),t())}function U(s,c){s&1&&(i(0,"div",13)(1,"div",14)(2,"mat-icon",15),n(3,"check_circle"),t()(),i(4,"h3",16),n(5," All systems operational "),t(),i(6,"p",17),n(7," No active incidents detected for your subscribed services. Everything is running smoothly. "),t()())}function L(s,c){if(s&1){let e=h();i(0,"div",13)(1,"div",18)(2,"mat-icon",19),n(3,"notifications_off"),t()(),i(4,"h3",16),n(5," No subscriptions yet "),t(),i(6,"p",17),n(7," Subscribe to services in Status Check to receive incident alerts and see them here. "),t(),i(8,"button",20),v("click",function(){f(e);let a=d();return u(a.openDetail({_id:null}))}),n(9," Go to Status Check "),t()()}}function G(s,c){if(s&1&&(i(0,"div",37)(1,"mat-icon",38),n(2,"timelapse"),t(),i(3,"span"),n(4),t()()),s&2){let e=d().$implicit,r=d(2);o(4),C(r.formatDuration(e.duration))}}function Y(s,c){if(s&1){let e=h();i(0,"div",26),v("click",function(){let a=f(e).$implicit,R=d(2);return u(R.openDetail(a))}),i(1,"div",27)(2,"div",28)(3,"div",29),b(4,"span",30),t(),i(5,"div",31)(6,"h3",32),n(7),t(),i(8,"p",33),n(9),t()()(),i(10,"span",34),n(11),t()(),i(12,"div",35)(13,"div",36)(14,"div",37)(15,"mat-icon",38),n(16,"schedule"),t(),i(17,"span"),n(18),t()(),p(19,G,5,1,"div",39),t(),i(20,"div",40),n(21," View logs "),i(22,"mat-icon",38),n(23,"arrow_forward"),t()()()()}if(s&2){let e=c.$implicit,r=d(2);o(4),l("ngClass",r.getStatusCfg(e.status).dotClass),o(3),m(" ",r.getServiceName(e)," "),o(2),m(" ",e.code," "),o(),l("ngClass",r.getStatusCfg(e.status).classes),o(),m(" ",r.getStatusCfg(e.status).label," "),o(7),m("Started ",r.formatDate(e.startDate),""),o(),l("ngIf",e.duration)}}function q(s,c){if(s&1&&(i(0,"div",21)(1,"div",22)(2,"mat-icon",23),n(3,"error_outline"),t(),i(4,"span",24),n(5),t()(),p(6,Y,24,7,"div",25),t()),s&2){let e=d();o(5),w(" ",e.incidents.length," active incident",e.incidents.length>1?"s":""," affecting your subscribed services "),o(),l("ngForOf",e.incidents)}}var me=(()=>{class s{constructor(){this._service=g(P),this._cdr=g(S),this._router=g(T),this._unsubscribeAll=new y,this.loading=!0,this.incidents=[],this.subscriptions=[],this.statusConfig={down:{label:"Down",classes:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",dotClass:"bg-red-500 animate-pulse"},review:{label:"Under Review",classes:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",dotClass:"bg-yellow-500 animate-pulse"},up:{label:"Resolved",classes:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",dotClass:"bg-green-500"},closed:{label:"Closed",classes:"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400",dotClass:"bg-gray-400"}}}ngOnInit(){this._loadSubscriptionsThenIncidents()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}_loadSubscriptionsThenIncidents(){this.loading=!0,this._service.getIncidentsSubscriptions({populates:["appFeature"]}).pipe(x(this._unsubscribeAll)).subscribe({next:e=>{this.subscriptions=e.data||e||[],this._loadIncidents()},error:()=>{this.loading=!1,this._cdr.markForCheck()}})}_loadIncidents(){if(!this.subscriptions.length){this.loading=!1,this._cdr.markForCheck();return}let e=[...new Set(this.subscriptions.map(a=>a.alias).filter(Boolean))],r={in_status:["down","review"],populates:["appFeature"],sort:"-createdAt"};e.length&&(r.in_alias=e),this._service.getIncidents(r).pipe(x(this._unsubscribeAll)).subscribe({next:a=>{this.incidents=a.data||a||[],this.loading=!1,this._cdr.markForCheck()},error:()=>{this.loading=!1,this._cdr.markForCheck()}})}getStatusCfg(e){return this.statusConfig[e]??this.statusConfig.closed}formatDate(e){return e?_.fromISO(e).toLocaleString(_.DATETIME_MED):"N/A"}formatDuration(e){if(!e)return"\u2014";if(e<60)return`${e}m`;let r=Math.floor(e/60),a=e%60;return a?`${r}h ${a}m`:`${r}h`}getServiceName(e){return e.appFeature?.name||e.code||"Unknown Service"}openDetail(e){this._router.navigate(["/smart-monitor/incidents",e._id])}static{this.\u0275fac=function(r){return new(r||s)}}static{this.\u0275cmp=k({type:s,selectors:[["incidents"]],decls:16,vars:4,consts:[[1,"flex","flex-col","flex-auto","min-w-0","bg-gray-50","dark:bg-gray-900","min-h-screen"],[1,"flex","flex-col","w-full","max-w-5xl","mx-auto","p-6","md:p-8"],[1,"flex","flex-col","py-6","mb-8","border-b","border-gray-200","dark:border-gray-800"],[1,"flex","items-center","gap-3","mb-1"],[1,"flex","items-center","justify-center","w-10","h-10","rounded-xl","bg-red-100","dark:bg-red-900/30"],[1,"text-red-600","dark:text-red-400","icon-size-5"],[1,"text-2xl","font-bold","tracking-tight","text-gray-900","dark:text-white"],[1,"text-sm","text-gray-500","dark:text-gray-400"],["class","flex flex-auto justify-center items-center py-24",4,"ngIf"],["class","flex flex-col items-center justify-center py-24 text-center",4,"ngIf"],["class","flex flex-col gap-4",4,"ngIf"],[1,"flex","flex-auto","justify-center","items-center","py-24"],["diameter","56"],[1,"flex","flex-col","items-center","justify-center","py-24","text-center"],[1,"flex","items-center","justify-center","w-20","h-20","rounded-full","bg-green-100","dark:bg-green-900/30","mb-5"],[1,"icon-size-10","text-green-500"],[1,"text-xl","font-semibold","text-gray-800","dark:text-white","mb-1"],[1,"text-gray-500","dark:text-gray-400","max-w-sm"],[1,"flex","items-center","justify-center","w-20","h-20","rounded-full","bg-gray-100","dark:bg-gray-800","mb-5"],[1,"icon-size-10","text-gray-400"],["mat-stroked-button","","routerLink","/smart-monitor/status-check",1,"mt-6",3,"click"],[1,"flex","flex-col","gap-4"],[1,"flex","items-center","gap-2","px-4","py-3","rounded-xl","bg-red-50","dark:bg-red-900/20","border","border-red-200","dark:border-red-800","text-red-700","dark:text-red-400"],[1,"icon-size-4","flex-shrink-0"],[1,"text-sm","font-medium"],["class","incident-card flex flex-col bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"incident-card","flex","flex-col","bg-white","dark:bg-gray-800","rounded-2xl","shadow-sm","border","border-gray-200","dark:border-gray-700","overflow-hidden","cursor-pointer",3,"click"],[1,"flex","items-start","justify-between","p-5","border-b","border-gray-100","dark:border-gray-700/50"],[1,"flex","items-start","gap-4","min-w-0"],[1,"flex-shrink-0","pt-1"],[1,"inline-block","w-3","h-3","rounded-full",3,"ngClass"],[1,"min-w-0"],[1,"text-base","font-semibold","text-gray-900","dark:text-white","leading-tight"],[1,"text-xs","text-gray-400","dark:text-gray-500","mt-0.5","font-mono"],[1,"ml-4","flex-shrink-0","inline-flex","items-center","gap-1.5","px-3","py-1","rounded-full","text-xs","font-semibold",3,"ngClass"],[1,"flex","items-center","justify-between","px-5","py-3","bg-gray-50/50","dark:bg-gray-800/30"],[1,"flex","items-center","gap-6","text-xs","text-gray-500","dark:text-gray-400"],[1,"flex","items-center","gap-1.5"],[1,"icon-size-3.5"],["class","flex items-center gap-1.5",4,"ngIf"],[1,"flex","items-center","gap-1","text-xs","font-medium","text-primary-600","dark:text-primary-400"]],template:function(r,a){r&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"mat-icon",5),n(6,"warning_amber"),t()(),i(7,"div")(8,"h2",6),n(9," Active Incidents "),t(),i(10,"p",7),n(11," Services you're subscribed to that are currently experiencing issues "),t()()()(),p(12,B,2,0,"div",8)(13,U,8,0,"div",9)(14,L,10,0,"div",9)(15,q,7,3,"div",10),t()()),r&2&&(o(12),l("ngIf",a.loading),o(),l("ngIf",!a.loading&&a.subscriptions.length>0&&a.incidents.length===0),o(),l("ngIf",!a.loading&&a.subscriptions.length===0),o(),l("ngIf",!a.loading&&a.incidents.length>0))},dependencies:[D,I,E,M,N,z,$,j,F,O,A,V],styles:["incidents[_ngcontent-%COMP%]{display:block}.incident-card[_ngcontent-%COMP%]{transition:box-shadow .2s ease,transform .15s ease}.incident-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px)}"],changeDetection:0})}}return s})();export{me as IncidentsComponent};
