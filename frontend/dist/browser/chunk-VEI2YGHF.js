import{a as xt,b as gt,c as ft}from"./chunk-TCY2PRID.js";import{a as ht}from"./chunk-PRJZIQSV.js";import{a as lt,b as ct}from"./chunk-ATP672IP.js";import{j as mt}from"./chunk-2MPPT2HE.js";import"./chunk-5RVJJ5EH.js";import{a as _t,b as ut}from"./chunk-TCINIKAO.js";import{a as dt,b as pt}from"./chunk-KFOBTILV.js";import{c as at,d as st}from"./chunk-R2OL6BAE.js";import{b as Q,d as X,i as tt}from"./chunk-C4ZGSISC.js";import"./chunk-K3WTVTCM.js";import"./chunk-UUWZXEWR.js";import"./chunk-I6HAT3VE.js";import{U as et,V as it,X as nt,Z as ot,_ as rt}from"./chunk-IJNYHMLE.js";import{$b as Y,Bc as k,Cb as P,Db as y,Eb as o,Fb as r,Ga as S,Gb as U,Kb as T,Mb as I,Nb as c,Wa as a,Xb as s,Yb as f,Zb as u,Zc as H,_b as W,ad as K,f as z,fb as G,ga as q,gc as w,hc as Z,lb as g,mc as d,nc as _,oc as C,p as D,qa as E,ra as R,sb as v,ub as N,wb as A,zb as x}from"./chunk-IQHBJK6X.js";import{a as J,i as j}from"./chunk-66YHNWRR.js";var bt=e=>({count:e}),O=e=>({index:e}),$=e=>({step:e}),St=(e,l)=>({step:e,code:l}),V=(e,l)=>l.sequence,L=(e,l)=>l.rowIndex,Ct=(e,l)=>l.label,Pt=(e,l)=>l.step;function yt(e,l){e&1&&(o(0,"mat-icon",17),s(1,"refresh"),r(),s(2),d(3,"transloco")),e&2&&(a(2),u(" ",_(3,1,"batchProcessing.starting")," "))}function Bt(e,l){e&1&&(o(0,"mat-icon"),s(1,"play_arrow"),r(),s(2),d(3,"transloco")),e&2&&(a(2),u(" ",_(3,1,"batchProcessing.startProcessing")," "))}function It(e,l){if(e&1){let t=T();o(0,"button",15),I("click",function(){E(t);let n=c();return R(n.startProcessing())}),o(1,"span",16),g(2,yt,4,3)(3,Bt,4,3),r()()}if(e&2){let t=c();v("disabled",t.isStarting()),a(2),x(t.isStarting()?2:3)}}function Et(e,l){if(e&1){let t=T();o(0,"button",18),I("click",function(){E(t);let n=c();return R(n.pauseProcessing())}),o(1,"span",16)(2,"mat-icon"),s(3,"pause"),r(),s(4),d(5,"transloco"),r()()}e&2&&(a(4),u(" ",_(5,1,"batchProcessing.pause")," "))}function Rt(e,l){if(e&1){let t=T();o(0,"button",19),I("click",function(){E(t);let n=c();return R(n.generateReport())}),o(1,"span",16)(2,"mat-icon"),s(3,"description"),r(),s(4),d(5,"transloco"),r()()}e&2&&(a(4),u(" ",_(5,1,"batchProcessing.generateReport")," "))}function Tt(e,l){if(e&1&&(o(0,"div",12)(1,"div",20)(2,"span"),s(3),d(4,"transloco"),r(),o(5,"span"),s(6),r()(),U(7,"mat-progress-bar",21),r()),e&2){let t=c();a(3),f(_(4,3,"batchProcessing.processing")),a(3),u("",t.progress(),"%"),a(),v("value",t.progress())}}function Ft(e,l){if(e&1&&(o(0,"span",29),s(1),r()),e&2){let t=c().$implicit,i=c(2);v("matTooltip",i.getStepUrl(t)),a(),u(" ",i.getStepUrl(t)," ")}}function kt(e,l){if(e&1&&(o(0,"span",30),s(1),d(2,"number"),d(3,"transloco"),r()),e&2){let t=c().$implicit,i=c(2);a(),W(" ",C(2,2,i.getStepPrice(t),"1.2-2")," ",_(3,5,"batchProcessing.credits")," ")}}function $t(e,l){e&1&&(o(0,"mat-icon",31),s(1,"arrow_forward"),r())}function Mt(e,l){if(e&1&&(o(0,"div",25)(1,"div",26),s(2),r(),o(3,"div",27)(4,"span",28),s(5),r(),g(6,Ft,2,2,"span",29)(7,kt,4,7,"span",30),r()(),g(8,$t,2,0,"mat-icon",31)),e&2){let t=l.$implicit,i=l.$index,n=c(2);a(2),u(" ",t.sequence," "),a(2),v("matTooltip",n.getStepName(t)),a(),u(" ",n.getStepName(t)," "),a(),x(n.getStepUrl(t)?6:-1),a(),x(n.getStepPrice(t)>0?7:-1),a(),x(i<n.configSteps().length-1?8:-1)}}function Vt(e,l){if(e&1&&(o(0,"div",2)(1,"div",22)(2,"h3",23),s(3),d(4,"transloco"),r(),o(5,"div",24),P(6,Mt,9,6,null,null,V),r()()()),e&2){let t=c();a(3),u(" ",_(4,1,"batchProcessing.processingSteps")," "),a(3),y(t.configSteps())}}function jt(e,l){e&1&&(o(0,"div",14),U(1,"mat-spinner",32),r())}function Dt(e,l){e&1&&(o(0,"div",40)(1,"mat-icon",45),s(2,"check_circle"),r(),o(3,"p"),s(4),d(5,"transloco"),r()()),e&2&&(a(4),f(_(5,1,"batchProcessing.allRecordsProcessed")))}function qt(e,l){if(e&1&&(o(0,"div",52),d(1,"transloco"),o(2,"mat-icon",55),s(3,"check"),r()()),e&2){let t=c().$implicit,i=c(4);v("matTooltip",C(1,1,"batchProcessing.stepStatusCompleted",w(4,$,i.getStepName(t))))}}function Nt(e,l){if(e&1&&(o(0,"div",53),d(1,"transloco"),o(2,"mat-icon",56),s(3,"close"),r()()),e&2){let t=c().$implicit,i=c(4);v("matTooltip",C(1,1,"batchProcessing.stepStatusFailed",w(4,$,i.getStepName(t))))}}function At(e,l){if(e&1&&(o(0,"div",54),d(1,"transloco"),o(2,"mat-icon",57),s(3,"more_horiz"),r()()),e&2){let t=c().$implicit,i=c(4);v("matTooltip",C(1,1,"batchProcessing.stepStatusPending",w(4,$,i.getStepName(t))))}}function Ot(e,l){if(e&1&&g(0,qt,4,6,"div",52)(1,Nt,4,6,"div",53)(2,At,4,6,"div",54),e&2){let t,i=l.$implicit,n=c().$implicit,m=c(3);x((t=m.getRowStepStatus(n,i.sequence))==="completed"?0:t==="failed"?1:2)}}function Ut(e,l){if(e&1){let t=T();o(0,"div",47),I("click",function(){let n=E(t).$implicit,m=c(3);return R(m.selectRow(n))}),o(1,"div",3)(2,"div",8)(3,"div",48),s(4),r(),o(5,"div")(6,"p",49),s(7),d(8,"transloco"),r(),o(9,"p",50),s(10),d(11,"transloco"),r()()(),o(12,"div",51),P(13,Ot,3,1,null,null,V),r()()()}if(e&2){let t,i=l.$implicit,n=c(3);N("bg-indigo-50",((t=n.selectedRow())==null?null:t.rowIndex)===i.rowIndex),a(4),u(" #",i.rowIndex+1," "),a(3),u(" ",(i.inputData==null?null:i.inputData.documentNumber)||(i.inputData==null?null:i.inputData.name)||C(8,5,"batchProcessing.rowNumber",w(10,O,i.rowIndex+1))," "),a(3),u(" ",_(11,8,"batchProcessing."+i.status)," "),a(3),y(n.configSteps())}}function Lt(e,l){if(e&1&&P(0,Ut,15,12,"div",46,L),e&2){let t=c(2);y(t.pendingRows())}}function Jt(e,l){e&1&&(o(0,"div",40)(1,"mat-icon",45),s(2,"hourglass_empty"),r(),o(3,"p"),s(4),d(5,"transloco"),r()()),e&2&&(a(4),f(_(5,1,"batchProcessing.noCompletedRecordsYet")))}function zt(e,l){if(e&1&&(o(0,"div",52)(1,"mat-icon",55),s(2,"check"),r()()),e&2){let t=l.$implicit,i=c(4);v("matTooltip",i.getStepName(t))}}function Gt(e,l){if(e&1){let t=T();o(0,"div",47),I("click",function(){let n=E(t).$implicit,m=c(3);return R(m.selectRow(n))}),o(1,"div",3)(2,"div",8)(3,"div",59)(4,"mat-icon",60),s(5,"check"),r()(),o(6,"div")(7,"p",49),s(8),d(9,"transloco"),r(),o(10,"p",61),s(11),d(12,"transloco"),r()()(),o(13,"div",51),P(14,zt,3,1,"div",52,V),r()()()}if(e&2){let t,i=l.$implicit,n=c(3);N("bg-indigo-50",((t=n.selectedRow())==null?null:t.rowIndex)===i.rowIndex),a(8),u(" ",(i.inputData==null?null:i.inputData.documentNumber)||(i.inputData==null?null:i.inputData.name)||C(9,4,"batchProcessing.rowNumber",w(9,O,i.rowIndex+1))," "),a(3),f(_(12,7,"batchProcessing.verified")),a(3),y(n.configSteps())}}function Wt(e,l){if(e&1&&(o(0,"div",52),d(1,"transloco"),o(2,"mat-icon",55),s(3,"check"),r()()),e&2){let t=c().$implicit,i=c(4);v("matTooltip",C(1,1,"batchProcessing.stepStatusCompleted",w(4,$,i.getStepName(t))))}}function Yt(e,l){if(e&1&&(o(0,"div",53),d(1,"transloco"),o(2,"mat-icon",56),s(3,"close"),r()()),e&2){let t=c().$implicit,i=c(4);v("matTooltip",C(1,1,"batchProcessing.stepStatusFailed",w(4,$,i.getStepName(t))))}}function Zt(e,l){if(e&1&&(o(0,"div",54),d(1,"transloco"),o(2,"mat-icon",57),s(3,"remove"),r()()),e&2){let t=c().$implicit,i=c(4);v("matTooltip",C(1,1,"batchProcessing.stepStatusSkipped",w(4,$,i.getStepName(t))))}}function Ht(e,l){if(e&1&&g(0,Wt,4,6,"div",52)(1,Yt,4,6,"div",53)(2,Zt,4,6,"div",54),e&2){let t,i=l.$implicit,n=c().$implicit,m=c(3);x((t=m.getRowStepStatus(n,i.sequence))==="completed"?0:t==="failed"?1:2)}}function Kt(e,l){if(e&1){let t=T();o(0,"div",47),I("click",function(){let n=E(t).$implicit,m=c(3);return R(m.selectRow(n))}),o(1,"div",3)(2,"div",8)(3,"div",62)(4,"mat-icon",63),s(5,"close"),r()(),o(6,"div")(7,"p",49),s(8),d(9,"transloco"),r(),o(10,"p",64),s(11),d(12,"transloco"),r()()(),o(13,"div",51),P(14,Ht,3,1,null,null,V),r()()()}if(e&2){let t,i=l.$implicit,n=c(3);N("bg-red-50",((t=n.selectedRow())==null?null:t.rowIndex)===i.rowIndex),a(8),u(" ",(i.inputData==null?null:i.inputData.documentNumber)||(i.inputData==null?null:i.inputData.name)||C(9,4,"batchProcessing.rowNumber",w(9,O,i.rowIndex+1))," "),a(3),u(" ",(i.errors==null||i.errors[0]==null?null:i.errors[0].message)||_(12,7,"batchProcessing.failed")," "),a(3),y(n.configSteps())}}function Qt(e,l){if(e&1&&(P(0,Gt,16,11,"div",46,L),P(2,Kt,16,11,"div",58,L)),e&2){let t=c(2);y(t.completedRows()),a(2),y(t.failedRows())}}function Xt(e,l){if(e&1){let t=T();o(0,"button",77),I("click",function(){E(t);let n=c(3);return R(n.generateRowReport(n.selectedRow()))}),o(1,"mat-icon",78),s(2,"picture_as_pdf"),r(),s(3),d(4,"transloco"),r()}e&2&&(a(3),u(" ",_(4,1,"batchProcessing.generatePdfReport")," "))}function te(e,l){if(e&1&&(o(0,"div",81)(1,"span",82),s(2),r(),o(3,"span",83),s(4),r()()),e&2){let t=l.$implicit;a(2),f(t.label),a(2),f(t.value)}}function ee(e,l){if(e&1&&(o(0,"div",79),P(1,te,5,2,"div",81,Ct),r()),e&2){let t=c(4);a(),y(t.getInputDataFields())}}function ie(e,l){e&1&&(o(0,"p",80),s(1,"\u2014"),r())}function ne(e,l){if(e&1&&(o(0,"div",75),g(1,ee,3,0,"div",79)(2,ie,2,0,"p",80),r()),e&2){let t=c(3);a(),x(t.getInputDataFields().length>0?1:2)}}function oe(e,l){if(e&1&&(o(0,"pre",76),s(1),r()),e&2){let t,i=c(3);a(),f(i.formatJson((t=i.selectedRow())==null?null:t.inputData))}}function re(e,l){if(e&1&&(o(0,"div",81)(1,"span",82),s(2),r(),o(3,"span",83),s(4),r()()),e&2){let t=l.$implicit;a(2),f(t.label),a(2),f(t.value)}}function ae(e,l){if(e&1&&(o(0,"div",90)(1,"div",79),P(2,re,5,2,"div",81,Ct),r()()),e&2){let t,i=c(2).$implicit,n=c(4);a(2),y(n.getStepResultFields((t=n.selectedRow())==null||t.results==null?null:t.results[i.sequence]))}}function se(e,l){if(e&1&&(o(0,"div",90)(1,"pre",91),s(2),r()()),e&2){let t,i=c(2).$implicit,n=c(4);a(2),f(n.formatJson((t=n.selectedRow())==null||t.results==null?null:t.results[i.sequence]))}}function le(e,l){if(e&1&&g(0,ae,4,0,"div",90)(1,se,3,1,"div",90),e&2){let t=c(5);x(t.detailsViewMode()==="readable"?0:1)}}function ce(e,l){if(e&1&&(o(0,"div",85)(1,"div",86)(2,"div",66)(3,"div",87),s(4),r(),o(5,"span",88),s(6),r()(),o(7,"span",89),s(8),d(9,"transloco"),r()(),g(10,le,2,1),r()),e&2){let t,i=l.$implicit,n=c(4);a(3),A(n.getRowStepStatus(n.selectedRow(),i.sequence)==="completed"?"bg-emerald-100 text-emerald-600":n.getRowStepStatus(n.selectedRow(),i.sequence)==="failed"?"bg-red-100 text-red-600":"bg-gray-100 text-gray-500"),a(),u(" ",i.sequence," "),a(2),f(n.getStepName(i)),a(),A(n.getRowStepStatus(n.selectedRow(),i.sequence)==="completed"?"bg-emerald-100 text-emerald-600":n.getRowStepStatus(n.selectedRow(),i.sequence)==="failed"?"bg-red-100 text-red-600":"bg-gray-100 text-gray-500"),a(),u(" ",_(9,8,"batchProcessing."+n.getRowStepStatus(n.selectedRow(),i.sequence))," "),a(2),x(!((t=n.selectedRow())==null||t.results==null)&&t.results[i.sequence]?10:-1)}}function de(e,l){if(e&1&&(o(0,"div",72)(1,"h4",73),s(2),d(3,"transloco"),r(),o(4,"div",84),P(5,ce,11,10,"div",85,V),r()()),e&2){let t=c(3);a(2),f(_(3,1,"batchProcessing.stepResults")),a(3),y(t.configSteps())}}function pe(e,l){if(e&1&&(o(0,"div",94)(1,"p",95),s(2),d(3,"transloco"),r(),o(4,"p",96),s(5),r()()),e&2){let t=l.$implicit;a(2),u(" ",C(3,2,"batchProcessing.stepError",Z(5,St,t.step,t.code))," "),a(3),u(" ",t.message," ")}}function me(e,l){if(e&1&&(o(0,"div")(1,"h4",92),s(2),d(3,"transloco"),r(),o(4,"div",93),P(5,pe,6,8,"div",94,Pt),r()()),e&2){let t=c(3);a(2),f(_(3,1,"batchProcessing.errors")),a(3),y(t.selectedRow().errors)}}function _e(e,l){if(e&1){let t=T();o(0,"div",44)(1,"div",65)(2,"h3",38),s(3),d(4,"transloco"),r(),o(5,"div",66)(6,"mat-button-toggle-group",67),I("change",function(n){E(t);let m=c(2);return R(m.detailsViewMode.set(n.value))}),o(7,"mat-button-toggle",68),s(8),d(9,"transloco"),r(),o(10,"mat-button-toggle",69),s(11),d(12,"transloco"),r()(),g(13,Xt,5,3,"button",70),o(14,"button",71),I("click",function(){E(t);let n=c(2);return R(n.selectedRow.set(null))}),o(15,"mat-icon"),s(16,"close"),r()()()(),o(17,"div",72)(18,"h4",73),s(19),d(20,"transloco"),r(),o(21,"div",74),g(22,ne,3,1,"div",75)(23,oe,2,1,"pre",76),r()(),g(24,de,7,3,"div",72)(25,me,7,3,"div"),r()}if(e&2){let t,i,n,m,p=c(2);a(3),u(" ",C(4,9,"batchProcessing.rowDetails",w(18,O,((t=(t=p.selectedRow())==null?null:t.rowIndex)!==null&&t!==void 0?t:0)+1))," "),a(3),v("value",p.detailsViewMode()),a(2),f(_(9,12,"batchProcessing.readable")),a(3),f(_(12,14,"batchProcessing.json")),a(2),x(((i=p.selectedRow())==null?null:i.status)==="completed"?13:-1),a(6),f(_(20,16,"batchProcessing.inputData")),a(3),x(p.detailsViewMode()==="readable"?22:23),a(2),x(p.configSteps().length>0&&((n=p.selectedRow())!=null&&n.results)?24:-1),a(),x((m=p.selectedRow())!=null&&m.errors&&p.selectedRow().errors.length>0?25:-1)}}function ue(e,l){if(e&1&&(o(0,"div",33)(1,"div",34)(2,"div",35)(3,"div",8)(4,"div",36)(5,"mat-icon",37),s(6,"pending"),r()(),o(7,"div")(8,"h2",38),s(9),d(10,"transloco"),r(),o(11,"p",7),s(12),d(13,"transloco"),r()()()(),o(14,"div",39),g(15,Dt,6,3,"div",40)(16,Lt,2,0),r()(),o(17,"div",34)(18,"div",41)(19,"div",8)(20,"div",42)(21,"mat-icon",43),s(22,"check_circle"),r()(),o(23,"div")(24,"h2",38),s(25),d(26,"transloco"),r(),o(27,"p",7),s(28),d(29,"transloco"),r()()()(),o(30,"div",39),g(31,Jt,6,3,"div",40)(32,Qt,4,0),r()()(),g(33,_e,26,20,"div",44)),e&2){let t=c();a(9),f(_(10,7,"batchProcessing.pending")),a(3),u(" ",C(13,9,"batchProcessing.recordsWaiting",w(17,bt,t.pendingRows().length))," "),a(3),x(t.pendingRows().length===0?15:16),a(10),f(_(26,12,"batchProcessing.completed")),a(3),u(" ",C(29,14,"batchProcessing.recordsVerified",w(19,bt,t.completedRows().length))," "),a(3),x(t.completedRows().length===0&&t.failedRows().length===0?31:32),a(2),x(t.selectedRow()?33:-1)}}var qe=(()=>{class e{constructor(){this._route=q(Q),this._router=q(X),this._smartBatchService=q(ht),this._destroy$=new z,this._processingAborted=!1,this.configId=S(null),this.batchId=S(null),this.batch=S(null),this.configuration=S(null),this.isLoading=S(!0),this.isProcessing=S(!1),this.isStarting=S(!1),this.currentRowIndex=S(null),this.currentStepIndex=S(null),this.configSteps=k(()=>{let t=this.configuration();return t?.steps?t.steps.filter(i=>i.enabled).sort((i,n)=>i.sequence-n.sequence):[]}),this.pendingRows=k(()=>{let t=this.batch();return t?.rows?t.rows.filter(i=>i.status==="pending"||i.status==="processing"):[]}),this.completedRows=k(()=>{let t=this.batch();return t?.rows?t.rows.filter(i=>i.status==="completed"):[]}),this.failedRows=k(()=>{let t=this.batch();return t?.rows?t.rows.filter(i=>i.status==="failed"):[]}),this.progress=k(()=>{let t=this.batch();return!t||t.totalRows===0?0:Math.round((t.completedRows+t.failedRows)/t.totalRows*100)}),this.selectedRow=S(null),this.detailsViewMode=S("readable")}ngOnInit(){this._route.params.subscribe(t=>{this.configId.set(t.configId),this.batchId.set(t.batchId),this._loadConfiguration(),this._loadBatch()})}ngOnDestroy(){this._processingAborted=!0,this._destroy$.next(),this._destroy$.complete()}_loadConfiguration(){let t=this.configId();t&&this._smartBatchService.getConfiguration(t).subscribe({next:i=>{this.configuration.set(i.data)}})}_loadBatch(){let t=this.batchId();t&&(this.isLoading.set(!0),this._smartBatchService.getSmartBatch(t).subscribe({next:i=>{this.batch.set(i.data),this.isLoading.set(!1),i.data.status==="processing"&&!this.isProcessing()&&(console.log("Resuming processing for batch:",t),this.isProcessing.set(!0),this._processRows())},error:i=>{console.error("Failed to load batch:",i),this.isLoading.set(!1)}}))}startProcessing(){return j(this,null,function*(){let t=this.batchId();if(t){this.isStarting.set(!0),this._processingAborted=!1;try{let i=yield D(this._smartBatchService.updateSmartBatch(t,{status:"processing"}));this.batch.set(i.data),this.isStarting.set(!1),this.isProcessing.set(!0),yield this._processRows()}catch(i){console.error("Failed to start processing:",i),this.isStarting.set(!1)}}})}_processRows(){return j(this,null,function*(){for(;!this.configuration()&&!this._processingAborted;)yield new Promise(n=>setTimeout(n,100));let t=this.batch(),i=this.configSteps();if(!t||i.length===0){this.isProcessing.set(!1);return}console.log(`Starting/Resuming processing for ${t.rows.length} rows`);for(let n of t.rows){if(this._processingAborted)break;n.status==="completed"||n.status==="failed"||(this.currentRowIndex.set(n.rowIndex),yield this._processRow(n,i))}this._loadBatch(),this.isProcessing.set(!1),this.currentRowIndex.set(null),this.currentStepIndex.set(null)})}_processRow(t,i){return j(this,null,function*(){let n=this.batchId();if(!n)return;let m={},p=[],h=!1;for(let b of i){if(this._processingAborted||h)break;this.currentStepIndex.set(b.sequence);try{let B=this._buildStepParams(t.inputData,b),F=b.appFeature,M=F?.url,vt=F?.method||"GET";if(!M)throw new Error(`Step ${b.sequence} has no URL configured`);let wt=yield D(this._smartBatchService.executeFeatureRequest(M,vt,B));m[b.sequence]=wt.data}catch(B){console.error(`Step ${b.sequence} failed for row ${t.rowIndex}:`,B),p.push({step:b.sequence,message:B?.error?.message||B?.message||"Step execution failed",code:B?.error?.code||"STEP_ERROR"}),this.configuration()?.mergeStrategy==="sequential"&&(h=!0)}}try{let b=yield D(this._smartBatchService.updateBatchRow(n,t.rowIndex,{status:h?"failed":"completed",results:m,errors:p}));this.batch.set(b.data)}catch(b){console.error(`Failed to update row ${t.rowIndex}:`,b)}})}_buildStepParams(t,i){let n=J({},t);if(i.parameterDefaults&&Object.assign(n,i.parameterDefaults),i.inputFieldMapping){let m=i.inputFieldMapping;m instanceof Map?m.forEach((p,h)=>{t[h]!==void 0&&(n[p]=t[h])}):Object.entries(m).forEach(([p,h])=>{t[p]!==void 0&&(n[h]=t[p])})}return n}pauseProcessing(){this._processingAborted=!0,this.isProcessing.set(!1)}generateReport(){let t=this.configId(),i=this.batchId();t&&i&&this._router.navigate(["/smart-batch",t,"batch",i,"report"])}generateRowReport(t){let i=this.configId(),n=this.batchId();i&&n&&this._router.navigate(["/smart-batch",i,"batch",n,"report"],{queryParams:{rowIndex:t.rowIndex}})}goBack(){let t=this.configId();t&&this._router.navigate(["/smart-batch",t])}selectRow(t){this.selectedRow.set(t)}getStatusColor(t){switch(t){case"completed":return"text-emerald-600";case"failed":return"text-red-600";case"processing":return"text-amber-600";default:return"text-gray-400"}}getStatusIcon(t){switch(t){case"completed":return"check_circle";case"failed":return"error";case"processing":return"sync";default:return"pending"}}getStepName(t){let i=t.appFeature;return i?.name||i?.code||`Step ${t.sequence}`}getStepUrl(t){let i=t.appFeature;return i?.url||i?.endpoint||""}getStepPrice(t){let i=t.appFeature;return i?.price??i?.smartCheckPrice??0}getStepResultFields(t){if(t==null||typeof t!="object")return[{label:"Result",value:t!=null?String(t):"\u2014"}];let i=[];for(let n of Object.keys(t)){let m=n.replace(/([A-Z])/g," $1").replace(/^./,b=>b.toUpperCase()).trim(),p=t[n],h;p==null?h="\u2014":Array.isArray(p)?h=p.length===0?"\u2014":`[${p.length} item${p.length===1?"":"s"}]`:typeof p=="object"?h=typeof p=="object"&&p!==null&&Object.keys(p).length>0?`{ ${Object.keys(p).slice(0,3).join(", ")}${Object.keys(p).length>3?"\u2026":""} }`:"\u2014":h=String(p),i.push({label:m,value:h})}return i}getInputDataFields(){let t=this.selectedRow()?.inputData;return t==null||typeof t!="object"?[]:this.getStepResultFields(t)}formatJson(t){if(t==null)return"\u2014";try{return JSON.stringify(t,null,2)}catch{return String(t)}}getRowStepStatus(t,i){if(this.isProcessing()&&this.currentRowIndex()===t.rowIndex&&this.currentStepIndex()===i)return"pending";if(!t.results||typeof t.results!="object")return t.errors?.find(p=>p.step===i)?"failed":"pending";let n=t.results[i];return n==null?t.errors?.find(p=>p.step===i)?"failed":"pending":"completed"}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=G({type:e,selectors:[["batch-processing"]],decls:29,vars:24,consts:[[1,"min-h-screen","w-full","bg-gray-50"],[1,"bg-white","border-b","border-gray-200","sticky","top-0","z-10"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-4"],["mat-icon-button","",3,"click","matTooltip"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500"],[1,"flex","items-center","gap-3"],["mat-flat-button","","color","primary",1,"!rounded-xl",3,"disabled"],["mat-stroked-button","",1,"!rounded-xl"],["mat-flat-button","","color","accent",1,"!rounded-xl","!bg-indigo-600"],[1,"mt-4"],[1,"max-w-7xl","mx-auto","px-4","sm:px-6","lg:px-8","py-6"],[1,"flex","items-center","justify-center","h-64"],["mat-flat-button","","color","primary",1,"!rounded-xl",3,"click","disabled"],[1,"inline-flex","items-center","gap-2"],[1,"animate-spin"],["mat-stroked-button","",1,"!rounded-xl",3,"click"],["mat-flat-button","","color","accent",1,"!rounded-xl","!bg-indigo-600",3,"click"],[1,"flex","justify-between","text-sm","text-gray-600","mb-1"],["mode","determinate",1,"!rounded-full",3,"value"],[1,"bg-white","rounded-xl","border","border-gray-200","p-4"],[1,"text-sm","font-semibold","text-gray-500","uppercase","tracking-wider","mb-3"],[1,"flex","items-stretch","gap-2","flex-wrap"],[1,"flex","items-center","gap-2","min-w-0","max-w-[320px]","sm:max-w-[360px]","px-3","py-2.5","bg-gray-50","rounded-lg","border","border-gray-200"],[1,"shrink-0","w-7","h-7","rounded-full","bg-indigo-100","flex","items-center","justify-center","text-xs","font-bold","text-indigo-600"],[1,"min-w-0","flex-1","flex","flex-col","gap-0.5"],[1,"text-sm","font-medium","text-gray-900","truncate",3,"matTooltip"],["matTooltipPosition","below",1,"text-xs","text-gray-500","font-mono","truncate",3,"matTooltip"],[1,"text-xs","text-indigo-600","font-medium","mt-0.5"],["aria-hidden","true",1,"text-gray-300","!text-base","shrink-0","self-center"],["diameter","48"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"bg-white","rounded-2xl","border","border-gray-200","overflow-hidden"],[1,"bg-amber-50","border-b","border-amber-100","px-6","py-4"],[1,"w-10","h-10","rounded-xl","bg-amber-100","flex","items-center","justify-center"],[1,"text-amber-600"],[1,"font-semibold","text-gray-900"],[1,"max-h-[500px]","overflow-y-auto"],[1,"p-8","text-center","text-gray-400"],[1,"bg-emerald-50","border-b","border-emerald-100","px-6","py-4"],[1,"w-10","h-10","rounded-xl","bg-emerald-100","flex","items-center","justify-center"],[1,"text-emerald-600"],[1,"mt-6","bg-white","rounded-2xl","border","border-gray-200","p-6"],[1,"!text-5xl","!w-12","!h-12","mb-2"],[1,"px-6","py-4","border-b","border-gray-100","hover:bg-gray-50","cursor-pointer","transition-colors",3,"bg-indigo-50"],[1,"px-6","py-4","border-b","border-gray-100","hover:bg-gray-50","cursor-pointer","transition-colors",3,"click"],[1,"w-8","h-8","rounded-lg","bg-gray-100","flex","items-center","justify-center","text-sm","font-medium","text-gray-600"],[1,"font-medium","text-gray-900","text-sm"],[1,"text-xs","text-gray-400"],[1,"flex","items-center","gap-1"],[1,"w-5","h-5","rounded-full","bg-emerald-100","flex","items-center","justify-center",3,"matTooltip"],[1,"w-5","h-5","rounded-full","bg-red-100","flex","items-center","justify-center",3,"matTooltip"],[1,"w-5","h-5","rounded-full","bg-gray-100","flex","items-center","justify-center",3,"matTooltip"],[1,"text-emerald-600","!text-xs","!w-3","!h-3"],[1,"text-red-600","!text-xs","!w-3","!h-3"],[1,"text-gray-400","!text-xs","!w-3","!h-3"],[1,"px-6","py-4","border-b","border-gray-100","hover:bg-gray-50","cursor-pointer","transition-colors",3,"bg-red-50"],[1,"w-8","h-8","rounded-lg","bg-emerald-100","flex","items-center","justify-center"],[1,"text-emerald-600","!text-base"],[1,"text-xs","text-emerald-600"],[1,"w-8","h-8","rounded-lg","bg-red-100","flex","items-center","justify-center"],[1,"text-red-600","!text-base"],[1,"text-xs","text-red-600"],[1,"flex","items-center","justify-between","mb-4"],[1,"flex","items-center","gap-2"],[1,"!rounded-lg",3,"change","value"],["value","readable"],["value","json"],["mat-flat-button","","color","primary",1,"!rounded-lg"],["mat-icon-button","",3,"click"],[1,"mb-6"],[1,"text-sm","font-medium","text-gray-500","mb-3"],[1,"border","border-gray-200","rounded-lg","overflow-hidden","bg-white"],[1,"px-4","py-3"],[1,"bg-gray-50","rounded-lg","p-4","text-sm","font-mono","text-gray-800","overflow-auto","max-h-64","m-0"],["mat-flat-button","","color","primary",1,"!rounded-lg",3,"click"],[1,"mr-2","icon-size-4"],[1,"space-y-0"],[1,"text-sm","text-gray-400","py-2"],[1,"flex","gap-4","py-2","border-b","border-gray-100","last:border-0","text-sm"],[1,"text-gray-500","min-w-[140px]","shrink-0"],[1,"text-gray-900","font-medium","break-words"],[1,"space-y-3"],[1,"border","border-gray-200","rounded-lg","overflow-hidden"],[1,"flex","items-center","justify-between","px-4","py-3","bg-gray-50"],[1,"w-6","h-6","rounded-full","flex","items-center","justify-center","text-xs","font-bold"],[1,"font-medium","text-gray-700"],[1,"text-xs","font-medium","px-2","py-1","rounded-full"],[1,"px-4","py-3","bg-white","border-t","border-gray-100"],[1,"bg-gray-50","rounded-lg","p-3","text-xs","font-mono","text-gray-800","overflow-auto","max-h-64","m-0"],[1,"text-sm","font-medium","text-red-500","mb-3"],[1,"space-y-2"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-3"],[1,"text-sm","font-medium","text-red-700"],[1,"text-sm","text-red-600"]],template:function(i,n){if(i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"button",5),d(6,"transloco"),I("click",function(){return n.goBack()}),o(7,"mat-icon"),s(8,"arrow_back"),r()(),o(9,"div")(10,"h1",6),s(11),d(12,"transloco"),r(),o(13,"p",7),s(14),d(15,"transloco"),d(16,"transloco"),o(17,"span"),s(18),d(19,"transloco"),r()()()(),o(20,"div",8),g(21,It,4,2,"button",9)(22,Et,6,3,"button",10)(23,Rt,6,3,"button",11),r()(),g(24,Tt,8,5,"div",12),r()(),g(25,Vt,8,3,"div",2),o(26,"div",13),g(27,jt,2,0,"div",14)(28,ue,34,21),r()()),i&2){let m,p,h,b,B,F,M;a(5),v("matTooltip",_(6,14,"batchProcessing.backToDashboard")),a(6),u(" ",((m=n.batch())==null?null:m.name)||_(12,16,"batchProcessing.batchProcessing")," "),a(3),Y(" ",((p=n.batch())==null?null:p.totalRows)||0," ",_(15,18,"batchProcessing.records")," \u2022 ",_(16,20,"batchProcessing.status"),": "),a(3),A(n.getStatusColor(((h=n.batch())==null?null:h.status)||"pending")),a(),u(" ",_(19,22,"batchProcessing."+(((b=n.batch())==null?null:b.status)||"pending"))," "),a(3),x(((B=n.batch())==null?null:B.status)==="draft"||((B=n.batch())==null?null:B.status)==="pending"?21:-1),a(),x(((F=n.batch())==null?null:F.status)==="processing"?22:-1),a(),x(((M=n.batch())==null?null:M.status)==="completed"?23:-1),a(),x(n.isProcessing()?24:-1),a(),x(n.configSteps().length>0?25:-1),a(2),x(n.isLoading()?27:28)}},dependencies:[K,H,tt,nt,it,et,ft,xt,gt,rt,ot,ct,lt,ut,_t,pt,dt,st,at],encapsulation:2,data:{animation:[mt]}})}}return e})();export{qe as BatchProcessingComponent};
