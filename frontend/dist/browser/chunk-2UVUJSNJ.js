import{c as ft,d as _t}from"./chunk-DWO7TAHE.js";import{a as H,b as J,f as X}from"./chunk-NCGURMCY.js";import{a as rt,c as j,d as F}from"./chunk-AR6BYMPL.js";import{d as K,e as Q,f as Y,l as tt,m as et}from"./chunk-RV3RUMIR.js";import{A as ut,c as lt,h as at,i as pt,m as st,q as ct,r as mt,y as dt}from"./chunk-GEBYTXGS.js";import{U as it,V as nt,X as ot,Z as k,_ as $}from"./chunk-RMO4OYE5.js";import{Cb as D,Da as g,Db as B,Eb as l,Fb as a,Ga as R,Gb as S,Kb as G,Mb as P,Nb as d,Sa as V,Wa as o,Xb as p,Yb as _,Z as b,Zb as C,aa as T,ad as M,fa as z,fb as I,ga as E,gc as L,id as W,lb as y,mc as m,nc as u,nd as x,oc as Z,q as v,qa as O,ra as N,sb as w,tb as h,ub as q,zb as f}from"./chunk-QTVKNRSK.js";var Gt=(()=>{class i{constructor(t){this._httpClient=t,this.templates=R([]),this.reports=R([]),this.isLoading=R(!1)}getTemplates(t){let e={};return t&&(e={batchConfiguration:t}),this._httpClient.get(`${x.apiUrl}/v2/smart-report-templates`,{params:e}).pipe(v(n=>n.data),b(n=>this.templates.set(n)))}getTemplate(t){return this._httpClient.get(`${x.apiUrl}/v2/smart-report-templates/${t}`).pipe(v(e=>e.data))}createTemplate(t){return this._httpClient.post(`${x.apiUrl}/v2/smart-report-templates`,t).pipe(v(e=>e.data),b(e=>{this.templates.update(n=>[e,...n])}))}updateTemplate(t,e){return this._httpClient.put(`${x.apiUrl}/v2/smart-report-templates/${t}`,e).pipe(v(n=>n.data),b(n=>{this.templates.update(r=>r.map(c=>c._id===t?n:c))}))}deleteTemplate(t){return this._httpClient.delete(`${x.apiUrl}/v2/smart-report-templates/${t}`).pipe(b(()=>{this.templates.update(e=>e.filter(n=>n._id!==t))}))}sendTemplateSample(t,e){return this._httpClient.post(`${x.apiUrl}/v2/smart-report-templates/${t}/send-sample`,e)}getReports(t){let e={};return t&&(e={smartBatch:t}),this._httpClient.get(`${x.apiUrl}/v2/smart-reports`,{params:e}).pipe(v(n=>n.data),b(n=>this.reports.set(n)))}getReport(t){return this._httpClient.get(`${x.apiUrl}/v2/smart-reports/${t}`).pipe(v(e=>e.data))}createReport(t){return this._httpClient.post(`${x.apiUrl}/v2/smart-reports`,t).pipe(v(e=>e.data),b(e=>{this.reports.update(n=>[e,...n])}))}generateReport(t,e){let n={};return e?.engine&&(n.engine=e.engine),e?.rowIndex!=null&&(n.rowIndex=e.rowIndex),this._httpClient.post(`${x.apiUrl}/v2/smart-reports/${t}/generate`,Object.keys(n).length?n:{})}sendReportEmail(t,e){return this._httpClient.post(`${x.apiUrl}/v2/smart-reports/${t}/send-email`,e)}getReportDownloadUrl(t){return`${x.apiUrl}/v2/smart-reports/${t}/download`}downloadReport(t){return this._httpClient.get(`${x.apiUrl}/v2/smart-reports/${t}/download`,{responseType:"blob"})}static{this.\u0275fac=function(e){return new(e||i)(z(W))}}static{this.\u0275prov=T({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ht=(()=>{class i{constructor(){this._pendingPreviewData=R(null)}setPendingPreviewData(t){this._pendingPreviewData.set(t)}consumePendingPreviewData(){let t=this._pendingPreviewData();return this._pendingPreviewData.set(null),t}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275prov=T({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var gt=i=>({path:i}),yt=(i,s)=>s.id,Ct=(i,s)=>s.key;function bt(i,s){i&1&&(l(0,"div",2)(1,"mat-icon",4),p(2,"description"),a(),l(3,"p",5),p(4),m(5,"transloco"),a()()),i&2&&(o(4),_(u(5,1,"smartReport.noSectionsToPreview")))}function wt(i,s){if(i&1&&(l(0,"div",10)(1,"h2",13),p(2),m(3,"transloco"),a()()),i&2){let t=d().$implicit,e=d();h("text-align",(t.style==null?null:t.style.textAlign)||"left"),o(),h("font-size",(t.style==null?null:t.style.fontSize)||22,"px")("font-weight",(t.style==null?null:t.style.fontWeight)||"bold")("color",(t.style==null?null:t.style.color)||e.primaryColor()),o(),C(" ",t.staticContent||t.label||u(3,9,"smartReport.untitled")," ")}}function St(i,s){if(i&1&&(l(0,"div",8)(1,"p",14),p(2),m(3,"transloco"),a()()),i&2){let t=d().$implicit;o(),h("font-size",(t.style==null?null:t.style.fontSize)||12,"px")("font-weight",(t.style==null?null:t.style.fontWeight)||"normal")("text-align",(t.style==null?null:t.style.textAlign)||"left")("color",(t.style==null?null:t.style.color)||"#374151"),o(),_(t.staticContent||u(3,9,"smartReport.textContent"))}}function Rt(i,s){if(i&1&&(l(0,"div",15)(1,"span",16),p(2),m(3,"transloco"),a(),l(4,"span",17),p(5),a()()),i&2){let t=d().$implicit,e=d();h("text-align",(t.style==null?null:t.style.textAlign)||"left"),o(),h("font-size",(t.style==null?null:t.style.fontSize)||12,"px"),o(),_(t.label||u(3,10,"smartReport.field")),o(2),h("font-size",(t.style==null?null:t.style.fontSize)||12,"px")("color",(t.style==null?null:t.style.color)||"#111827"),o(),_(e.resolveDataPath(t.dataPath)||"\u2014")}}function Pt(i,s){if(i&1&&(l(0,"h4",21),p(1),a()),i&2){let t=d(2).$implicit,e=d();h("color",e.primaryColor()),o(),_(t.label)}}function Et(i,s){if(i&1&&(l(0,"tr",20)(1,"td",22),p(2),a(),l(3,"td",23),p(4),a()()),i&2){let t=s.$implicit;o(2),_(t.key),o(2),_(t.value)}}function Tt(i,s){if(i&1&&(l(0,"tr")(1,"td",24),p(2),m(3,"transloco"),a()()),i&2){let t=d(2).$implicit;o(2),C(" ",Z(3,1,"smartReport.noDataAtPath",L(4,gt,t.dataPath))," ")}}function It(i,s){if(i&1&&(l(0,"div",10),y(1,Pt,2,3,"h4",18),l(2,"table",19)(3,"tbody"),D(4,Et,5,2,"tr",20,Ct),y(6,Tt,4,6,"tr"),a()()()),i&2){let t=d().$implicit,e=d();o(),f(t.label?1:-1),o(3),B(e.resolveTableData(t.dataPath)),o(2),f(e.resolveTableData(t.dataPath).length===0?6:-1)}}function Mt(i,s){if(i&1&&(S(0,"img",25),m(1,"transloco")),i&2){let t=d(2).$implicit;w("src",t.staticContent,V)("alt",t.label||u(1,2,"smartReport.image"))}}function kt(i,s){i&1&&(l(0,"div",26)(1,"mat-icon",27),p(2,"image"),a()())}function $t(i,s){if(i&1&&(l(0,"div",10),y(1,Mt,2,4,"img",25)(2,kt,3,0,"div",26),a()),i&2){let t=d().$implicit;h("text-align",(t.style==null?null:t.style.textAlign)||"center"),o(),f(t.staticContent?1:2)}}function jt(i,s){if(i&1&&S(0,"hr",28),i&2){let t=d().$implicit;h("border-color",(t.style==null?null:t.style.color)||"#E5E7EB")}}function Ft(i,s){if(i&1&&S(0,"div"),i&2){let t=d().$implicit;h("height",(t.style==null?null:t.style.padding)||16,"px")}}function Dt(i,s){if(i&1){let t=G();l(0,"div",6),P("click",function(){let n=O(t).$implicit,r=d();return N(r.clickable()&&r.sectionClick()?r.sectionClick()(n):null)}),y(1,wt,4,11,"div",7)(2,St,4,11,"div",8)(3,Rt,6,12,"div",9)(4,It,7,2,"div",10)(5,$t,3,3,"div",7)(6,jt,1,2,"hr",11)(7,Ft,1,2,"div",12),a()}if(i&2){let t=s.$implicit,e=d();q("cursor-pointer",e.clickable())("ring-2",e.clickable()&&e.selectedSectionId()===t.id)("ring-indigo-400",e.clickable()&&e.selectedSectionId()===t.id)("rounded-md",e.clickable()&&e.selectedSectionId()===t.id),o(),f(t.type==="header"?1:-1),o(),f(t.type==="text"?2:-1),o(),f(t.type==="field"?3:-1),o(),f(t.type==="table"?4:-1),o(),f(t.type==="image"?5:-1),o(),f(t.type==="divider"?6:-1),o(),f(t.type==="spacer"?7:-1)}}var ee=(()=>{class i{constructor(){this.template=g.required(),this.previewData=g.required(),this.primaryColor=g("#4F46E5"),this.orientation=g("portrait"),this.clickable=g(!1),this.selectedSectionId=g(null),this.sectionClick=g(null)}resolveDataPath(t){if(!t)return"";let e=this.previewData(),n=t.split("."),r=e;for(let c of n){if(r==null||typeof r!="object")return"";r=r[c]}return r==null?"":typeof r=="object"?JSON.stringify(r):String(r)}resolveTableData(t){if(!t)return[];let e=this.previewData(),n=t.split("."),r=e;for(let c of n){if(r==null||typeof r!="object")return[];r=r[c]}return r==null||typeof r!="object"?[]:Object.entries(r).map(([c,U])=>({key:this._humanize(c),value:U!=null?String(U):""}))}_humanize(t){return t.replace(/([A-Z])/g," $1").replace(/_/g," ").replace(/^./,e=>e.toUpperCase()).trim()}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=I({type:i,selectors:[["report-preview"]],inputs:{template:[1,"template"],previewData:[1,"previewData"],primaryColor:[1,"primaryColor"],orientation:[1,"orientation"],clickable:[1,"clickable"],selectedSectionId:[1,"selectedSectionId"],sectionClick:[1,"sectionClick"]},decls:5,vars:5,consts:[[1,"bg-white","rounded-lg","shadow-lg","mx-auto","overflow-hidden",2,"border","1px solid #e5e7eb"],[1,"p-8","sm:p-10","lg:p-12"],[1,"flex","flex-col","items-center","justify-center","h-64","text-gray-300"],[1,"transition-all","duration-200",3,"cursor-pointer","ring-2","ring-indigo-400","rounded-md"],[1,"!text-5xl","!w-14","!h-14","mb-3"],[1,"text-sm"],[1,"transition-all","duration-200",3,"click"],[1,"mb-4",3,"text-align"],[1,"mb-3"],[1,"flex","gap-3","py-2.5","border-b","border-gray-100",3,"text-align"],[1,"mb-4"],[1,"my-4",2,"border-width","1px",3,"border-color"],[3,"height"],[1,"leading-tight"],[1,"leading-relaxed","whitespace-pre-wrap"],[1,"flex","gap-3","py-2.5","border-b","border-gray-100"],[1,"text-gray-500","min-w-[140px]","shrink-0"],[1,"text-gray-900","font-medium"],[1,"text-xs","font-semibold","text-gray-500","uppercase","tracking-wide","mb-2",3,"color"],[1,"w-full","text-sm"],[1,"border-b","border-gray-100"],[1,"text-xs","font-semibold","text-gray-500","uppercase","tracking-wide","mb-2"],[1,"py-2","pr-4","text-gray-500","w-1/3"],[1,"py-2","text-gray-900","font-medium"],["colspan","2",1,"py-4","text-center","text-gray-300","text-xs"],[1,"max-h-32","inline-block","rounded",2,"max-width","100%",3,"src","alt"],[1,"inline-flex","items-center","justify-center","w-48","h-24","bg-gray-100","rounded-lg","text-gray-300"],[1,"!text-3xl"],[1,"my-4",2,"border-width","1px"]],template:function(e,n){if(e&1&&(l(0,"div",0)(1,"div",1),y(2,bt,6,3,"div",2),D(3,Dt,8,15,"div",3,yt),a()()),e&2){let r;h("max-width",n.orientation()==="landscape"?"297mm":"210mm")("min-height",n.orientation()==="landscape"?"210mm":"297mm"),o(2),f(((r=n.template().sections)==null?null:r.length)===0?2:-1),o(),B(n.template().sections)}},dependencies:[M,$,k,F,j],encapsulation:2})}}return i})();function Bt(i,s){i&1&&(l(0,"mat-error"),p(1),m(2,"transloco"),a()),i&2&&(o(),_(u(2,1,"smartReport.atLeastOneRecipient")))}function At(i,s){i&1&&(l(0,"mat-error"),p(1),m(2,"transloco"),a()),i&2&&(o(),_(u(2,1,"smartReport.enterValidEmails")))}var xt=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;function Ut(i){let s=(i.value||"").trim();if(!s)return{required:!0};let t=s.split(",").map(n=>n.trim()).filter(n=>!!n);if(t.length===0)return{required:!0};let e=t.filter(n=>!xt.test(n));return e.length>0?{invalidEmails:{value:e}}:null}var he=(()=>{class i{get isSample(){return this._data?.isSample!==!1}get subjectPlaceholder(){return this.isSample?this._transloco.translate("smartReport.subjectOptionalPlaceholder"):this._transloco.translate("smartReport.reportBatchPlaceholder")}constructor(){this._dialogRef=E(H),this._fb=E(dt),this._data=E(J,{optional:!0}),this._transloco=E(rt);let t=this._data?.defaultSubject||(this._data?.isSample===!1?this._transloco.translate("smartReport.reportBatchPlaceholder"):this._transloco.translate("smartReport.subjectOptionalPlaceholder"));this.form=this._fb.group({recipients:["",[Ut]],subject:[t,[]]})}onCancel(){this._dialogRef.close()}onSubmit(){let t=this.form.get("recipients");if(this.form.invalid||!t)return;let e=(t.value||"").split(",").map(c=>c.trim()).filter(c=>!!c),n=e.filter(c=>xt.test(c));if(n.length===0){t.setErrors(e.length===0?{required:!0}:{invalidEmails:{value:e}}),t.markAsTouched();return}let r={recipients:n,subject:this.form.get("subject")?.value?.trim()||void 0};this._dialogRef.close(r)}static{this.\u0275fac=function(e){return new(e||i)}}static{this.\u0275cmp=I({type:i,selectors:[["send-sample-modal"]],decls:43,vars:29,consts:[[1,"flex","flex-col","w-full","max-w-lg"],[1,"px-6","pt-6","pb-4"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-3"],[1,"w-12","h-12","rounded-xl","bg-gradient-to-br","from-indigo-500","to-purple-600","flex","items-center","justify-center","shadow-lg","shadow-indigo-500/25"],[1,"!w-6","!h-6","text-white","icon-size-6"],[1,"text-lg","font-bold","text-slate-900","dark:text-white"],[1,"text-sm","text-slate-500","dark:text-slate-400"],["mat-icon-button","",1,"!-mr-2",3,"click"],[1,"px-6","pb-6","space-y-4",3,"ngSubmit","formGroup"],["appearance","outline",1,"w-full"],["matInput","","formControlName","recipients","rows","3",3,"placeholder"],["matInput","","formControlName","subject",3,"placeholder"],[1,"flex","gap-3","pt-2","justify-end","border-t","border-slate-200","dark:border-slate-700"],["mat-button","","type","button",1,"!text-slate-600",3,"click"],["mat-flat-button","","color","primary","type","submit",1,"!rounded-xl","!bg-indigo-600","!text-white",3,"disabled"],[1,"!w-4","!h-4","mr-1"]],template:function(e,n){if(e&1&&(l(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"mat-icon",5),p(6,"send"),a()(),l(7,"div")(8,"h2",6),p(9),m(10,"transloco"),a(),l(11,"p",7),p(12),m(13,"transloco"),a()()(),l(14,"button",8),P("click",function(){return n.onCancel()}),l(15,"mat-icon"),p(16,"close"),a()()()(),l(17,"form",9),P("ngSubmit",function(){return n.onSubmit()}),l(18,"mat-form-field",10)(19,"mat-label"),p(20),m(21,"transloco"),a(),S(22,"textarea",11),m(23,"transloco"),l(24,"mat-hint"),p(25),m(26,"transloco"),a(),y(27,Bt,3,3,"mat-error")(28,At,3,3,"mat-error"),a(),l(29,"mat-form-field",10)(30,"mat-label"),p(31),m(32,"transloco"),a(),S(33,"input",12),a(),l(34,"div",13)(35,"button",14),P("click",function(){return n.onCancel()}),p(36),m(37,"transloco"),a(),l(38,"button",15)(39,"mat-icon",16),p(40,"send"),a(),p(41),m(42,"transloco"),a()()()()),e&2){let r,c;o(9),C(" ",u(10,13,n.isSample?"smartReport.sendSampleReport":"smartReport.sendReport")," "),o(3),C(" ",u(13,15,"smartReport.enterRecipientsAndSubject")," "),o(5),w("formGroup",n.form),o(3),_(u(21,17,"smartReport.recipientEmails")),o(2),w("placeholder",u(23,19,"smartReport.recipientsPlaceholder")),o(3),_(u(26,21,"smartReport.separateEmailsWithCommas")),o(2),f((r=n.form.get("recipients"))!=null&&r.hasError("required")&&((r=n.form.get("recipients"))!=null&&r.touched)?27:-1),o(),f((c=n.form.get("recipients"))!=null&&c.hasError("invalidEmails")&&((c=n.form.get("recipients"))!=null&&c.touched)?28:-1),o(3),_(u(32,23,"smartReport.subjectOptional")),o(2),w("placeholder",n.subjectPlaceholder),o(3),C(" ",u(37,25,"smartReport.cancel")," "),o(2),w("disabled",n.form.invalid||n.form.pending),o(3),C(" ",u(42,27,n.isSample?"smartReport.sendSample":"smartReport.sendReport")," ")}},dependencies:[M,ut,st,lt,at,pt,ct,mt,X,ot,nt,it,$,k,et,tt,K,Y,Q,_t,ft,F,j],styles:["[_nghost-%COMP%]{display:block}"]})}}return i})();export{Gt as a,Ht as b,ee as c,he as d};
