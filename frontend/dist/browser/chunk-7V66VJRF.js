import{a as I}from"./chunk-XRBOLGPP.js";import{a as k}from"./chunk-SJCCPM3Q.js";import{D as v,H as S,W as c,Z as l,aa as m,ga as o,h as _,kd as d,l as s,m as p,pd as n,q as f}from"./chunk-BMVGBJ55.js";import{a as h}from"./chunk-66YHNWRR.js";var b=(()=>{class r{constructor(){this._httpClient=o(d),this._httpWrapper=o(k),this._user=new _(1)}set user(t){this._user.next(t)}get user$(){return this._user.asObservable()}get(){return this._httpWrapper.sendRequest("post",n.apiUrl+"/v2/auth/session",{origin:"app"}).pipe(f(t=>t.data?.user||t.user||t),l(t=>{this._user.next(t)}))}update(t){return this._httpClient.patch(n.baseUrl+"api/common/user",{user:t}).pipe(f(e=>{this._user.next(e)}))}updateClient(t){return this._httpWrapper.sendRequest("put",n.apiUrl+"/v2/clients/me",t).pipe(l(e=>{let i=e.data||e;this._user.pipe(S(1)).subscribe(a=>{this._user.next(h(h(h({},a),i),t))})}))}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var N=(()=>{class r{constructor(){this._authenticated=!1,this._httpClient=o(d),this._userService=o(b),this.baseUrl=n.baseUrl}set accessToken(t){localStorage.setItem("accessToken",t)}get accessToken(){return localStorage.getItem("accessToken")??""}forgotPassword(t){return this._httpClient.post(this.baseUrl+"api/auth/forgot-password",t)}resetPassword(t){return this._httpClient.post(this.baseUrl+"api/auth/reset-password",t)}signIn(t){return this._authenticated?p(()=>new Error("User is already logged in.")):this._httpClient.post(this.baseUrl+"api/auth/sign-in",t).pipe(c(e=>(this._authenticated=!0,this._userService.user=e.user,this.accessToken=e.accessToken,s(e))))}requestOTP(t){return this._authenticated?p(()=>new Error("User is already logged in.")):this._httpClient.post(this.baseUrl+"v2/auth/super/request-otp",t).pipe(c(e=>s(e)))}confirmOTP(t){return this._authenticated?p(()=>new Error("User is already logged in.")):this._httpClient.post(this.baseUrl+"v2/auth/super/verify-otp",t).pipe(c(e=>{if(e.data)return localStorage.setItem("accessToken",e.data.accessToken),localStorage.setItem("user",JSON.stringify(e.data.user)),this._authenticated=!0,this._userService.user=e.data.user,s(e.data)}))}signInUsingToken(){return this._httpClient.post(this.baseUrl+"api/auth/sign-in-with-token",{accessToken:this.accessToken}).pipe(v(()=>s(!1)),c(t=>(t.accessToken,this._authenticated=!0,this._userService.user=t.user,s(!0))))}refreshSession(){return this._userService.get().pipe(l(t=>{try{let e=i=>{let a=localStorage.getItem(i);if(a&&a!=="undefined"&&a!=="null")try{let u=JSON.parse(a),g=!1;t.credits!==void 0&&(u.credits=t.credits,g=!0),g&&localStorage.setItem(i,JSON.stringify(u))}catch(u){console.warn(`Failed to parse ${i} from local storage`,u)}};e("verifik_account"),e("user")}catch(e){console.error("Failed to sync balance to local storage",e)}}))}signOut(t=!0){return this._authenticated=!1,localStorage.removeItem("accessToken"),localStorage.removeItem("verifik_account"),localStorage.removeItem("user"),t||(localStorage.removeItem("x402_agent_address"),localStorage.removeItem("x402_agent_pk"),localStorage.removeItem("x402_agent_pk_encrypted"),localStorage.removeItem("x402_wallet_type"),localStorage.removeItem("x402_encryption_method"),localStorage.removeItem("x402_encryption_salt"),localStorage.removeItem("x402_credential_id"),localStorage.removeItem("lastWalletAddress")),s(!0)}signUp(t){return this._httpClient.post(this.baseUrl+"api/auth/sign-up",t)}unlockSession(t){return this._httpClient.post(this.baseUrl+"api/auth/unlock-session",t)}check(){return this._authenticated?s(!0):this.accessToken?I.isTokenExpired(this.accessToken)?(localStorage.removeItem("accessToken"),localStorage.removeItem("user"),this._authenticated=!1,s(!1)):this.signInUsingToken():s(!1)}simulateProjectLogin(t,e="onboarding"){let i={Authorization:`Bearer ${t}`};return this._httpClient.post(this.baseUrl+"v2/auth/project-login",{projectType:e},{headers:i})}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=m({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{b as a,N as b};
